"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[451],{4451:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var a=n(3827),s=n.n(a),r=n(43001),i=n(69190),o=n(71771),l=n(18414);const c=function(e,t,n){const{tools:a}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,a)},u={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const p=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateSEGDisplaySet:s}){const{uiViewportDialogService:r}=e.services;return new Promise((async function(e,i){const o=await function(e,t){return new Promise((function(n,a){const s="Do you want to open this Segmentation?",r=[{type:l.LZ.dt.secondary,text:"No",value:u.CANCEL},{type:l.LZ.dt.primary,text:"Yes",value:u.HYDRATE_SEG}],i=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:s,actions:r,onSubmit:i,onOutsideClick:()=>{e.hide(),n(u.CANCEL)}})}))}(r,n);if(o===u.HYDRATE_SEG){a?.forEach((e=>{e()}));e(await s({segDisplaySet:t,viewportId:n}))}}))};function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}const{formatDate:m}=o.utils;function S(e){const{children:t,displaySets:n,viewportOptions:a,viewportLabel:s,servicesManager:u,extensionManager:S,commandsManager:y}=e,{t:E}=(0,i.$G)("SEGViewport"),g=a.viewportId,{displaySetService:v,toolGroupService:f,segmentationService:w,uiNotificationService:b,customizationService:D}=u.services,h=`SEGToolGroup-${g}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const I=n[0],[N,C]=(0,l.O_)(),[T,k]=(0,r.useState)(1),[G,A]=(0,r.useState)(I.isHydrated),[P,x]=(0,r.useState)(!I.isLoaded),[M,O]=(0,r.useState)(null),[L,U]=(0,r.useState)({percentComplete:null,totalSegments:null}),V=(0,r.useRef)(null),{viewports:R,activeViewportId:_}=N,H=I.getReferenceDisplaySet(),j=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=a,r=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:i,SliceThickness:o}=r,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||o,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||i};return c}(H,I);V.current={displaySet:H,metadata:j};const F=e=>{O(e.detail.element)},Y=()=>{O(null)},q=(0,r.useCallback)((()=>{N?.viewports.forEach((({viewportId:e})=>{y.runCommand("storePresentation",{viewportId:e})}))}),[N]),B=(0,r.useCallback)((()=>{const{component:t}=S.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=V.current;return r.createElement(t,d({},e,{displaySets:[n,I],viewportOptions:{viewportType:"volume",toolGroupId:h,orientation:a.orientation,viewportId:a.viewportId},onElementEnabled:F,onElementDisabled:Y}))}),[g,I,h]),$=(0,r.useCallback)((e=>{e="left"===e?-1:1;const t=I.displaySetInstanceUID,n=w.getSegmentation(t),{segments:a}=n,s=Object.keys(a).length;let r=T+e;r>s-1?r=1:0===r&&(r=s-1),w.jumpToSegmentCenter(t,r,h),k(r)}),[T]);(0,r.useEffect)((()=>{P||p({servicesManager:u,viewportId:g,segDisplaySet:I,preHydrateCallbacks:[q],hydrateSEGDisplaySet:ae}).then((e=>{e&&A(!0)}))}),[u,g,I,P]),(0,r.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===I.displaySetInstanceUID&&x(!1)}));return()=>{e()}}),[I]),(0,r.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{U({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[I]),(0,r.useEffect)((()=>{const e=v.subscribe(v.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=R.get(_);e.includes(t.displaySetInstanceUID)&&C.setDisplaySetsForViewport({viewportId:_,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=f.getToolGroup(h);if(!e)return e=c(f,D,h),()=>{w.removeSegmentationRepresentationFromToolGroup(h),f.destroyToolGroup(h)}}),[]),(0,r.useEffect)((()=>(A(I.isHydrated),()=>{w.removeSegmentationRepresentationFromToolGroup(h),V.current=null})),[I]);let J=null;if(!V.current||H.displaySetInstanceUID!==V.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(J=t.map(((e,t)=>e&&r.cloneElement(e,{viewportId:g,key:t}))));const{PatientID:Z,PatientName:z,PatientSex:K,PatientAge:Q,SliceThickness:W,ManufacturerModelName:X,StudyDate:ee,SeriesDescription:te,SpacingBetweenSlices:ne}=V.current.metadata,ae=({segDisplaySet:e,viewportId:t})=>{y.runCommand("loadSegmentationDisplaySetsForViewport",{displaySets:[e],viewportId:t})},se=async()=>{q();const e=await ae({segDisplaySet:I,viewportId:g});A(e)};return r.createElement(r.Fragment,null,r.createElement(l.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:$,getStatusComponent:()=>function({isHydrated:e,onStatusClick:t}){let n=null,a=null;const{t:s}=(0,i.$G)("Common"),o=s("LOAD");switch(e){case!0:a=()=>r.createElement(l.JO,{name:"status-alert"}),n=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:a=()=>r.createElement(l.JO,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>r.createElement("div",null,"Click LOAD to load segmentation.")}const c=()=>r.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},r.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},r.createElement(a,null),r.createElement("span",{className:"ml-1"},"SEG")),!e&&r.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},o));return r.createElement(r.Fragment,null,n&&r.createElement(l.u,{content:r.createElement(n,null),position:"bottom-left"},r.createElement(c,null)),!n&&r.createElement(c,null))}({isHydrated:G,onStatusClick:se}),studyData:{label:s,useAltStyling:!0,studyDate:m(ee),seriesDescription:`SEG Viewport ${te}`,patientInformation:{patientName:z?o.default.utils.formatPN(z.Alphabetic):"",patientSex:K||"",patientAge:Q||"",MRN:Z||"",thickness:W?o.utils.roundNumber(W,2):"",thicknessUnits:void 0!==W?"mm":"",spacing:void 0!==ne?o.utils.roundNumber(ne,2):"",scanner:X||""}}}),r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},P&&r.createElement(l.bk,{className:"h-full w-full",totalNumbers:L.totalSegments,percentComplete:L.percentComplete,loadingText:"Loading SEG..."}),B(),J))}S.propTypes={displaySets:s().arrayOf(s().object),viewportId:s().string.isRequired,dataSource:s().object,children:s().node,customProps:s().object},S.defaultProps={customProps:{}};const y=S}}]);
//# sourceMappingURL=451.bundle.b637f56818d02ce58b8a.js.map