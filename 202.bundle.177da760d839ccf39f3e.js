/*! For license information please see 202.bundle.177da760d839ccf39f3e.js.LICENSE.txt */
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[202],{91202:(e,t,n)=>{"use strict";n.d(t,{Y:()=>Me,adaptersRT:()=>dl,adaptersSEG:()=>ll,adaptersSR:()=>ul,helpers:()=>D});var r=n(67540),o=n(58955),a=n(87513),i=n.n(a),s=n(11677),c=n.n(s),u=n(45451);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(){f=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var a=t&&t.prototype instanceof I?t:I,i=Object.create(a.prototype),s=new R(r||[]);return o(i,"_invoke",{value:D(e,n,s)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var p="suspendedStart",g="suspendedYield",m="executing",h="completed",y={};function I(){}function v(){}function T(){}var E={};u(E,i,(function(){return this}));var b=Object.getPrototypeOf,A=b&&b(b(N([])));A&&A!==n&&r.call(A,i)&&(E=A);var O=T.prototype=I.prototype=Object.create(E);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(o,a,i,s){var c=d(e[o],e,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(l).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function D(t,n,r){var o=p;return function(a,i){if(o===m)throw new Error("Generator is already running");if(o===h){if("throw"===a)throw i;return{value:e,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=x(s,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var u=d(t,n,r);if("normal"===u.type){if(o=r.done?h:g,u.arg===y)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=h,r.method="throw",r.arg=u.arg)}}}function x(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var a=d(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,y;var i=a.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function N(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(typeof t+" is not iterable")}return v.prototype=T,o(O,"constructor",{value:T,configurable:!0}),o(T,"constructor",{value:v,configurable:!0}),v.displayName=u(T,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,T):(e.__proto__=T,u(e,c,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},S(C.prototype),u(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new C(l(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(O),u(O,c,"Generator"),u(O,i,(function(){return this})),u(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=N,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;w(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:N(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),y}},t}function p(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,A(r.key),r)}}function h(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t,n){return(t=A(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=T(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function A(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var O=function(e){return Array.isArray(e)?e:[e]},S=function(e){return function(t){return t.ConceptNameCodeSequence.CodeMeaning===e}},C=r.aT.datasetToDict;var D=Object.freeze({__proto__:null,codeMeaningEquals:S,downloadDICOMData:function(e,t){var n;if(e instanceof ArrayBuffer)n=new Blob([e],{type:"application/dicom"});else{if(!e._meta)throw new Error("Dataset must have a _meta property");var r=o.lW.from(C(e).write());n=new Blob([r],{type:"application/dicom"})}var a=document.createElement("a");a.href=window.URL.createObjectURL(n),a.download=t,a.click()},graphicTypeEquals:function(e){return function(t){return t&&t.GraphicType===e}},toArray:O}),x=r.hC.TID1500,_=r.hC.addAccessors,w=r.U7.StructuredReport,R=r.oq.Normalizer,N=x.TID1500MeasurementReport,P=x.TID1501MeasurementGroup,M=r.aT.DicomMetaDictionary,L={CodingSchemeDesignator:"DCM",CodeValue:"121071"},F={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},U={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},G=function(e,t,n){var r=e.ConceptNameCodeSequence;if(r){var o=r.CodingSchemeDesignator,a=r.CodeValue;return o==t.CodingSchemeDesignator&&a==t.CodeValue||n&&o==n.CodingSchemeDesignator&&a==n.CodeValue}};var k=function(){function e(){g(this,e)}return h(e,null,[{key:"getSetupMeasurementData",value:function(e){var t=e.ContentSequence,n=O(t),r=n.find((function(e){return G(e,L)})),o=n.filter((function(e){return G(e,F,U)}))||[],a=n.find((function(e){return"NUM"===e.ValueType})),i=O(a.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),s=i.ContentSequence.ReferencedSOPSequence,c=s.ReferencedSOPInstanceUID,u=s.ReferencedFrameNumber,l={sopInstanceUid:c,frameIndex:u||1,complete:!0,finding:r?_(r.ConceptCodeSequence):void 0,findingSites:o.map((function(e){return _(e.ConceptCodeSequence)}))};l.finding&&(l.description=l.finding.CodeMeaning);var d=l.findingSites&&l.findingSites[0];return d&&(l.location=d[0]&&d[0].CodeMeaning||d.CodeMeaning),{defaultState:l,findingGroup:r,findingSiteGroups:o,NUMGroup:a,SCOORDGroup:i,ReferencedSOPSequence:s,ReferencedSOPInstanceUID:c,ReferencedFrameNumber:u}}},{key:"generateReport",value:function(e,t,n){var r=[],o=Object.keys(e)[0];if(!o)throw new Error("No measurements provided.");var a=t.get("generalSeriesModule",o),i=a.studyInstanceUID,s=a.seriesInstanceUID;Object.keys(e).forEach((function(n){var o=t.get("sopCommonModule",n),a=t.get("frameNumber",n),i=e[n],s=Object.keys(i),c={ReferencedSOPClassUID:o.sopClassUID,ReferencedSOPInstanceUID:o.sopInstanceUID};R.isMultiframeSOPClassUID(o.sopClassUID)&&(c.ReferencedFrameNumber=a);var u=[];s.forEach((function(e){var t=function(e,t,n){var r=t[e],o=k.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(r&&r.data&&r.data.length&&o){var a=r.data.map((function(e){return function(e,t,n,r){var o=r.getTID300RepresentationArguments(e);return o.ReferencedSOPSequence=n,new r.TID300Representation(o)}(e,0,n,o)}));return new P(a)}}(e,i,c);t&&u.push(t)})),r=r.concat(u)}));var c=new N({TID1501MeasurementGroups:r},n),u=new Uint8Array(2);u[1]=1;var l={StudyInstanceUID:i,SeriesInstanceUID:s},d={FileMetaInformationVersion:{Value:[u.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[M.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};l._meta=d,l._vrMap={PixelData:"OW"};var f=new w([l]),p=c.contentItem(l);return f.dataset=Object.assign(f.dataset,p),f.dataset._meta=d,f}},{key:"generateToolState",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("1500"!==t.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");var r=O(t.ContentSequence).find(S("Imaging Measurements")),o=O(r.ContentSequence).filter(S("Measurement Group")),a={},i=e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,s=[];return Object.keys(i).forEach((function(e){s.push(i[e]),a[e]=[]})),o.forEach((function(e){var r=O(e.ContentSequence).find((function(e){return"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning})).TextValue,o=n.getToolClass?n.getToolClass(e,t,s):s.find((function(e){return e.isValidCornerstoneTrackingIdentifier(r)}));if(o){var i=o.getMeasurementData(e);console.log("=== ".concat(o.toolType," ===")),console.log(i),a[o.toolType].push(i)}})),a}},{key:"registerTool",value:function(t){e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[t.utilityToolType]=t,e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[t.toolType]=t,e.MEASUREMENT_BY_TOOLTYPE[t.toolType]=t.utilityToolType}}]),e}();k.MEASUREMENT_BY_TOOLTYPE={},k.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},k.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={};var V="cornerstoneTools@^4.0.0",j=r.hC.TID300.Length,B="Length",z=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.NUMGroup,a=n.SCOORDGroup,i=d(d({},r),{},{length:o.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),s=I(a.GraphicData,4);return i.handles.start.x=s[0],i.handles.start.y=s[1],i.handles.end.x=s[2],i.handles.end.y=s[3],i}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites;return{point1:t.start,point2:t.end,distance:e.length,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Length",finding:n,findingSites:r||[]}}}]),e}();z.toolType=B,z.utilityToolType=B,z.TID300Representation=j,z.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===B},k.registerTool(z);var q=r.hC.TID300.Polyline,H=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){for(var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.SCOORDGroup,a=n.NUMGroup,i=d(d({},r),{},{toolType:e.toolType,handles:{points:[],textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0}),s=o.GraphicData,c=0;c<s.length;c+=2)i.handles.points.push({x:s[c],y:s[c+1]});return i}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites,o=e.cachedStats,a=void 0===o?{}:o,i=t.points,s=a.area,c=void 0===s?0:s,u=a.perimeter;return{points:i,area:c,perimeter:void 0===u?0:u,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:FreehandRoi",finding:n,findingSites:r||[]}}}]),e}();H.toolType="FreehandRoi",H.utilityToolType="FreehandRoi",H.TID300Representation=q,H.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===H.toolType},k.registerTool(H);var W=r.hC.TID300.Bidirectional,Y="Bidirectional",$=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=t.ContentSequence,r=O(n).find((function(e){return"121071"===e.ConceptNameCodeSequence.CodeValue})),o=O(n).filter((function(e){return"G-C0E3"===e.ConceptNameCodeSequence.CodeValue})),a=O(n).find((function(e){return"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning})),i=O(a.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),s=O(n).find((function(e){return"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning})),c=O(s.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),u=i.ContentSequence.ReferencedSOPSequence,l=u.ReferencedSOPInstanceUID,d=u.ReferencedFrameNumber,f=String(a.MeasuredValueSequence.NumericValue),p=String(s.MeasuredValueSequence.NumericValue),g=Math.max(i.GraphicData[0],i.GraphicData[2],c.GraphicData[0],c.GraphicData[2]),m=Math.max(i.GraphicData[1],i.GraphicData[3],c.GraphicData[1],c.GraphicData[3]);return{sopInstanceUid:l,frameIndex:d||1,toolType:e.toolType,active:!1,handles:{start:{x:i.GraphicData[0],y:i.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:0},end:{x:i.GraphicData[2],y:i.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:1},perpendicularStart:{x:c.GraphicData[0],y:c.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:2},perpendicularEnd:{x:c.GraphicData[2],y:c.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:3},textBox:{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0,x:g+10,y:m+10}},invalidated:!1,isCreating:!1,longestDiameter:f,shortestDiameter:p,toolName:"Bidirectional",visible:!0,finding:r?r.ConceptCodeSequence:void 0,findingSites:o.map((function(e){return e.ConceptCodeSequence}))}}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=t.start,r=t.end,o=t.perpendicularStart,a=t.perpendicularEnd,i=e.shortestDiameter;return{longAxis:{point1:n,point2:r},shortAxis:{point1:o,point2:a},longAxisLength:e.longestDiameter,shortAxisLength:i,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Bidirectional",finding:e.finding,findingSites:e.findingSites||[]}}}]),e}();$.toolType=Y,$.utilityToolType=Y,$.TID300Representation=W,$.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===Y},k.registerTool($);var K=r.hC.TID300.Ellipse,X="EllipticalRoi",Q=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.NUMGroup,a=n.SCOORDGroup.GraphicData,i=[{x:a[0],y:a[1]},{x:a[2],y:a[3]}],s=[{x:a[4],y:a[5]},{x:a[6],y:a[7]}],c=Math.sqrt(Math.pow(s[0].x-s[1].x,2)+Math.pow(s[0].y-s[1].y,2)),u=(s[1].x-s[0].x)/c,l=(s[1].y-s[0].y)/c,f=c/2,p={x:i[0].x+u*f,y:i[0].y+l*f},g={x:i[1].x-u*f,y:i[1].y-l*f};return d(d({},r),{},{toolType:e.toolType,active:!1,cachedStats:{area:o?o.MeasuredValueSequence.NumericValue:0},handles:{end:{x:p.x,y:p.y,highlight:!1,active:!1},initialRotation:0,start:{x:g.x,y:g.y,highlight:!1,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.cachedStats,n=void 0===t?{}:t,r=e.handles,o=e.finding,a=e.findingSites,i=r.start,s=r.end,c=n.area,u=Math.abs(i.x-s.x)/2,l=Math.abs(i.y-s.y)/2,d=[],f={x:(i.x+s.x)/2,y:(i.y+s.y)/2};u>l?(d.push({x:f.x-u,y:f.y}),d.push({x:f.x+u,y:f.y}),d.push({x:f.x,y:f.y-l}),d.push({x:f.x,y:f.y+l})):(d.push({x:f.x,y:f.y-l}),d.push({x:f.x,y:f.y+l}),d.push({x:f.x-u,y:f.y}),d.push({x:f.x+u,y:f.y}));return{area:c,points:d,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:EllipticalRoi",finding:o,findingSites:a||[]}}}]),e}();Q.toolType=X,Q.utilityToolType=X,Q.TID300Representation=K,Q.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===X},k.registerTool(Q);var Z=r.hC.TID300.Circle,J="CircleRoi",ee=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.NUMGroup,a=n.SCOORDGroup.GraphicData,i={x:a[0],y:a[1]},s={x:a[2],y:a[3]};return d(d({},r),{},{toolType:e.toolType,active:!1,cachedStats:{area:o?o.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},handles:{end:d(d({},s),{},{highlight:!1,active:!1}),initialRotation:0,start:d(d({},i),{},{highlight:!1,active:!1}),textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.cachedStats,n=void 0===t?{}:t,r=e.handles,o=e.finding,a=e.findingSites,i=r.start,s=r.end,c=n.area,u=n.radius,l=2*Math.PI*u,d=[];d.push(i),d.push(s);return{area:c,perimeter:l,radius:u,points:d,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CircleRoi",finding:o,findingSites:a||[]}}}]),e}();ee.toolType=J,ee.utilityToolType=J,ee.TID300Representation=Z,ee.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===J},k.registerTool(ee);var te=r.hC.TID300.Point,ne="ArrowAnnotate",re="CORNERSTONEFREETEXT",oe=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.SCOORDGroup,a=n.findingGroup.ConceptCodeSequence.CodeMeaning,i=o.GraphicData;return d(d({},r),{},{toolType:e.toolType,active:!1,handles:{start:{x:i[0],y:i[1],highlight:!0,active:!1},end:{x:4==i.length?i[2]:i[0]+20,y:4==i.length?i[3]:i[1]+20,highlight:!0,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,text:a,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var t=[e.handles.start,e.handles.end],n=e.finding,r={points:t,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:ArrowAnnotate",findingSites:e.findingSites||[]};return n&&n.CodeValue===re||(n={CodeValue:re,CodingSchemeDesignator:"CST4",CodeMeaning:e.text}),r.finding=n,r}}]),e}();oe.toolType=ne,oe.utilityToolType=ne,oe.TID300Representation=te,oe.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===ne},k.registerTool(oe);var ae=r.hC.TID300.CobbAngle,ie="CobbAngle",se=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.NUMGroup,a=n.SCOORDGroup,i=d(d({},r),{},{rAngle:o.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},end:{},start2:{highlight:!0,drawnIndependently:!0},end2:{highlight:!0,drawnIndependently:!0},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),s=I(a.GraphicData,8);return i.handles.start.x=s[0],i.handles.start.y=s[1],i.handles.end.x=s[2],i.handles.end.y=s[3],i.handles.start2.x=s[4],i.handles.start2.y=s[5],i.handles.end2.x=s[6],i.handles.end2.y=s[7],i}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites;return{point1:t.start,point2:t.end,point3:t.start2,point4:t.end2,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CobbAngle",finding:n,findingSites:r||[]}}}]),e}();se.toolType=ie,se.utilityToolType=ie,se.TID300Representation=ae,se.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===ie},k.registerTool(se);var ce=r.hC.TID300.Angle,ue="Angle",le=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.NUMGroup,a=n.SCOORDGroup,i=d(d({},r),{},{rAngle:o.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},middle:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),s=I(a.GraphicData,8);return i.handles.start.x=s[0],i.handles.start.y=s[1],i.handles.middle.x=s[2],i.handles.middle.y=s[3],i.handles.middle.x=s[4],i.handles.middle.y=s[5],i.handles.end.x=s[6],i.handles.end.y=s[7],i}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites;return{point1:t.start,point2:t.middle,point3:t.middle,point4:t.end,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Angle",finding:n,findingSites:r||[]}}}]),e}();le.toolType=ue,le.utilityToolType=ue,le.TID300Representation=ce,le.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===ue},k.registerTool(le);var de=r.hC.TID300.Polyline,fe=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,o=n.SCOORDGroup,a=n.NUMGroup,i=d(d({},r),{},{toolType:e.toolType,handles:{start:{},end:{},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},initialRotation:0},cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0}),s=I(o.GraphicData,6);return i.handles.start.x=s[0],i.handles.start.y=s[1],s[2],s[3],i.handles.end.x=s[4],i.handles.end.y=s[5],i}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.finding,n=e.findingSites,r=e.cachedStats,o=void 0===r?{}:r,a=e.handles,i=a.start,s=a.end;return{points:[i,{x:i.x,y:s.y},s,{x:s.x,y:i.y}],area:o.area,perimeter:o.perimeter,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:RectangleRoi",finding:t,findingSites:n||[]}}}]),e}();fe.toolType="RectangleRoi",fe.utilityToolType="RectangleRoi",fe.TID300Representation=de,fe.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===V&&r===fe.toolType},k.registerTool(fe);var pe=r.hC.orientation,ge=pe.rotateDirectionCosinesInPlane,me=pe.flipImageOrientationPatient,he=pe.flipMatrix2D,ye=pe.rotateMatrix902D,Ie=r.hC.datasetToBlob,ve=r.hC.BitArray,Te=r.hC.DicomMessage,Ee=r.hC.DicomMetaDictionary,be=r.oq.Normalizer,Ae=r.U7.Segmentation,Oe={generateSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=t.toolState,o=t.segments,a=e[0],i={x:a.columns,y:a.rows,z:e.length};if(i.xy=i.x*i.y,!Ce(c,o))throw new Error("No segments to export!");for(var s=a.imageId.includes("?frame"),c=function(e,t,n){var r=[];if(t){var o=e[0].data.byteArray.buffer,a=Te.readFile(o),i=Ee.naturalizeDataset(a.dict);i._meta=Ee.namifyDataset(a.meta),r.push(i)}else for(var s=0;s<e.length;s++){var c=e[s].data.byteArray.buffer,u=Te.readFile(c),l=Ee.naturalizeDataset(u.dict);l._meta=Ee.namifyDataset(u.meta),r.push(l)}var d=be.normalizeToDataset(r);return new Ae([d],n)}(e,s,n),u=function(e,t,n){for(var r=[],o=[],a=0;a<n.length;a++)n[a]&&(r.push(a),o.push([]));for(var i=0;i<t.length;i++)for(var s=e[t[i].imageId],c=0;c<r.length;c++){var u=r[c];s&&s.brush&&s.brush.data&&s.brush.data[u]&&s.brush.data[u].pixelData&&o[c].push(i)}return{referencedFramesPerSegment:o,segmentIndicies:r}}(r,e,o),l=u.referencedFramesPerSegment,d=u.segmentIndicies,f=0,p=0;p<l.length;p++)f+=l[p].length;c.setNumberOfFrames(f);for(var g=0;g<d.length;g++){var m=d[g],h=l[g],y=h.map((function(e){return e+1})),I=o[m];c.addSegment(I,Se(m,h,r,e,i),y)}return c.bitPackPixelData(),Ie(c.dataset)},generateToolState:function(e,t,n){var o=Te.readFile(t),a=Ee.naturalizeDataset(o.dict);a._meta=Ee.namifyDataset(o.meta);var s=be.normalizeToDataset([a]),c=n.get("imagePlaneModule",e[0]);c||console.warn("Insufficient metadata, imagePlaneModule missing.");for(var u=function(e){var t=[];t[0]=e,t[1]=me.h(e),t[2]=me.v(e);var n=ge(e,Math.PI/2);return t[3]=n,t[4]=me.h(n),t[5]=me.v(n),t[6]=ge(e,Math.PI),t[7]=ge(e,1.5*Math.PI),t}(Array.isArray(c.rowCosines)?[].concat(v(c.rowCosines),v(c.columnCosines)):[c.rowCosines.x,c.rowCosines.y,c.rowCosines.z,c.columnCosines.x,c.columnCosines.y,c.columnCosines.z]),l=s.SharedFunctionalGroupsSequence,d=l.PlaneOrientationSequence?l.PlaneOrientationSequence.ImageOrientationPatient:void 0,f=s.Columns*s.Rows,p=function(e){var t=[],n=e.SegmentSequence;if(Array.isArray(n))for(var r=0;r<n.length;r++)t.push(n[r]);else t.push(n);return{seriesInstanceUid:e.ReferencedSeriesSequence.SeriesInstanceUID,data:t}}(s),g=function(e){var t=e.SegmentationType;if("BINARY"===t)return ve.unpack(e.PixelData);var n=new Uint8Array(e.PixelData),o=e.MaximumFractionalValue,a=void 0===n.find((function(e){return 0!==e&&e!==o}));if(!a)return void r.cM.warn("This is a fractional segmentation, which is not currently supported.");return r.cM.warn("This segmentation object is actually binary... processing as such."),n}(s),m=s.PerFrameFunctionalGroupsSequence,h={},y=!0,I=0;I<m.length;I++){var T=m[I],E=d||T.PlaneOrientationSequence.ImageOrientationPatient,b=_e(i()(new Uint8Array(g.buffer,I*f,f),[s.Rows,s.Columns]),E,u);if(!b){console.warn("This segmentation object is not in-plane with the source data. Bailing out of IO. It'd be better to render this with vtkjs. "),y=!1;break}var A=T.SegmentIdentificationSequence.ReferencedSegmentNumber-1;De(h,xe(l.DerivationImageSequence&&l.DerivationImageSequence.SourceImageSequence?l.DerivationImageSequence.SourceImageSequence[I]:T.DerivationImageSequence.SourceImageSequence,e,n),A,b)}if(!y)return;return{toolState:h,segMetadata:p}}};function Se(e,t,n,r,o){for(var a=new Uint8Array(o.xy*t.length),i=0,s=0;s<t.length;s++)for(var c=n[r[t[s]].imageId].brush.data[e].pixelData,u=0;u<c.length;u++)a[i]=c[u],i++;return a}function Ce(e,t){for(var n=0,r=0;r<t.length;r++)t[r]&&n++;return n}function De(e,t,n,r){e[t]?e[t].brush?e[t].brush.data||(e[t].brush.data=[]):(e[t].brush={},e[t].brush.data=[]):(e[t]={},e[t].brush={},e[t].brush.data=[]),e[t].brush.data[n]={};var o=e[t].brush.data[n];o.pixelData=new Uint8Array(r.data.length);for(var a=o.pixelData,i=0;i<a.length;i++)r.data[i]?a[i]=1:a[i]=0}function xe(e,t,n){var r=e.ReferencedSOPInstanceUID,o=e.ReferencedFrameNumber;return o?function(e,t,n,r){var o=n.find((function(n){var o=r.get("sopCommonModule",n);if(o){var a=Number(n.split("frame=")[1]);return o.sopInstanceUID===e&&a===t-1}}));return o}(r,o,t,n):function(e,t,n){return t.find((function(t){var r=n.get("sopCommonModule",t);if(r)return r.sopInstanceUID===e}))}(r,t,n)}function _e(e,t,n){return Ne(t,n[0])?e:Ne(t,n[1])?he.v(e):Ne(t,n[2])?he.h(e):Ne(t,n[3])?ye(e):Ne(t,n[4])?he.h(ye(e)):Ne(t,n[5])?he.v(ye(e)):Ne(t,n[6])?ye(ye(e)):Ne(t,n[7])?ye(ye(ye(e))):void 0}var we,Re=1e-5;function Ne(e,t){return Math.abs(e[0]-t[0])<Re&&Math.abs(e[1]-t[1])<Re&&Math.abs(e[2]-t[2])<Re&&Math.abs(e[3]-t[3])<Re&&Math.abs(e[4]-t[4])<Re&&Math.abs(e[5]-t[5])<Re}!function(e){e.SEGMENTATION_LOAD_PROGRESS="CORNERSTONE_ADAPTER_SEGMENTATION_LOAD_PROGRESS"}(we||(we={}));var Pe=we,Me=Object.freeze({__proto__:null,Events:Pe}),Le=r.hC.orientation,Fe=Le.rotateDirectionCosinesInPlane,Ue=Le.flipImageOrientationPatient,Ge=Le.flipMatrix2D,ke=Le.rotateMatrix902D,Ve=Le.nearlyEqual,je=r.aT.BitArray,Be=r.aT.DicomMessage,ze=r.aT.DicomMetaDictionary,qe=r.oq.Normalizer,He=r.U7.Segmentation,We=r.hC.compression,Ye=We.encode,$e=We.decode,Ke={includeSliceSpacing:!0,rleEncode:!1};function Xe(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},Ke,n),o=Array.isArray(t)?t:[t],a=0,i=[],s=function(){for(var e=o[c],t=e.labelmaps2D,n=e.metadata,r=[],s=1;s<n.length;s++)n[s]&&(r[s]=[]);for(var u=function(e){var n=t[e];t[e]&&n.segmentsOnLabelmap.forEach((function(t){0!==t&&(r[t].push(e),a++)}))},l=0;l<t.length;l++)u(l);i[c]=r},c=0;c<o.length;c++)s();e.setNumberOfFrames(a);for(var u=0;u<o.length;u++)for(var l=i[u],d=o[u],f=d.metadata,p=1;p<l.length;p++){var g=l[p];if(g){var m=g.map((function(e){return e+1})),h=f[p],y=Qe(d,g);e.addSegmentFromLabelmap(h,y,p,m)}}if(r.rleEncode){var I=Ye(e.dataset.PixelData,a,e.dataset.Rows,e.dataset.Columns);e.assignToDataset({BitsAllocated:"8",BitsStored:"8",HighBit:"7",SegmentationType:"FRACTIONAL",SegmentationFractionalType:"PROBABILITY",MaximumFractionalValue:"255"}),e.dataset._meta.TransferSyntaxUID={Value:["1.2.840.10008.1.2.5"],vr:"UI"},e.dataset._vrMap.PixelData="OB",e.dataset.PixelData=I}else e.bitPackPixelData();return e}function Qe(e,t){for(var n=e.labelmaps2D,r=[],o=0;o<t.length;o++){var a=t[o];r.push(n[a].pixelData)}return r}function Ze(){var e;return e=f().mark((function e(t,n,r,o){var a,i,s,c,u,l,d,p,g,m,h,y,I,T,E,b,A,O,S,C,D,x,_,w,R,N,P,M,L,F,U,G,k,V,j;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.skipOverlapping,i=void 0!==a&&a,s=o.tolerance,c=void 0===s?.001:s,u=o.TypedArrayConstructor,l=void 0===u?Uint8Array:u,d=o.maxBytesPerChunk,p=void 0===d?199e6:d,g=o.eventTarget,m=o.triggerEvent,h=Be.readFile(n),(y=ze.naturalizeDataset(h.dict))._meta=ze.namifyDataset(h.meta),I=qe.normalizeToDataset([y]),T=r.get("imagePlaneModule",t[0]),E=r.get("generalSeriesModule",t[0]),b=E.seriesInstanceUID,T||console.warn("Insufficient metadata, imagePlaneModule missing."),A=Array.isArray(T.rowCosines)?[].concat(v(T.rowCosines),v(T.columnCosines)):[T.rowCosines.x,T.rowCosines.y,T.rowCosines.z,T.columnCosines.x,T.columnCosines.y,T.columnCosines.z],O=it(A),S=I.Columns*I.Rows,C=ut(I,b),"1.2.840.10008.1.2.5"!==I._meta.TransferSyntaxUID.Value[0]){e.next=23;break}if(_=Array.isArray(I.PixelData)?I.PixelData:[I.PixelData],D=$e(_,I.Rows,I.Columns),1!==I.BitsStored){e.next=20;break}return console.warn("No implementation for rle + bitbacking."),e.abrupt("return");case 20:x=[D],e.next=26;break;case 23:if(x=at(I,{maxBytesPerChunk:p})){e.next=26;break}throw new Error("Fractional segmentations are not yet supported");case 26:w=ot(I,O,[T.rows,T.columns,t.length],c),R=t.reduce((function(e,t){return e[r.get("generalImageModule",t).sopInstanceUid]=t,e}),{}),N=!1,i||(N=et(x,I,t,O,r,c,l,R)),e.t0=w,e.next="Planar"===e.t0?33:"Perpendicular"===e.t0?35:"Oblique"===e.t0?36:37;break;case 33:return P=N?tt:rt,e.abrupt("break",37);case 35:throw new Error("Segmentations orthogonal to the acquisition plane of the source data are not yet supported.");case 36:throw new Error("Segmentations oblique to the acquisition plane of the source data are not yet supported.");case 37:return(M=[])[0]=[],L=[],F=S*t.length*l.BYTES_PER_ELEMENT,(U=[])[0]=new ArrayBuffer(F),G=t.reduce((function(e,t,n){return e.indices[t]=n,e.metadata[t]=r.get("instance",t),e}),{indices:{},metadata:{}}),k=new Map,e.next=47,P(L,M,U,x,I,t,O,r,c,l,k,R,G,g,m);case 47:return V=e.sent,j=new Map,k.forEach((function(e,t){var n=dt(e,I),r=n.xAcc,o=n.yAcc,a=n.zAcc,i=n.count;j.set(t,{x:Math.floor(r/i),y:Math.floor(o/i),z:Math.floor(a/i)})})),e.abrupt("return",{labelmapBufferArray:U,segMetadata:C,segmentsOnFrame:L,segmentsOnFrameArray:M,centroids:j,overlappingSegments:V});case 51:case"end":return e.stop()}}),e)})),Ze=function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){p(a,r,o,i,s,"next",e)}function s(e){p(a,r,o,i,s,"throw",e)}i(void 0)}))},Ze.apply(this,arguments)}function Je(e,t,n,r,o,a){var i=void 0;if(!e)return i;var s=e.FrameOfReferenceUID,c=e.PerFrameFunctionalGroupsSequence,u=e.SourceImageSequence,l=e.ReferencedSeriesSequence;if(!c||0===c.length)return i;var d=c[t];if(!d)return i;var f=void 0;if(d.DerivationImageSequence){var p=d.DerivationImageSequence;Array.isArray(p)&&(p=0!==p.length?p[0]:void 0),p&&(f=p.SourceImageSequence,Array.isArray(f)&&(f=0!==f.length?f[0]:void 0))}else u&&0!==u.length&&(console.warn("DerivationImageSequence not present, using SourceImageSequence assuming SEG has the same geometry as the source image."),f=u[t]);(f&&(i=function(e,t){var n=e.ReferencedSOPInstanceUID,r=e.ReferencedFrameNumber;return r?function(e,t,n){var r=n[e];if(!r)return;var o=Number(r.split("frame=")[1]);return o===t-1?r:void 0}(n,r,t):t[n]}(f,a)),void 0===i&&l)&&(i=function(e,t,n,r,o,a){if(void 0===e||void 0===n.PlanePositionSequence||void 0===n.PlanePositionSequence[0]||void 0===n.PlanePositionSequence[0].ImagePositionPatient)return;for(var i=0;i<r.length;++i){var s=o.get("instance",r[i]);if(void 0!==s&&void 0!==s.ImagePositionPatient&&s.FrameOfReferenceUID===t&&s.SeriesInstanceUID===e&&ct(n.PlanePositionSequence[0].ImagePositionPatient,s.ImagePositionPatient,a))return r[i]}}((Array.isArray(l)?l[0]:l).SeriesInstanceUID,s,d,n,r,o));return i}function et(e,t,n,r,o,a,s,c){var u=t.SharedFunctionalGroupsSequence,l=t.PerFrameFunctionalGroupsSequence,d=t.SegmentSequence,f=t.Rows,p=t.Columns;if(d.length<2)return!1;for(var g=u.PlaneOrientationSequence?u.PlaneOrientationSequence.ImageOrientationPatient:void 0,m=p*f,h=l.length,y=new Map,v=function(){if(void 0===nt(t,T))return console.warn("Could not retrieve the segment index for frame segment "+T+", skipping this frame."),0;var e=Je(t,T,n,o,a,c);if(!e)return console.warn("Image not present in stack, can't import frame : "+T+"."),0;var r=n.findIndex((function(t){return t===e}));if(y.has(r)){var i=y.get(r);i.includes(T)||(i.push(T),y.set(r,i))}else y.set(r,[T])},T=0;T<h;++T)v();var E,A=b(y.entries());try{for(A.s();!(E=A.n()).done;)for(var O=I(E.value,2)[1],S=new s(m).fill(0),C=0;C<O.length;++C){var D=O[C],x=l[D],_=g||x.PlaneOrientationSequence.ImageOrientationPatient,w=lt(e,D*m,m),R=st(i()(w,[f,p]),_,r,a);if(R){for(var N=R.data,P=0,M=N.length;P<M;++P)if(0!==N[P]&&(S[P]++,S[P]>1))return!0}else console.warn("Individual SEG frames are out of plane with respect to the first SEG frame, this is not yet supported, skipping this frame.")}}catch(e){A.e(e)}finally{A.f()}return!1}function tt(e,t,n,r,o,a,s,u,l,d,f,p){for(var g=o.SharedFunctionalGroupsSequence,m=o.PerFrameFunctionalGroupsSequence,h=o.Rows,y=o.Columns,I=g.PlaneOrientationSequence?g.PlaneOrientationSequence.ImageOrientationPatient:void 0,v=y*h,T=v*a.length*d.BYTES_PER_ELEMENT,E=1,b=0,A=n[b].slice(0),O=c()(t[b]),S=o.SegmentSequence.length,C=1;C<=S;++C){for(var D=function(f){var g=m[f],S=nt(o,f);if(void 0===S)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");if(S!==C)return x=f,0;var D=I||g.PlaneOrientationSequence.ImageOrientationPatient,_=lt(r,f*v,v),w=st(i()(_,[h,y]),D,s,l);if(!w)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");var R=Je(o,f,a,u,l,p);if(!R)return console.warn("Image not present in stack, can't import frame : "+f+"."),x=f,0;var N=u.get("instance",R);if(h!==N.Rows||y!==N.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");for(var P=a.findIndex((function(e){return e===R})),M=v*P*d.BYTES_PER_ELEMENT,L=new d(A,M,v),F=w.data,U=!1,G=0,k=w.data.length;G<k;++G)if(F[G]){if(0!==L[G]){++b>=E&&(n[b]=new ArrayBuffer(T),t[b]=[],E++),A=n[b].slice(0),O=c()(t[b]),f=0;break}L[G]=S,U=!0}U&&(O[P]||(O[P]=[]),O[P].push(S),e[P]||(e[P]=[]),e[P].push(S)),x=f},x=0,_=m.length;x<_;++x)D(x);n[b]=A.slice(0),t[b]=c()(O),A=n[b=0].slice(0),O=c()(t[b])}}var nt=function(e,t){var n=e.PerFrameFunctionalGroupsSequence,r=e.SharedFunctionalGroupsSequence,o=n[t];return o&&o.SegmentIdentificationSequence?o.SegmentIdentificationSequence.ReferencedSegmentNumber:r.SegmentIdentificationSequence?r.SegmentIdentificationSequence.ReferencedSegmentNumber:void 0};function rt(e,t,n,r,o,a,s,c,u,l,d,f,p,g,m){var h=o.SharedFunctionalGroupsSequence,y=o.PerFrameFunctionalGroupsSequence,I=o.Rows,v=o.Columns,T=h.PlaneOrientationSequence?h.PlaneOrientationSequence.ImageOrientationPatient:void 0,E=v*I,b=0,A=y.length,O=Math.ceil(A/10),S=m&&g,C=!1;return new Promise((function(t){!function h(){for(var D=Math.min(b+O,A);b<D;++b){var x=y[b],_=T||x.PlaneOrientationSequence.ImageOrientationPatient,w=lt(r,b*E,E),R=st(i()(w,[I,v]),_,s,u);if(!R)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");var N=nt(o,b);if(void 0===N)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");d.has(N)||d.set(N,{});var P=Je(o,b,a,c,u,f);if(P){var M=p.metadata[P];if(I!==M.Rows||v!==M.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");for(var L=p.indices[P],F=E*L*l.BYTES_PER_ELEMENT,U=new l(n[0],F,E),G=R.data,k=[],V=0,j=R.data.length;V<j;++V)if(G[V]){for(var B=V;B<j;++B)G[B]&&(C||0===U[B]||(C=!0),U[B]=N,k.push(B));e[L]||(e[L]=[]),e[L].push(N);break}var z=d.get(N);z[L]=k,d.set(N,z)}else console.warn("Image not present in stack, can't import frame : "+b+".")}if(S){var q=Math.round(b/A*100);m(g,Pe.SEGMENTATION_LOAD_PROGRESS,{percentComplete:q})}b<A?setTimeout(h,0):t(C)}()}))}function ot(e,t,n,r){var o=e.SharedFunctionalGroupsSequence,a=e.PerFrameFunctionalGroupsSequence,i=o.PlaneOrientationSequence?o.PlaneOrientationSequence.ImageOrientationPatient:void 0,s=a[0],c=i||s.PlaneOrientationSequence.ImageOrientationPatient;return t.some((function(e){return ct(c,e,r)}))?"Planar":function(e,t,n){var r=Math.abs(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),o=Math.abs(e[3]*t[3]+e[4]*t[4]+e[5]*t[5]);return(r<n||Math.abs(r-1)<n)&&(o<n||Math.abs(o-1)<n)}(c,t[0],r)&&n.includes(e.Rows)&&n.includes(e.Columns)?"Perpendicular":"Oblique"}function at(e,t){var n,o=e.SegmentationType;if(void 0===(n=Array.isArray(e.PixelData)?e.PixelData[0]:e.PixelData)&&r.cM.error("This segmentation pixeldata is undefined."),"BINARY"===o)return function(e,t){for(var n=new Uint8Array(e),r=[],o=8*t,a=Math.ceil(8*n.length/o),i=0;i<a;i++){var s=i*o,c=Math.min(s+o,8*n.length),u=Math.floor(s/8),l=Math.ceil(c/8),d=n.slice(u,l),f=je.unpack(d);r.push(f)}return r}(n,t.maxBytesPerChunk);var a=new Uint8Array(n),i=e.MaximumFractionalValue;return void 0===a.find((function(e){return 0!==e&&e!==i}))?(r.cM.warn("This segmentation object is actually binary... processing as such."),a):void 0}function it(e){var t=[];t[0]=e,t[1]=Ue.h(e),t[2]=Ue.v(e);var n=Fe(e,Math.PI/2);return t[3]=n,t[4]=Ue.h(n),t[5]=Ue.v(n),t[6]=Fe(e,Math.PI),t[7]=Fe(e,1.5*Math.PI),t}function st(e,t,n,r){return ct(t,n[0],r)?e:ct(t,n[1],r)?Ge.v(e):ct(t,n[2],r)?Ge.h(e):ct(t,n[3],r)?ke(e):ct(t,n[4],r)?ke(Ge.h(e)):ct(t,n[5],r)?ke(Ge.v(e)):ct(t,n[6],r)?ke(ke(e)):ct(t,n[7],r)?ke(ke(ke(e))):void 0}function ct(e,t,n){if(e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(!Ve(e[r],t[r],n))return!1;return!0}function ut(e,t){var n=e.SegmentSequence;return{seriesInstanceUid:t,data:Array.isArray(n)?[void 0].concat(v(n)):[void 0,n]}}function lt(e,t,n){var r=function(e,t,n){var r=e.reduce((function(e,t){return e+t.length}),0);if(t<0||t+n>r)throw new Error("Offset and length out of bounds");var o=0,a=t;for(;a>=e[o].length;)a-=e[o].length,o++;var i=o,s=a+n;for(;s>e[i].length;)s-=e[i].length,i++;return{start:{chunkIndex:o,offset:a},end:{chunkIndex:i,offset:s}}}(e,t,n);if(r.start.chunkIndex===r.end.chunkIndex)return new Uint8Array(e[r.start.chunkIndex].buffer,r.start.offset,n);for(var o=new Uint8Array(n),a=0,i=r.start.chunkIndex;i<=r.end.chunkIndex;i++){var s=i===r.start.chunkIndex?r.start.offset:0,c=i===r.end.chunkIndex?r.end.offset:e[i].length;o.set(new Uint8Array(e[i].buffer,s,c-s),a),a+=c-s}return o}function dt(e,t){for(var n=0,r=0,o=0,a=0,i=0,s=Object.entries(e);i<s.length;i++){var c=I(s[i],2),u=c[0],l=c[1],d=Number(u);if(l&&0!==l.length){var f,p=b(l);try{for(p.s();!(f=p.n()).done;){var g=f.value,m=Math.floor(g/t.Rows);n+=g%t.Rows,r+=m,o+=d,a++}}catch(e){p.e(e)}finally{p.f()}}}return{xAcc:n,yAcc:r,zAcc:o,count:a}}var ft={generateSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e[0].imageId.includes("?frame");return Xe(function(e,t,n){var r=[];if(t){var o=e[0].data.byteArray.buffer,a=Be.readFile(o),i=ze.naturalizeDataset(a.dict);i._meta=ze.namifyDataset(a.meta),r.push(i)}else for(var s=0;s<e.length;s++){var c=e[s].data.byteArray.buffer,u=Be.readFile(c),l=ze.naturalizeDataset(u.dict);l._meta=ze.namifyDataset(u.meta),r.push(l)}var d=qe.normalizeToDataset(r);return new He([d],n)}(e,r,n),t,n)},generateToolState:function(e,t,n,r){return Ze.apply(this,arguments)},fillSegmentation:Xe},pt={generateSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===r)return ft.generateSegmentation(e,t,n);if(3===r)return Oe.generateSegmentation(e,t,n);console.warn("No generateSegmentation adapater for cornerstone version ".concat(r,", exiting."))},generateToolState:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;if(4===a)return ft.generateToolState(e,t,n,r,o);if(3===a)return Oe.generateToolState(e,t,n);console.warn("No generateToolState adapater for cornerstone version ".concat(a,", exiting."))},fillSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===r)return ft.fillSegmentation(e,t,n);console.warn("No generateSegmentation adapater for cornerstone version ".concat(r,", exiting."))}};var gt={Length:z,FreehandRoi:H,Bidirectional:$,EllipticalRoi:Q,CircleRoi:ee,ArrowAnnotate:oe,MeasurementReport:k,CobbAngle:se,Angle:le,RectangleRoi:fe},mt={Segmentation:pt},ht=function(){return ht=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ht.apply(this,arguments)};function yt(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var It="Cornerstone3DTools@^0.1.0",vt={CodingSchemeDesignator:"CORNERSTONEJS",codeValues:{CORNERSTONEFREETEXT:"CORNERSTONEFREETEXT"}},Tt=r.hC.TID1500,Et=r.hC.addAccessors,bt=r.U7.StructuredReport,At=r.oq.Normalizer,Ot=Tt.TID1500MeasurementReport,St=Tt.TID1501MeasurementGroup,Ct=r.aT.DicomMetaDictionary,Dt={CodingSchemeDesignator:"DCM",CodeValue:"121071"},xt={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},_t={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},wt=function(e,t,n){var r=e.ConceptNameCodeSequence;if(r){var o=r.CodingSchemeDesignator,a=r.CodeValue;return o==t.CodingSchemeDesignator&&a==t.CodeValue||n&&o==n.CodingSchemeDesignator&&a==n.CodeValue}};function Rt(e,t,n,r){var o=t[e],a=Nt.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(o&&o.data&&o.data.length&&a){var i=o.data.map((function(e){return function(e,t,n,r,o){var a=r.getTID300RepresentationArguments(e,o);return a.ReferencedSOPSequence=n,new r.TID300Representation(a)}(e,0,n,a,r)}));return new St(i)}}var Nt=function(){function e(){}return e.getCornerstoneLabelFromDefaultState=function(e){var t=e.findingSites,n=void 0===t?[]:t,r=e.finding,o=vt.codeValues.CORNERSTONEFREETEXT,a=n.find((function(e){return e.CodeValue===o}));return a?a.CodeMeaning:r&&r.CodeValue===o?r.CodeMeaning:void 0},e.generateDatasetMeta=function(){var e=new Uint8Array(2);return e[1]=1,{FileMetaInformationVersion:{Value:[e.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[Ct.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}}},e.getSetupMeasurementData=function(t,n,r,o){var a=t.ContentSequence,i=O(a),s=i.find((function(e){return wt(e,Dt)})),c=i.filter((function(e){return wt(e,xt,_t)}))||[],u=i.find((function(e){return"NUM"===e.ValueType})),l=O(u.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),d=l.ContentSequence.ReferencedSOPSequence,f=d.ReferencedSOPInstanceUID,p=d.ReferencedFrameNumber,g=n[f],m=r.get("imagePlaneModule",g),h=s?Et(s.ConceptCodeSequence):void 0,y=c.map((function(e){return Et(e.ConceptCodeSequence)})),I={description:void 0,sopInstanceUid:f,annotation:{annotationUID:Ct.uid(),metadata:{toolName:o,referencedImageId:g,FrameOfReferenceUID:m.frameOfReferenceUID,label:""},data:void 0},finding:h,findingSites:y};return I.finding&&(I.description=I.finding.CodeMeaning),I.annotation.metadata.label=e.getCornerstoneLabelFromDefaultState(I),{defaultState:I,NUMGroup:u,SCOORDGroup:l,ReferencedSOPSequence:d,ReferencedSOPInstanceUID:f,ReferencedFrameNumber:p}},e.generateReport=function(t,n,r,o){var a=[],i={},s=[],c=e.generateDatasetMeta();Object.keys(t).forEach((function(o){var c=n.get("sopCommonModule",o),u=n.get("instance",o),l=c.sopInstanceUID,d=c.sopClassUID,f=u.SeriesInstanceUID;if(i[l]=f,!s.find((function(e){return e.SeriesInstanceUID===f}))){var p=e.generateDerivationSourceDataset(u);s.push(p)}var g=n.get("frameNumber",o),m=t[o],h=Object.keys(m),y={ReferencedSOPClassUID:d,ReferencedSOPInstanceUID:l,ReferencedFrameNumber:void 0};(u&&u.NumberOfFrames&&u.NumberOfFrames>1||At.isMultiframeSOPClassUID(d))&&(y.ReferencedFrameNumber=g);var I=[];h.forEach((function(e){var t=Rt(e,m,y,r);t&&I.push(t)})),a=a.concat(I)}));var u=new Ot({TID1501MeasurementGroups:a},o),l=new bt(s,o),d=u.contentItem(s,ht(ht({},o),{sopInstanceUIDsToSeriesInstanceUIDMap:i}));return l.dataset=Object.assign(l.dataset,d),l.dataset._meta=c,l},e.generateToolState=function(t,n,r,o,a){if("1500"!==t.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");var i=O(t.ContentSequence).find(S("Imaging Measurements")),s=O(i.ContentSequence).filter(S("Measurement Group")),c={},u=e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,l=[];return Object.keys(u).forEach((function(e){l.push(u[e]),c[e]=[]})),s.forEach((function(e){var i;try{var s=O(e.ContentSequence),u=s.find((function(e){return"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning})).TextValue,d=s.find((function(e){return"Tracking Unique Identifier"===e.ConceptNameCodeSequence.CodeMeaning})),f=null==d?void 0:d.UID,p=(null===(i=null==a?void 0:a.getToolClass)||void 0===i?void 0:i.call(a,e,t,l))||l.find((function(e){return e.isValidCornerstoneTrackingIdentifier(u)}));if(p){var g=p.getMeasurementData(e,n,r,o);g.TrackingUniqueIdentifier=f,console.log("=== ".concat(p.toolType," ===")),console.log(g),c[p.toolType].push(g)}}catch(t){console.warn("Unable to generate tool state for",e,t)}})),c},e.registerTool=function(t){e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[t.utilityToolType]=t,e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[t.toolType]=t,e.MEASUREMENT_BY_TOOLTYPE[t.toolType]=t.utilityToolType},e.CORNERSTONE_3D_TAG=It,e.MEASUREMENT_BY_TOOLTYPE={},e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={},e.generateDerivationSourceDataset=function(t){var n=e.generateDatasetMeta();return ht(ht({},t),{_meta:n,_vrMap:{PixelData:"OW"}})},e}(),Pt=r.hC.TID300.Point,Mt="ArrowAnnotate",Lt="".concat(It,":").concat(Mt),Ft=vt.codeValues,Ut=vt.CodingSchemeDesignator,Gt=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t,n,r,o){for(var a=Nt.getSetupMeasurementData(t,n,o,e.toolType),i=a.defaultState,s=a.SCOORDGroup,c=a.ReferencedFrameNumber,u=i.annotation.metadata.referencedImageId,l=i.annotation.metadata.label,d=s.GraphicData,f=[],p=0;p<d.length;p+=2){var g=r(u,[d[p],d[p+1]]);f.push(g)}if(1===f.length){var m=o.get("imagePixelModule",u),h=10,y=10;if(m)h=m.columns/10,y=m.rows/10;var I=r(u,[d[0]+h,d[1]+y]);f.push(I)}var v=i;return v.annotation.data={text:l,handles:{arrowFirst:!0,points:[f[0],f[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},frameNumber:c},v}},{key:"getTID300RepresentationArguments",value:function(e,t){var n=e.data,r=e.metadata,o=e.finding,a=e.findingSites,i=r.referencedImageId;if(!i)throw new Error("ArrowAnnotate.getTID300RepresentationArguments: referencedImageId is not defined");var s=n.handles,c=s.points,u=t(i,s.arrowFirst?c[0]:c[1]),l={points:[{x:u[0],y:u[1]}],trackingIdentifierTextValue:Lt,findingSites:a||[]};return o&&o.CodeValue===Ft.CORNERSTONEFREETEXT||(o={CodeValue:Ft.CORNERSTONEFREETEXT,CodingSchemeDesignator:Ut,CodeMeaning:n.text}),l.finding=o,l}}]),e}();Gt.toolType=Mt,Gt.utilityToolType=Mt,Gt.TID300Representation=Pt,Gt.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===It&&r===Mt},Nt.registerTool(Gt);var kt=r.hC.TID300.Bidirectional,Vt="Bidirectional",jt="".concat(It,":").concat(Vt),Bt=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){var a,i=Nt.getSetupMeasurementData(t,n,o,e.toolType),s=i.defaultState,c=i.ReferencedFrameNumber,u=s.annotation.metadata.referencedImageId,l=t.ContentSequence,d=O(l).find((function(e){return"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning})),f=O(d.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),p=O(l).find((function(e){return"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning})),g=O(p.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),m=[];[f,g].forEach((function(e){for(var t=e.GraphicData,n=0;n<t.length;n+=2){var o=r(u,[t[n],t[n+1]]);m.push(o)}}));var h=s;return h.annotation.data={handles:{points:[m[0],m[1],m[2],m[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(a={},a["imageId:".concat(u)]={length:d.MeasuredValueSequence.NumericValue,width:p.MeasuredValueSequence.NumericValue},a),frameNumber:c},h},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.cachedStats,s=void 0===i?{}:i,c=n.handles,u=a.referencedImageId;if(!u)throw new Error("Bidirectional.getTID300RepresentationArguments: referencedImageId is not defined");var l,d,f=s["imageId:".concat(u)]||{},p=f.length,g=f.width,m=c.points,h=[m[0],m[1]],y=[m[2],m[3]];Math.sqrt(Math.pow(h[0][0]-h[1][0],2)+Math.pow(h[0][1]-h[1][1],2)+Math.pow(h[0][2]-h[1][2],2))>Math.sqrt(Math.pow(y[0][0]-y[1][0],2)+Math.pow(y[0][1]-y[1][1],2)+Math.pow(y[0][2]-y[1][2],2))?(l=h,d=y):(l=y,d=h);var I=t(u,l[0]),v=t(u,l[1]),T=t(u,d[0]),E=t(u,d[1]);return{longAxis:{point1:{x:I[0],y:I[1]},point2:{x:v[0],y:v[1]}},shortAxis:{point1:{x:T[0],y:T[1]},point2:{x:E[0],y:E[1]}},longAxisLength:p,shortAxisLength:g,trackingIdentifierTextValue:jt,finding:r,findingSites:o||[]}},e.toolType=Vt,e.utilityToolType=Vt,e.TID300Representation=kt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r===Vt},e}();Nt.registerTool(Bt);var zt=r.hC.TID300.CobbAngle,qt="Angle",Ht="".concat(It,":").concat(qt),Wt=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a,i=Nt.getSetupMeasurementData(t,n,o,e.toolType),s=i.defaultState,c=i.NUMGroup,u=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=u.GraphicData,p=[],g=0;g<f.length;g+=2){var m=r(d,[f[g],f[g+1]]);p.push(m)}var h=s;return h.annotation.data={handles:{points:[p[0],p[1],p[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(a={},a["imageId:".concat(d)]={angle:c?c.MeasuredValueSequence.NumericValue:null},a),frameNumber:l},h},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.cachedStats,s=void 0===i?{}:i,c=n.handles,u=a.referencedImageId;if(!u)throw new Error("Angle.getTID300RepresentationArguments: referencedImageId is not defined");var l=t(u,c.points[0]),d=t(u,c.points[1]),f=t(u,c.points[2]),p={x:l[0],y:l[1]},g={x:d[0],y:d[1]};return{point1:p,point2:g,point3:g,point4:{x:f[0],y:f[1]},rAngle:(s["imageId:".concat(u)]||{}).angle,trackingIdentifierTextValue:Ht,finding:r,findingSites:o||[]}},e.toolType=qt,e.utilityToolType=qt,e.TID300Representation=zt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r===qt},e}();Nt.registerTool(Wt);var Yt=r.hC.TID300.CobbAngle,$t="CobbAngle",Kt="".concat(It,":").concat($t),Xt=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a,i=Nt.getSetupMeasurementData(t,n,o,e.toolType),s=i.defaultState,c=i.NUMGroup,u=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=u.GraphicData,p=[],g=0;g<f.length;g+=2){var m=r(d,[f[g],f[g+1]]);p.push(m)}var h=s;return h.annotation.data={handles:{points:[p[0],p[1],p[2],p[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(a={},a["imageId:".concat(d)]={angle:c?c.MeasuredValueSequence.NumericValue:null},a),frameNumber:l},h},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.cachedStats,s=void 0===i?{}:i,c=n.handles,u=a.referencedImageId;if(!u)throw new Error("CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined");var l=t(u,c.points[0]),d=t(u,c.points[1]),f=t(u,c.points[2]),p=t(u,c.points[3]);return{point1:{x:l[0],y:l[1]},point2:{x:d[0],y:d[1]},point3:{x:f[0],y:f[1]},point4:{x:p[0],y:p[1]},rAngle:(s["imageId:".concat(u)]||{}).angle,trackingIdentifierTextValue:Kt,finding:r,findingSites:o||[]}},e.toolType=$t,e.utilityToolType=$t,e.TID300Representation=Yt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r===$t},e}();function Qt(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r.toLowerCase()===this.toolType.toLowerCase()}Nt.registerTool(Xt);var Zt=r.hC.TID300.Circle,Jt="CircleROI",en=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a,i=Nt.getSetupMeasurementData(t,n,o,e.toolType),s=i.defaultState,c=i.NUMGroup,u=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=u.GraphicData,p=[],g=0;g<f.length;g+=2){var m=r(d,[f[g],f[g+1]]);p.push(m)}var h=s;return h.annotation.data={handles:{points:yt([],p,!0),activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(a={},a["imageId:".concat(d)]={area:c?c.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},a),frameNumber:l},h},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.cachedStats,s=void 0===i?{}:i,c=n.handles,u=a.referencedImageId;if(!u)throw new Error("CircleROI.getTID300RepresentationArguments: referencedImageId is not defined");var l=t(u,c.points[0]),d=t(u,c.points[1]),f=[];f.push({x:l[0],y:l[1]}),f.push({x:d[0],y:d[1]});var p=s["imageId:".concat(u)]||{},g=p.area,m=p.radius;return{area:g,perimeter:2*Math.PI*m,radius:m,points:f,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:r,findingSites:o||[]}},e.trackingIdentifierTextValue="".concat(It,":").concat(Jt),e.toolType=Jt,e.utilityToolType=Jt,e.TID300Representation=Zt,e.isValidCornerstoneTrackingIdentifier=Qt,e}();Nt.registerTool(en);var tn=r.hC.TID300.Ellipse,nn="EllipticalROI",rn=1e-4,on=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a,i=Nt.getSetupMeasurementData(t,n,o,e.toolType),s=i.defaultState,c=i.NUMGroup,l=i.SCOORDGroup,d=i.ReferencedFrameNumber,f=s.annotation.metadata.referencedImageId,p=l.GraphicData,g=[],m=0;m<p.length;m+=2){var h=r(f,[p[m],p[m+1]]);g.push(h)}var y=u.R3.fromValues.apply(u.R3,g[0]),I=u.R3.fromValues.apply(u.R3,g[1]),v=u.R3.fromValues.apply(u.R3,g[2]),T=u.R3.fromValues.apply(u.R3,g[3]),E=u.R3.create();u.R3.sub(E,I,y),u.R3.normalize(E,E);var b=u.R3.create();u.R3.sub(b,T,v),u.R3.normalize(b,b);var A=o.get("imagePlaneModule",f);if(!A)throw new Error("imageId does not have imagePlaneModule metadata");var O=A.columnCosines,S=u.R3.fromValues(O[0],O[1],O[2]),C=u.R3.dot(S,E),D=u.R3.dot(S,b),x=Math.abs(C),_=Math.abs(D),w=[];Math.abs(x-1)<rn?w=[g[0],g[1],g[2],g[3]]:Math.abs(_-1)<rn?w=[g[2],g[3],g[0],g[1]]:console.warn("OBLIQUE ELLIPSE NOT YET SUPPORTED");var R=s;return R.annotation.data={handles:{points:yt([],w,!0),activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(a={},a["imageId:".concat(f)]={area:c?c.MeasuredValueSequence.NumericValue:0},a),frameNumber:d},R},e.getTID300RepresentationArguments=function(e,t){var n,r,o,a,i=e.data,s=e.finding,c=e.findingSites,u=e.metadata,l=i.cachedStats,d=void 0===l?{}:l,f=i.handles,p=i.initialRotation||0,g=u.referencedImageId;if(!g)throw new Error("EllipticalROI.getTID300RepresentationArguments: referencedImageId is not defined");90==p||270==p?(r=t(g,f.points[2]),n=t(g,f.points[3]),o=t(g,f.points[0]),a=t(g,f.points[1])):(n=t(g,f.points[0]),r=t(g,f.points[1]),o=t(g,f.points[2]),a=t(g,f.points[3]));var m=[];return Math.abs(n[1]-r[1])>Math.abs(o[0]-a[0])?(m.push({x:n[0],y:n[1]}),m.push({x:r[0],y:r[1]}),m.push({x:o[0],y:o[1]}),m.push({x:a[0],y:a[1]})):(m.push({x:o[0],y:o[1]}),m.push({x:a[0],y:a[1]}),m.push({x:n[0],y:n[1]}),m.push({x:r[0],y:r[1]})),{area:(d["imageId:".concat(g)]||{}).area,points:m,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:s,findingSites:c||[]}},e.trackingIdentifierTextValue="".concat(It,":").concat(nn),e.toolType=nn,e.utilityToolType=nn,e.TID300Representation=tn,e.isValidCornerstoneTrackingIdentifier=Qt,e}();Nt.registerTool(on);var an=r.hC.TID300.Polyline,sn="RectangleROI",cn="".concat(It,":").concat(sn),un=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a,i=Nt.getSetupMeasurementData(t,n,o,e.toolType),s=i.defaultState,c=i.NUMGroup,u=i.SCOORDGroup,l=i.ReferencedFrameNumber,d=s.annotation.metadata.referencedImageId,f=u.GraphicData,p=[],g=0;g<f.length;g+=2){var m=r(d,[f[g],f[g+1]]);p.push(m)}var h=s;return h.annotation.data={handles:{points:[p[0],p[1],p[3],p[2]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(a={},a["imageId:".concat(d)]={area:c?c.MeasuredValueSequence.NumericValue:null},a),frameNumber:l},h},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.cachedStats,s=void 0===i?{}:i,c=n.handles,u=a.referencedImageId;if(!u)throw new Error("CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined");var l=c.points.map((function(e){return t(u,e)})),d=s.area,f=s.perimeter;return{points:[l[0],l[1],l[3],l[2],l[0]],area:d,perimeter:f,trackingIdentifierTextValue:cn,finding:r,findingSites:o||[]}},e.toolType=sn,e.utilityToolType=sn,e.TID300Representation=an,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r===sn},e}();Nt.registerTool(un);var ln=r.hC.TID300.Length,dn="Length",fn="".concat(It,":").concat(dn),pn=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t,n,r,o){for(var a=Nt.getSetupMeasurementData(t,n,o,e.toolType),i=a.defaultState,s=a.NUMGroup,c=a.SCOORDGroup,u=a.ReferencedFrameNumber,l=i.annotation.metadata.referencedImageId,d=c.GraphicData,f=[],p=0;p<d.length;p+=2){var g=r(l,[d[p],d[p+1]]);f.push(g)}var m=i;return m.annotation.data={handles:{points:[f[0],f[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:y({},"imageId:".concat(l),{length:s?s.MeasuredValueSequence.NumericValue:0}),frameNumber:u},m}},{key:"getTID300RepresentationArguments",value:function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.cachedStats,s=void 0===i?{}:i,c=n.handles,u=a.referencedImageId;if(!u)throw new Error("Length.getTID300RepresentationArguments: referencedImageId is not defined");var l=t(u,c.points[0]),d=t(u,c.points[1]);return{point1:{x:l[0],y:l[1]},point2:{x:d[0],y:d[1]},distance:(s["imageId:".concat(u)]||{}).length,trackingIdentifierTextValue:fn,finding:r,findingSites:o||[]}}}]),e}();pn.toolType=dn,pn.utilityToolType=dn,pn.TID300Representation=ln,pn.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===It&&r===dn},Nt.registerTool(pn);var gn=r.hC.TID300.Polyline,mn="PlanarFreehandROI",hn="".concat(It,":").concat(mn),yn=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a=Nt.getSetupMeasurementData(t,n,o,e.toolType),i=a.defaultState,s=a.SCOORDGroup,c=a.ReferencedFrameNumber,l=i.annotation.metadata.referencedImageId,d=s.GraphicData,f=[],p=0;p<d.length;p+=2){var g=r(l,[d[p],d[p+1]]);f.push(g)}var m=!0;u.R3.distance(f[f.length-1],f[0])<1e-5&&(f.pop(),m=!1);var h=[];m&&h.push(f[0],f[f.length-1]);var y=i;return y.annotation.data={polyline:f,isOpenContour:m,handles:{points:h,activeHandleIndex:null,textBox:{hasMoved:!1}},frameNumber:c},y},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.isOpenContour,s=n.polyline,c=a.referencedImageId;if(!c)throw new Error("PlanarFreehandROI.getTID300RepresentationArguments: referencedImageId is not defined");var u=s.map((function(e){return t(c,e)}));if(!i){var l=u[0];u.push([l[0],l[1]])}return{points:u,area:0,perimeter:0,trackingIdentifierTextValue:hn,finding:r,findingSites:o||[]}},e.toolType=mn,e.utilityToolType=mn,e.TID300Representation=gn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r===mn},e}();Nt.registerTool(yn);var In=r.hC.TID300.Point,vn="Probe",Tn="".concat(It,":").concat(vn),En=function(){function e(){g(this,e)}return h(e,null,[{key:"getMeasurementData",value:function(t,n,r,o){for(var a=Nt.getSetupMeasurementData(t,n,o,e.toolType),i=a.defaultState,s=a.SCOORDGroup,c=a.ReferencedFrameNumber,u=i.annotation.metadata.referencedImageId,l=s.GraphicData,d=[],f=0;f<l.length;f+=2){var p=r(u,[l[f],l[f+1]]);d.push(p)}var g=i;return g.annotation.data={handles:{points:d,activeHandleIndex:null,textBox:{hasMoved:!1}},frameNumber:c},g}},{key:"getTID300RepresentationArguments",value:function(e,t){var n=e.data,r=e.metadata,o=e.finding,a=e.findingSites,i=r.referencedImageId;if(!i)throw new Error("Probe.getTID300RepresentationArguments: referencedImageId is not defined");return{points:n.handles.points.map((function(e){var n=t(i,e);return{x:n[0],y:n[1]}})),trackingIdentifierTextValue:Tn,findingSites:a||[],finding:o}}}]),e}();En.toolType=vn,En.utilityToolType=vn,En.TID300Representation=In,En.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=I(e.split(":"),2),n=t[0],r=t[1];return n===It&&r===vn},Nt.registerTool(En);var bn=r.hC.TID300.Length,An="UltrasoundDirectionalTool",On="".concat(It,":").concat(An),Sn=function(){function e(){}return e.getMeasurementData=function(t,n,r,o){for(var a=Nt.getSetupMeasurementData(t,n,o,e.toolType),i=a.defaultState,s=a.SCOORDGroup,c=a.ReferencedFrameNumber,u=i.annotation.metadata.referencedImageId,l=s.GraphicData,d=[],f=0;f<l.length;f+=2){var p=r(u,[l[f],l[f+1]]);d.push(p)}var g=i;return g.annotation.data={handles:{points:[d[0],d[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:{},frameNumber:c},g},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,o=e.findingSites,a=e.metadata,i=n.handles,s=a.referencedImageId;if(!s)throw new Error("UltrasoundDirectionalTool.getTID300RepresentationArguments: referencedImageId is not defined");var c=t(s,i.points[0]),u=t(s,i.points[1]);return{point1:{x:c[0],y:c[1]},point2:{x:u[0],y:u[1]},trackingIdentifierTextValue:On,finding:r,findingSites:o||[]}},e.toolType=An,e.utilityToolType=An,e.TID300Representation=bn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===It&&r===An},e}();Nt.registerTool(Sn);var Cn=r.oq.Normalizer,Dn=r.U7.Segmentation;var xn=mt.Segmentation.generateToolState;var _n,wn=Object.freeze({__proto__:null,generateLabelMaps2DFrom3D:function(e){for(var t=e.scalarData,n=e.dimensions,r=[],o=new Set,a=0;a<n[2];a++){for(var i=t.slice(a*n[0]*n[1],(a+1)*n[0]*n[1]),s=[],c=0;c<i.length;c++){var u=i[c];s.includes(u)||0===u||s.push(u)}var l={segmentsOnLabelmap:s,pixelData:i,rows:n[1],columns:n[0]};0!==s.length&&(s.forEach((function(e){o.add(e)})),r[n[2]-1-a]=l)}return e.segmentsOnLabelmap=Array.from(o),e.labelmaps2D=r,e},generateSegmentation:function(e,t,n,r){return void 0===r&&(r={}),Xe(function(e,t,n){var r=e.map((function(e){var n=t.get("instance",e.imageId);return ht(ht(ht({},e),n),{SOPClassUID:n.SopClassUID||n.SOPClassUID,SOPInstanceUID:n.SopInstanceUID||n.SOPInstanceUID,PixelData:e.getPixelData(),_vrMap:{PixelData:"OW"},_meta:{}})})),o=Cn.normalizeToDataset(r);return new Dn([o],n)}(e,n,r),t,r)},generateToolState:function(e,t,n,r,o){return void 0===r&&(r=!1),void 0===o&&(o=.001),xn(e,t,n,r,o)}});!function(e){e.CACHE_SIZE_EXCEEDED="CACHE_SIZE_EXCEEDED",e.IMAGE_LOAD_ERROR="IMAGE_LOAD_ERROR",e.CAMERA_MODIFIED="CORNERSTONE_CAMERA_MODIFIED",e.CAMERA_RESET="CORNERSTONE_CAMERA_RESET",e.VOI_MODIFIED="CORNERSTONE_VOI_MODIFIED",e.DISPLAY_AREA_MODIFIED="CORNERSTONE_DISPLAY_AREA_MODIFIED",e.ELEMENT_DISABLED="CORNERSTONE_ELEMENT_DISABLED",e.ELEMENT_ENABLED="CORNERSTONE_ELEMENT_ENABLED",e.IMAGE_RENDERED="CORNERSTONE_IMAGE_RENDERED",e.IMAGE_VOLUME_MODIFIED="CORNERSTONE_IMAGE_VOLUME_MODIFIED",e.IMAGE_VOLUME_LOADING_COMPLETED="CORNERSTONE_IMAGE_VOLUME_LOADING_COMPLETED",e.IMAGE_LOADED="CORNERSTONE_IMAGE_LOADED",e.IMAGE_RETRIEVAL_STAGE="CORNERSTONE_IMAGE_RETRIEVAL_STAGE",e.IMAGE_LOAD_FAILED="CORNERSTONE_IMAGE_LOAD_FAILED",e.VOLUME_VIEWPORT_NEW_VOLUME="CORNERSTONE_VOLUME_VIEWPORT_NEW_VOLUME",e.VOLUME_LOADED="CORNERSTONE_VOLUME_LOADED",e.VOLUME_LOADED_FAILED="CORNERSTONE_VOLUME_LOADED_FAILED",e.IMAGE_CACHE_IMAGE_ADDED="CORNERSTONE_IMAGE_CACHE_IMAGE_ADDED",e.IMAGE_CACHE_IMAGE_REMOVED="CORNERSTONE_IMAGE_CACHE_IMAGE_REMOVED",e.VOLUME_CACHE_VOLUME_ADDED="CORNERSTONE_VOLUME_CACHE_VOLUME_ADDED",e.VOLUME_CACHE_VOLUME_REMOVED="CORNERSTONE_VOLUME_CACHE_VOLUME_REMOVED",e.STACK_NEW_IMAGE="CORNERSTONE_STACK_NEW_IMAGE",e.VOLUME_NEW_IMAGE="CORNERSTONE_VOLUME_NEW_IMAGE",e.PRE_STACK_NEW_IMAGE="CORNERSTONE_PRE_STACK_NEW_IMAGE",e.IMAGE_SPACING_CALIBRATED="CORNERSTONE_IMAGE_SPACING_CALIBRATED",e.STACK_VIEWPORT_NEW_STACK="CORNERSTONE_STACK_VIEWPORT_NEW_STACK",e.STACK_VIEWPORT_SCROLL="CORNERSTONE_STACK_VIEWPORT_SCROLL",e.GEOMETRY_CACHE_GEOMETRY_ADDED="CORNERSTONE_GEOMETRY_CACHE_GEOMETRY_ADDED",e.VOLUME_SCROLL_OUT_OF_BOUNDS="CORNERSTONE_VOLUME_SCROLL_OUT_OF_BOUNDS",e.CLIPPING_PLANES_UPDATED="CORNERSTONE_CLIPPING_PLANES_UPDATED"}(_n||(_n={}));var Rn,Nn=_n;!function(e){e.TRUE="true",e.FALSE="false",e.AUTO="auto"}(Rn||(Rn={}));var Pn=Rn;const Mn=new class{constructor(){this.listeners={}}reset(){this.listeners={}}addEventListenerOnce(e,t){const n=r=>{this.removeEventListener(e,n),t.call(this,r)};this.addEventListener(e,n)}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),-1===this.listeners[e].indexOf(t)&&this.listeners[e].push(t)}removeEventListener(e,t){if(!this.listeners[e])return;const n=this.listeners[e],r=n.length;for(let e=0;e<r;e++)if(n[e]===t)return void n.splice(e,1)}dispatchEvent(e){if(!this.listeners[e.type])return;const t=this.listeners[e.type].slice(),n=t.length;for(let r=0;r<n;r++)try{t[r].call(this,e)}catch(t){console.error(`error in event listener of type:  ${e.type}`,t)}return!e.defaultPrevented}};var Ln=Mn,Fn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function Un(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Gn(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var kn,Vn,jn=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,o,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(o=r;0!=o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=r;0!=o--;)if(!Object.prototype.hasOwnProperty.call(n,a[o]))return!1;for(o=r;0!=o--;){var i=a[o];if(!e(t[i],n[i]))return!1}return!0}return t!=t&&n!=n},Bn=Un(jn),zn=Object.prototype.toString,qn=function(e){var t=zn.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===zn.call(e.callee)),n};var Hn=Array.prototype.slice,Wn=qn,Yn=Object.keys,$n=Yn?function(e){return Yn(e)}:function(){if(Vn)return kn;var e;if(Vn=1,!Object.keys){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=qn,o=Object.prototype.propertyIsEnumerable,a=!o.call({toString:null},"toString"),i=o.call((function(){}),"prototype"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],c=function(e){var t=e.constructor;return t&&t.prototype===e},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},l=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!u["$"+e]&&t.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{c(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();e=function(e){var o=null!==e&&"object"==typeof e,u="[object Function]"===n.call(e),d=r(e),f=o&&"[object String]"===n.call(e),p=[];if(!o&&!u&&!d)throw new TypeError("Object.keys called on a non-object");var g=i&&u;if(f&&e.length>0&&!t.call(e,0))for(var m=0;m<e.length;++m)p.push(String(m));if(d&&e.length>0)for(var h=0;h<e.length;++h)p.push(String(h));else for(var y in e)g&&"prototype"===y||!t.call(e,y)||p.push(String(y));if(a)for(var I=function(e){if("undefined"==typeof window||!l)return c(e);try{return c(e)}catch(e){return!1}}(e),v=0;v<s.length;++v)I&&"constructor"===s[v]||!t.call(e,s[v])||p.push(s[v]);return p}}return kn=e}(),Kn=Object.keys;$n.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return Wn(e)?Kn(Hn.call(e)):Kn(e)})}else Object.keys=$n;return Object.keys||$n};var Xn,Qn=$n,Zn="undefined"!=typeof Symbol&&Symbol,Jn=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0},er={foo:{}},tr=Object,nr=Object.prototype.toString,rr=Math.max,or=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var o=0;o<t.length;o+=1)n[o+e.length]=t[o];return n},ar=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==nr.apply(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n,r=function(e,t){for(var n=[],r=t||0,o=0;r<e.length;r+=1,o+=1)n[o]=e[r];return n}(arguments,1),o=rr(0,t.length-r.length),a=[],i=0;i<o;i++)a[i]="$"+i;if(n=Function("binder","return function ("+function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n}(a,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof n){var o=t.apply(this,or(r,arguments));return Object(o)===o?o:this}return t.apply(e,or(r,arguments))})),t.prototype){var s=function(){};s.prototype=t.prototype,n.prototype=new s,s.prototype=null}return n},ir=Function.prototype.bind||ar,sr=Function.prototype.call,cr=Object.prototype.hasOwnProperty,ur=ir.call(sr,cr),lr=SyntaxError,dr=Function,fr=TypeError,pr=function(e){try{return dr('"use strict"; return ('+e+").constructor;")()}catch(e){}},gr=Object.getOwnPropertyDescriptor;if(gr)try{gr({},"")}catch(e){gr=null}var mr=function(){throw new fr},hr=gr?function(){try{return mr}catch(e){try{return gr(arguments,"callee").get}catch(e){return mr}}}():mr,yr="function"==typeof Zn&&"function"==typeof Symbol&&"symbol"==typeof Zn("foo")&&"symbol"==typeof Symbol("bar")&&Jn(),Ir={__proto__:er}.foo===er.foo&&!({__proto__:null}instanceof tr),vr=Object.getPrototypeOf||(Ir?function(e){return e.__proto__}:null),Tr={},Er="undefined"!=typeof Uint8Array&&vr?vr(Uint8Array):Xn,br={"%AggregateError%":"undefined"==typeof AggregateError?Xn:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?Xn:ArrayBuffer,"%ArrayIteratorPrototype%":yr&&vr?vr([][Symbol.iterator]()):Xn,"%AsyncFromSyncIteratorPrototype%":Xn,"%AsyncFunction%":Tr,"%AsyncGenerator%":Tr,"%AsyncGeneratorFunction%":Tr,"%AsyncIteratorPrototype%":Tr,"%Atomics%":"undefined"==typeof Atomics?Xn:Atomics,"%BigInt%":"undefined"==typeof BigInt?Xn:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?Xn:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?Xn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?Xn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?Xn:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?Xn:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?Xn:FinalizationRegistry,"%Function%":dr,"%GeneratorFunction%":Tr,"%Int8Array%":"undefined"==typeof Int8Array?Xn:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?Xn:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?Xn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":yr&&vr?vr(vr([][Symbol.iterator]())):Xn,"%JSON%":"object"==typeof JSON?JSON:Xn,"%Map%":"undefined"==typeof Map?Xn:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&yr&&vr?vr((new Map)[Symbol.iterator]()):Xn,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?Xn:Promise,"%Proxy%":"undefined"==typeof Proxy?Xn:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?Xn:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?Xn:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&yr&&vr?vr((new Set)[Symbol.iterator]()):Xn,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?Xn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":yr&&vr?vr(""[Symbol.iterator]()):Xn,"%Symbol%":yr?Symbol:Xn,"%SyntaxError%":lr,"%ThrowTypeError%":hr,"%TypedArray%":Er,"%TypeError%":fr,"%Uint8Array%":"undefined"==typeof Uint8Array?Xn:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?Xn:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?Xn:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?Xn:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?Xn:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?Xn:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?Xn:WeakSet};if(vr)try{null.error}catch(e){var Ar=vr(vr(e));br["%Error.prototype%"]=Ar}var Or=function e(t){var n;if("%AsyncFunction%"===t)n=pr("async function () {}");else if("%GeneratorFunction%"===t)n=pr("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=pr("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&vr&&(n=vr(o.prototype))}return br[t]=n,n},Sr={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Cr=ir,Dr=ur,xr=Cr.call(Function.call,Array.prototype.concat),_r=Cr.call(Function.apply,Array.prototype.splice),wr=Cr.call(Function.call,String.prototype.replace),Rr=Cr.call(Function.call,String.prototype.slice),Nr=Cr.call(Function.call,RegExp.prototype.exec),Pr=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Mr=/\\(\\)?/g,Lr=function(e,t){var n,r=e;if(Dr(Sr,r)&&(r="%"+(n=Sr[r])[0]+"%"),Dr(br,r)){var o=br[r];if(o===Tr&&(o=Or(r)),void 0===o&&!t)throw new fr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new lr("intrinsic "+e+" does not exist!")},Fr=function(e,t){if("string"!=typeof e||0===e.length)throw new fr("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new fr('"allowMissing" argument must be a boolean');if(null===Nr(/^%?[^%]*%?$/,e))throw new lr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=Rr(e,0,1),n=Rr(e,-1);if("%"===t&&"%"!==n)throw new lr("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new lr("invalid intrinsic syntax, expected opening `%`");var r=[];return wr(e,Pr,(function(e,t,n,o){r[r.length]=n?wr(o,Mr,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",o=Lr("%"+r+"%",t),a=o.name,i=o.value,s=!1,c=o.alias;c&&(r=c[0],_r(n,xr([0,1],c)));for(var u=1,l=!0;u<n.length;u+=1){var d=n[u],f=Rr(d,0,1),p=Rr(d,-1);if(('"'===f||"'"===f||"`"===f||'"'===p||"'"===p||"`"===p)&&f!==p)throw new lr("property names with quotes must have matching quotes");if("constructor"!==d&&l||(s=!0),Dr(br,a="%"+(r+="."+d)+"%"))i=br[a];else if(null!=i){if(!(d in i)){if(!t)throw new fr("base intrinsic for "+e+" exists, but the property is not available.");return}if(gr&&u+1>=n.length){var g=gr(i,d);i=(l=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:i[d]}else l=Dr(i,d),i=i[d];l&&!s&&(br[a]=i)}}return i},Ur=Fr("%Object.defineProperty%",!0),Gr=function(){if(Ur)try{return Ur({},"a",{value:1}),!0}catch(e){return!1}return!1};Gr.hasArrayLengthDefineBug=function(){if(!Gr())return null;try{return 1!==Ur([],"length",{value:1}).length}catch(e){return!0}};var kr,Vr,jr=Gr;var Br=jr(),zr=Fr,qr=Br&&zr("%Object.defineProperty%",!0);if(qr)try{qr({},"a",{value:1})}catch(e){qr=!1}var Hr=zr("%SyntaxError%"),Wr=zr("%TypeError%"),Yr=function(){if(Vr)return kr;Vr=1;var e=Fr("%Object.getOwnPropertyDescriptor%",!0);if(e)try{e([],"length")}catch(t){e=null}return kr=e}(),$r=Qn,Kr="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),Xr=Object.prototype.toString,Qr=Array.prototype.concat,Zr=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new Wr("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new Wr("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new Wr("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new Wr("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new Wr("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new Wr("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,o=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,i=arguments.length>6&&arguments[6],s=!!Yr&&Yr(e,t);if(qr)qr(e,t,{configurable:null===a&&s?s.configurable:!a,enumerable:null===r&&s?s.enumerable:!r,value:n,writable:null===o&&s?s.writable:!o});else{if(!i&&(r||o||a))throw new Hr("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}},Jr=jr(),eo=function(e,t,n,r){if(t in e)if(!0===r){if(e[t]===n)return}else if("function"!=typeof(o=r)||"[object Function]"!==Xr.call(o)||!r())return;var o;Jr?Zr(e,t,n,!0):Zr(e,t,n)},to=function(e,t){var n=arguments.length>2?arguments[2]:{},r=$r(t);Kr&&(r=Qr.call(r,Object.getOwnPropertySymbols(t)));for(var o=0;o<r.length;o+=1)eo(e,r[o],t[r[o]],n[r[o]])};to.supportsDescriptors=!!Jr;var no=to,ro={exports:{}};"undefined"!=typeof self?ro.exports=self:"undefined"!=typeof window?ro.exports=window:ro.exports=Function("return this")();var oo=ro.exports,ao=oo,io=function(){return"object"==typeof Fn&&Fn&&Fn.Math===Math&&Fn.Array===Array?Fn:ao},so=no,co=io,uo=no,lo=oo,fo=io,po=function(){var e=co();if(so.supportsDescriptors){var t=Object.getOwnPropertyDescriptor(e,"globalThis");t&&(!t.configurable||!t.enumerable&&t.writable&&globalThis===e)||Object.defineProperty(e,"globalThis",{configurable:!0,enumerable:!1,value:e,writable:!0})}else"object"==typeof globalThis&&globalThis===e||(e.globalThis=e);return e},go=fo(),mo=function(){return go};uo(mo,{getPolyfill:fo,implementation:lo,shim:po});const ho=Un(mo)(),yo={vtkObject:()=>null};function Io(e){if(null==e)return e;if(e.isA)return e;if(!e.vtkClass)return ho.console&&ho.console.error&&ho.console.error("Invalid VTK object"),null;const t=yo[e.vtkClass];if(!t)return ho.console&&ho.console.error&&ho.console.error(`No vtk class found for Object of type ${e.vtkClass}`),null;const n={...e};Object.keys(n).forEach((e=>{n[e]&&"object"==typeof n[e]&&n[e].vtkClass&&(n[e]=Io(n[e]))}));const r=t(n);return r&&r.modified&&r.modified(),r}Io.register=function(e,t){yo[e]=t};class vo extends Array{push(){for(let e=0;e<arguments.length;e++)this.includes(arguments[e])||super.push(arguments[e]);return this.length}}let To=0;const Eo=Symbol("void");const bo={};function Ao(){}["log","debug","info","warn","error","time","timeEnd","group","groupEnd"].forEach((e=>{bo[e]=Ao})),ho.console=console.hasOwnProperty("log")?console:bo;const Oo={debug:Ao,error:ho.console.error||Ao,info:ho.console.info||Ao,log:ho.console.log||Ao,warn:ho.console.warn||Ao};function So(e,t){Oo[e]&&(Oo[e]=t||Ao)}function Co(){Oo.log(...arguments)}function Do(){Oo.info(...arguments)}function xo(){Oo.debug(...arguments)}function _o(){Oo.error(...arguments)}function wo(){Oo.warn(...arguments)}const Ro={};function No(e){Ro[e]||(Oo.error(e),Ro[e]=!0)}const Po=Object.create(null);Po.Float32Array=Float32Array,Po.Float64Array=Float64Array,Po.Uint8Array=Uint8Array,Po.Int8Array=Int8Array,Po.Uint16Array=Uint16Array,Po.Int16Array=Int16Array,Po.Uint32Array=Uint32Array,Po.Int32Array=Int32Array,Po.Uint8ClampedArray=Uint8ClampedArray;try{Po.BigInt64Array=BigInt64Array,Po.BigUint64Array=BigUint64Array}catch{}function Mo(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new(Po[e]||Float64Array)(...n)}function Lo(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return(Po[e]||Float64Array).from(...n)}function Fo(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Uo(e){return Fo("_"===e[0]?e.slice(1):e)}function Go(e){return e.charAt(0).toLowerCase()+e.slice(1)}function ko(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;const r=["TB","GB","MB","KB"];let o=Number(e),a="B";for(;o>n;)o/=n,a=r.pop();return`${o.toFixed(t)} ${a}`}function Vo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";const n=[];let r=e;for(;r>1e3;)n.push(("000"+r%1e3).slice(-3)),r=Math.floor(r/1e3);return r>0&&n.push(r),n.reverse(),n.join(t)}function jo(e){Object.keys(e).forEach((t=>{Array.isArray(e[t])&&(e[t]=[].concat(e[t]))}))}function Bo(e){return e&&e.isA?e.getState():e}function zo(e){setTimeout(e,0)}function qo(e,t){const n=performance.now();e.finally((()=>{const e=performance.now()-n;t(e)}))}function Ho(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};jo(t);const n=[];if(Number.isInteger(t.mtime)||(t.mtime=++To),"classHierarchy"in t){if(!(t.classHierarchy instanceof vo)){const e=new vo;for(let n=0;n<t.classHierarchy.length;n++)e.push(t.classHierarchy[n]);t.classHierarchy=e}}else t.classHierarchy=new vo("vtkObject");function r(e){n[e]=null}return e.isDeleted=()=>!!t.deleted,e.modified=r=>{t.deleted?_o("instance deleted - cannot call any method"):r&&r<e.getMTime()||(t.mtime=++To,n.forEach((t=>t&&t(e))))},e.onModified=e=>{if(t.deleted)return _o("instance deleted - cannot call any method"),null;const o=n.length;return n.push(e),function(e){return Object.freeze({unsubscribe:function(){r(e)}})}(o)},e.getMTime=()=>t.mtime,e.isA=e=>{let n=t.classHierarchy.length;for(;n--;)if(t.classHierarchy[n]===e)return!0;return!1},e.getClassName=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.classHierarchy[t.classHierarchy.length-1-e]},e.set=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!1;return Object.keys(n).forEach((i=>{const s=o?null:e[`set${Fo(i)}`];s&&Array.isArray(n[i])&&s.length>1?a=s(...n[i])||a:s?a=s(n[i])||a:(-1!==["mtime"].indexOf(i)||r||wo(`Warning: Set value to model directly ${i}, ${n[i]}`),a=t[i]!==n[i]||a,t[i]=n[i])})),a},e.get=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(!n.length)return t;const o={};return n.forEach((e=>{o[e]=t[e]})),o},e.getReferenceByName=e=>t[e],e.delete=()=>{Object.keys(t).forEach((e=>delete t[e])),n.forEach(((e,t)=>r(t))),t.deleted=!0},e.getState=()=>{if(t.deleted)return null;const n={...t,vtkClass:e.getClassName()};Object.keys(n).forEach((e=>{var t;null===n[e]||void 0===n[e]||"_"===e[0]?delete n[e]:n[e].isA?n[e]=n[e].getState():Array.isArray(n[e])?n[e]=n[e].map(Bo):(t=n[e],Object.values(Po).some((e=>t instanceof e))&&(n[e]=Array.from(n[e])))}));const r={};return Object.keys(n).sort().forEach((e=>{r[e]=n[e]})),r.mtime&&delete r.mtime,r},e.shallowCopy=function(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n.getClassName()!==e.getClassName())throw new Error(`Cannot ShallowCopy ${n.getClassName()} into ${e.getClassName()}`);const o=n.get(),a=Object.keys(t).sort();Object.keys(o).sort().forEach((e=>{const n=a.indexOf(e);-1===n?r&&xo(`add ${e} in shallowCopy`):a.splice(n,1),t[e]=o[e]})),a.length&&r&&xo(`Untouched keys: ${a.join(", ")}`),e.modified()},e.toJSON=function(){return e.getState()},e}const Wo={object:(e,t,n)=>function(){return{...t[n.name]}}};function Yo(e,t,n){n.forEach((n=>{if("object"==typeof n){const r=Wo[n.type];e[`get${Uo(n.name)}`]=r?r(e,t,n):()=>t[n.name]}else e[`get${Uo(n)}`]=()=>t[n]}))}const $o={enum(e,t,n){const r=`_on${Uo(n.name)}Changed`;return o=>{if("string"==typeof o){if(void 0!==n.enum[o])return t[n.name]!==n.enum[o]&&(t[n.name]=n.enum[o],e.modified(),!0);throw _o(`Set Enum with invalid argument ${n}, ${o}`),new RangeError("Set Enum with invalid string argument")}if("number"==typeof o){if(t[n.name]!==o){if(-1!==Object.keys(n.enum).map((e=>n.enum[e])).indexOf(o)){const a=t[n.name];return t[n.name]=o,t[r]?.(e,t,o,a),e.modified(),!0}throw _o(`Set Enum outside numeric range ${n}, ${o}`),new RangeError("Set Enum outside numeric range")}return!1}throw _o(`Set Enum with invalid argument (String/Number) ${n}, ${o}`),new TypeError("Set Enum with invalid argument (String/Number)")}},object(e,t,n){const r=`_on${Uo(n.name)}Changed`;return o=>{if(!Bn(t[n.name],o)){const a=t[n.name];return t[n.name]=o,t[r]?.(e,t,o,a),e.modified(),!0}return!1}}};function Ko(e){if("object"==typeof e){const t=$o[e.type];if(t)return(n,r)=>t(n,r,e);throw _o(`No setter for field ${e}`),new TypeError("No setter for field")}return function(t,n){const r=`_on${Uo(e)}Changed`;return function(o){if(n.deleted)return _o("instance deleted - cannot call any method"),!1;if(n[e]!==o){const a=n[e.name];return n[e]=o,n[r]?.(t,n,o,a),t.modified(),!0}return!1}}}function Xo(e,t,n){n.forEach((n=>{"object"==typeof n?e[`set${Uo(n.name)}`]=Ko(n)(e,t):e[`set${Uo(n)}`]=Ko(n)(e,t)}))}function Qo(e,t,n){Yo(e,t,n),Xo(e,t,n)}function Zo(e,t,n){n.forEach((n=>{e[`get${Uo(n)}`]=()=>t[n]?Array.from(t[n]):t[n],e[`get${Uo(n)}ByReference`]=()=>t[n]}))}function Jo(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;n.forEach((n=>{if(t[n]&&r&&t[n].length!==r)throw new RangeError(`Invalid initial number of values for array (${n})`);const a=`_on${Uo(n)}Changed`;e[`set${Uo(n)}`]=function(){if(t.deleted)return _o("instance deleted - cannot call any method"),!1;for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];let u,l=s,d=!1;if(1===l.length&&(null==l[0]||l[0].length>=0)&&(l=l[0],d=!0),null==l)u=t[n]!==l;else{if(r&&l.length!==r){if(!(l.length<r&&void 0!==o))throw new RangeError(`Invalid number of values for array setter (${n})`);for(l=Array.from(l),d=!1;l.length<r;)l.push(o)}u=null==t[n]||t[n].length!==l.length;for(let e=0;!u&&e<l.length;++e)u=t[n][e]!==l[e];u&&d&&(l=Array.from(l))}if(u){const r=t[n.name];t[n]=l,t[a]?.(e,t,l,r),e.modified()}return u},e[`set${Uo(n)}From`]=e=>{const r=t[n];e.forEach(((e,t)=>{r[t]=e}))}}))}function ea(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;Zo(e,t,n),Jo(e,t,n,r,o)}function ta(e,t,n){for(let e=0;e<n.length;e++){const r=n[e];void 0!==t[r]&&(t[`_${r}`]=t[r],delete t[r])}}function na(e,t,n,r){function o(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t.deleted?_o("instance deleted - cannot call any method"):r>=t.numberOfInputs?_o(`algorithm ${e.getClassName()} only has ${t.numberOfInputs} input ports. To add more input ports, use addInputData()`):(t.inputData[r]!==n||t.inputConnection[r])&&(t.inputData[r]=n,t.inputConnection[r]=null,e.modified&&e.modified())}function a(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.deleted)_o("instance deleted - cannot call any method");else{if(r>=t.numberOfInputs){let n=`algorithm ${e.getClassName()} only has `;return n+=`${t.numberOfInputs}`,n+=" input ports. To add more input ports, use addInputConnection()",void _o(n)}t.inputData[r]=null,t.inputConnection[r]=n}}function i(){let e=t.numberOfInputs;for(;e&&!t.inputData[e-1]&&!t.inputConnection[e-1];)e--;return e===t.numberOfInputs&&t.numberOfInputs++,e}function s(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.deleted?(_o("instance deleted - cannot call any method"),null):(e.shouldUpdate()&&e.update(),t.output[n])}if(t.inputData?t.inputData=t.inputData.map(Io):t.inputData=[],t.inputConnection?t.inputConnection=t.inputConnection.map(Io):t.inputConnection=[],t.output?t.output=t.output.map(Io):t.output=[],t.inputArrayToProcess?t.inputArrayToProcess=t.inputArrayToProcess.map(Io):t.inputArrayToProcess=[],t.numberOfInputs=n,e.shouldUpdate=()=>{const n=e.getMTime();let o=1/0,a=r;for(;a--;){if(!t.output[a]||t.output[a].isDeleted())return!0;const e=t.output[a].getMTime();if(e<n)return!0;e<o&&(o=e)}for(a=t.numberOfInputs;a--;)if(t.inputConnection[a]?.filter.shouldUpdate()||e.getInputData(a)?.getMTime()>o)return!0;return!1},t.numberOfInputs){let n=t.numberOfInputs;for(;n--;)t.inputData.push(null),t.inputConnection.push(null);e.setInputData=o,e.setInputConnection=a,e.addInputData=function(e){t.deleted?_o("instance deleted - cannot call any method"):o(e,i())},e.addInputConnection=function(e){t.deleted?_o("instance deleted - cannot call any method"):a(e,i())},e.getInputData=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.inputConnection[e]&&(t.inputData[e]=t.inputConnection[e]()),t.inputData[e]},e.getInputConnection=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t.inputConnection[e]}}r&&(e.getOutputData=s,e.getOutputPort=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const n=()=>s(t);return n.filter=e,n}),e.update=()=>{const n=[];if(t.numberOfInputs){let r=0;for(;r<t.numberOfInputs;)n[r]=e.getInputData(r),r++}e.shouldUpdate()&&e.requestData&&e.requestData(n,t.output)},e.getNumberOfInputPorts=()=>t.numberOfInputs,e.getNumberOfOutputPorts=()=>r||t.output.length,e.getInputArrayToProcess=e=>{const n=t.inputArrayToProcess[e],r=t.inputData[e];return n&&r?r[`get${n.fieldAssociation}`]().getArray(n.arrayName):null},e.setInputArrayToProcess=function(e,n,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Scalars";for(;t.inputArrayToProcess.length<e;)t.inputArrayToProcess.push(null);t.inputArrayToProcess[e]={arrayName:n,fieldAssociation:r,attributeType:o}}}const ra=Symbol("Event abort");function oa(e,t,n){const r=[],o=e.delete;let a=1;function i(e){for(let t=0;t<r.length;++t){const[n]=r[t];if(n===e)return void r.splice(t,1)}}e[`invoke${Uo(n)}`]=function(){if(t.deleted)return void _o("instance deleted - cannot call any method");const n=r.slice();for(let t=0;t<n.length;++t){const[,r,o]=n[t];if(r)if(o<0)setTimeout((()=>r.apply(e,arguments)),1-o);else{if(r.apply(e,arguments)===ra)break}}},e[`on${Uo(n)}`]=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e.apply)return console.error(`Invalid callback for event ${n}`),null;if(t.deleted)return _o("instance deleted - cannot call any method"),null;const s=a++;return r.push([s,e,o]),r.sort(((e,t)=>t[2]-e[2])),function(e){return Object.freeze({unsubscribe:function(){i(e)}})}(s)},e.delete=()=>{o(),r.forEach((e=>{let[t]=e;return i(t)}))}}function aa(e,t){const n=function(){const t={};return e(t,{},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Object.freeze(t)};return t&&Io.register(t,n),n}function ia(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.filter((e=>!!e)).map((e=>e(...n)))}}function sa(e){return e&&e.isA&&e.isA("vtkObject")}function ca(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(sa(e)){if(r.indexOf(e)>=0)return n;r.push(e);const o=t(e);void 0!==o&&n.push(o);const a=e.get();Object.keys(a).forEach((e=>{const o=a[e];Array.isArray(o)?o.forEach((e=>{ca(e,t,n,r)})):ca(o,t,n,r)}))}return n}function ua(e,t,n){var r=this;let o;const a=function(){for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];const c=r,u=n&&!o;clearTimeout(o),o=setTimeout((()=>{o=null,n||e.apply(c,i)}),t),u&&e.apply(c,i)};return a.cancel=()=>clearTimeout(o),a}function la(e,t){let n=!1,r=null;function o(){n=!1,null!==r&&(a(...r),r=null)}function a(){for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];n?r=i:(n=!0,e(...i),setTimeout(o,t))}return a}function da(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t.keystore=Object.assign(t.keystore||{},n),e.setKey=(e,n)=>{t.keystore[e]=n},e.getKey=e=>t.keystore[e],e.getAllKeys=()=>Object.keys(t.keystore),e.deleteKey=e=>delete t.keystore[e],e.clearKeystore=()=>e.getAllKeys().forEach((e=>delete t.keystore[e]))}let fa=1;const pa="__root__";function ga(e,t){da(e,t);const n=e.delete;t.proxyId=""+fa++,t.ui=JSON.parse(JSON.stringify(t.ui||[])),Yo(e,t,["proxyId","proxyGroup","proxyName"]),Qo(e,t,["proxyManager"]);const r={},o={};function a(e,t){o[t]||(o[t]=[]);const n=o[t];for(let t=0;t<e.length;t++)n.push(e[t].name),r[e[t].name]=e[t],e[t].children&&e[t].children.length&&a(e[t].children,e[t].name)}function i(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa;const r=[],a=t.proxyId,s=function(){return o[arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa]}(n)||[];for(let t=0;t<s.length;t++){const n=s[t],o=e[`get${Uo(n)}`],c={id:a,name:n,value:o?o():void 0},u=i(n);u.length&&(c.children=u),r.push(c)}return r}a(t.ui,pa),e.updateUI=n=>{t.ui=JSON.parse(JSON.stringify(n||[])),Object.keys(r).forEach((e=>delete r[e])),Object.keys(o).forEach((e=>delete o[e])),a(t.ui,pa),e.modified()},e.updateProxyProperty=(e,t)=>{const n=r[e];n?Object.assign(n,t):r[e]={...t}},e.activate=()=>{if(t.proxyManager){const n=`setActive${Uo(e.getProxyGroup().slice(0,-1))}`;t.proxyManager[n]&&t.proxyManager[n](e)}},t.propertyLinkSubscribers={},e.registerPropertyLinkForGC=(e,n)=>{n in t.propertyLinkSubscribers||(t.propertyLinkSubscribers[n]=[]),t.propertyLinkSubscribers[n].push(e)},e.gcPropertyLinks=n=>{const r=t.propertyLinkSubscribers[n]||[];for(;r.length;)r.pop().unbind(e)},t.propertyLinkMap={},e.getPropertyLink=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.propertyLinkMap[e])return t.propertyLinkMap[e];let r=null;const o=[];let a=0,i=!1;function s(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i)return null;const c=[];let u=null;for(a=o.length;a--;){const e=o[a];e.instance===n?u=e:c.push(e)}if(!u)return null;const l=u.instance[`get${Uo(u.propertyName)}`]();if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}(l,r)||s){for(r=l,i=!0;c.length;){const e=c.pop();e.instance.set({[e.propertyName]:r})}i=!1}return t.propertyLinkMap[e].persistent&&(t.propertyLinkMap[e].value=l),l}function c(e,t){const n=[];for(a=o.length;a--;){const r=o[a];r.instance!==e||r.propertyName!==t&&void 0!==t||(r.subscription.unsubscribe(),n.push(a))}for(;n.length;)o.splice(n.pop(),1)}const u={bind:function(n,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=n.onModified(s),u=o[0];return o.push({instance:n,propertyName:r,subscription:i}),a&&(t.propertyLinkMap[e].persistent&&void 0!==t.propertyLinkMap[e].value?n.set({[r]:t.propertyLinkMap[e].value}):u&&s(u.instance,!0)),{unsubscribe:()=>c(n,r)}},unbind:c,unsubscribe:function(){for(;o.length;)o.pop().subscription.unsubscribe()},persistent:n};return t.propertyLinkMap[e]=u,u},e.listPropertyNames=()=>i().map((e=>e.name)),e.getPropertyByName=e=>i().find((t=>t.name===e)),e.getPropertyDomainByName=e=>(r[e]||{}).domain,e.getProxySection=()=>({id:t.proxyId,name:t.proxyGroup,ui:t.ui,properties:i()}),e.delete=()=>{const r=Object.keys(t.propertyLinkMap);let o=r.length;for(;o--;)t.propertyLinkMap[r[o]].unsubscribe();Object.keys(t.propertyLinkSubscribers).forEach(e.gcPropertyLinks),n()},e.getState=()=>null,zo((function(){if(t.links)for(let n=0;n<t.links.length;n++){const{link:r,property:o,persistent:a,updateOnBind:i,type:s}=t.links[n];if("application"===s){const n=t.proxyManager.getPropertyLink(r,a);e.registerPropertyLinkForGC(n,"application"),n.bind(e,o,i)}}}))}function ma(e,t,n){const r=e.delete,o=[],a=Object.keys(n);let i=a.length;for(;i--;){const r=a[i],{modelKey:s,property:c,modified:u=!0}=n[r],l=Uo(c),d=Uo(r);e[`get${d}`]=t[s][`get${l}`],e[`set${d}`]=t[s][`set${l}`],u&&o.push(t[s].onModified(e.modified))}e.delete=()=>{for(;o.length;)o.pop().unsubscribe();r()}}function ha(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};function o(e){const n=Object.keys(e);let r=n.length;for(;r--;){const o=n[r];t[o].set(e[o])}}t.this=e;const a=Object.keys(r);let i=a.length;for(;i--;){const s=a[i];t[s]=r[s];const c=n[s];e[`set${Uo(s)}`]=n=>{if(n!==t[s]){t[s]=n;o(c[n]),e.modified()}}}a.length&&Yo(e,t,a)}function ya(e){let t=0,n=0,r=0,o=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,o=10*n,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||o)&&e.deltaMode&&(1===e.deltaMode?(r*=40,o*=40):(r*=800,o*=800)),r&&!t&&(t=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:t,spinY:n||t,pixelX:r,pixelY:o||r}}var Ia={algo:na,capitalize:Fo,chain:ia,debounce:ua,enumToString:function(e,t){return Object.keys(e).find((n=>e[n]===t))},event:oa,EVENT_ABORT:ra,formatBytesToProperUnit:ko,formatNumbersWithThousandSeparator:Vo,get:Yo,getArray:Zo,getCurrentGlobalMTime:function(){return To},getStateArrayMapFunc:Bo,isVtkObject:sa,keystore:da,measurePromiseExecution:qo,moveToProtected:ta,newInstance:aa,newTypedArray:Mo,newTypedArrayFrom:Lo,normalizeWheel:ya,obj:Ho,proxy:ga,proxyPropertyMapping:ma,proxyPropertyState:ha,safeArrays:jo,set:Xo,setArray:Jo,setGet:Qo,setGetArray:ea,setImmediate:zo,setLoggerFunction:So,throttle:la,traverseInstanceTree:ca,TYPED_ARRAYS:Po,uncapitalize:Go,VOID:Eo,vtkDebugMacro:xo,vtkErrorMacro:_o,vtkInfoMacro:Do,vtkLogMacro:Co,vtkOnceErrorMacro:No,vtkWarningMacro:wo},va=Object.freeze({__proto__:null,VOID:Eo,setLoggerFunction:So,vtkLogMacro:Co,vtkInfoMacro:Do,vtkDebugMacro:xo,vtkErrorMacro:_o,vtkWarningMacro:wo,vtkOnceErrorMacro:No,TYPED_ARRAYS:Po,newTypedArray:Mo,newTypedArrayFrom:Lo,capitalize:Fo,_capitalize:Uo,uncapitalize:Go,formatBytesToProperUnit:ko,formatNumbersWithThousandSeparator:Vo,setImmediateVTK:zo,measurePromiseExecution:qo,obj:Ho,get:Yo,set:Xo,setGet:Qo,getArray:Zo,setArray:Jo,setGetArray:ea,moveToProtected:ta,algo:na,EVENT_ABORT:ra,event:oa,newInstance:aa,chain:ia,isVtkObject:sa,traverseInstanceTree:ca,debounce:ua,throttle:la,keystore:da,proxy:ga,proxyPropertyMapping:ma,proxyPropertyState:ha,normalizeWheel:ya,default:Ia}),Ta={exports:{}};(function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function o(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var n=new r(e),a=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:n&&n.amd?n((function(){return a})):this.alea=a})(0,Ta,!1);var Ea=Ta.exports,ba={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:n&&n.amd?n((function(){return a})):this.xor128=a}(0,e,!1)}(ba);var Aa=ba.exports,Oa={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function o(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:n&&n.amd?n((function(){return a})):this.xorwow=a}(0,e,!1)}(Oa);var Sa=Oa.exports,Ca={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,o=t.i;return e=r[o],n=(e^=e>>>7)^e<<24,n^=(e=r[o+1&7])^e>>>10,n^=(e=r[o+3&7])^e>>>3,n^=(e=r[o+4&7])^e<<7,e=r[o+7&7],n^=(e^=e<<13)^e<<9,r[o]=n,t.i=o+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function o(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&(a.x&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:n&&n.amd?n((function(){return a})):this.xorshift7=a}(0,e,!1)}(Ca);var Da=Ca.exports,xa={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,o=t.X,a=t.i;return t.w=r=r+1640531527|0,n=o[a+34&127],e=o[a=a+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=o[a]=n^e,t.i=a,n+(r^r>>>16)|0},function(e,t){var n,r,o,a,i,s=[],c=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,c=Math.max(c,t.length)),o=0,a=-32;a<c;++a)t&&(r^=t.charCodeAt((a+32)%t.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(t&&t.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;e.w=i,e.X=s,e.i=o}(t,e)}function o(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&(a.X&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:n&&n.amd?n((function(){return a})):this.xor4096=a}(0,e,!1)}(xa);var _a=xa.exports,wa={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,o=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^o,t.a=o-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function o(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var n=new r(e),a=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}t&&t.exports?t.exports=a:n&&n.amd?n((function(){return a})):this.tychei=a}(0,e,!1)}(wa);var Ra=wa.exports,Na={exports:{}},Pa=Gn(Object.freeze({__proto__:null,default:{}}));!function(e){!function(t,n,r){var o,a=256,i="random",s=r.pow(a,6),c=r.pow(2,52),u=2*c,l=a-1;function d(e,l,d){var y=[],I=m(g((l=1==l?{entropy:!0}:l||{}).entropy?[e,h(n)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(a):(e=new Uint8Array(a),(t.crypto||t.msCrypto).getRandomValues(e)),h(e)}catch(e){var r=t.navigator,i=r&&r.plugins;return[+new Date,t,i,t.screen,h(n)]}}():e,3),y),v=new f(y),T=function(){for(var e=v.g(6),t=s,n=0;e<c;)e=(e+n)*a,t*=a,n=v.g(1);for(;e>=u;)e/=2,t/=2,n>>>=1;return(e+n)/t};return T.int32=function(){return 0|v.g(4)},T.quick=function(){return v.g(4)/4294967296},T.double=T,m(h(v.S),n),(l.pass||d||function(e,t,n,o){return o&&(o.S&&p(o,v),e.state=function(){return p(v,{})}),n?(r[i]=e,t):e})(T,I,"global"in l?l.global:this==r,l.state)}function f(e){var t,n=e.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=l&i+e[o%n]+(t=s[o])],s[i]=t;(r.g=function(e){for(var t,n=0,o=r.i,i=r.j,s=r.S;e--;)t=s[o=l&o+1],n=n*a+s[l&(s[o]=s[i=l&i+t])+(s[i]=t)];return r.i=o,r.j=i,n})(a)}function p(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var n,r=[],o=typeof e;if(t&&"object"==o)for(n in e)try{r.push(g(e[n],t-1))}catch(e){}return r.length?r:"string"==o?e:e+"\0"}function m(e,t){for(var n,r=e+"",o=0;o<r.length;)t[l&o]=l&(n^=19*t[l&o])+r.charCodeAt(o++);return h(t)}function h(e){return String.fromCharCode.apply(0,e)}if(m(r.random(),n),e.exports){e.exports=d;try{o=Pa}catch(e){}}else r["seed"+i]=d}("undefined"!=typeof self?self:Fn,[],Math)}(Na);var Ma=Ea,La=Aa,Fa=Sa,Ua=Da,Ga=_a,ka=Ra,Va=Na.exports;Va.alea=Ma,Va.xor128=La,Va.xorwow=Fa,Va.xorshift7=Ua,Va.xor4096=Ga,Va.tychei=ka;const ja=1e-12,{vtkErrorMacro:Ba,vtkWarningMacro:za}=Ia;function qa(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;const t=Array(e);for(let n=0;n<e;++n)t[n]=0;return t}function Ha(e){let t=1;for(;t<e;)t*=2;return t}function Wa(e){return e===Ha(e)}function Ya(e,t,n){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function $a(e,t,n,r){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function Ka(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xa(e,t,n){const r=e[1]*t[2]-e[2]*t[1],o=e[2]*t[0]-e[0]*t[2],a=e[0]*t[1]-e[1]*t[0];return n[0]=r,n[1]=o,n[2]=a,n}function Qa(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:{let n=0;for(let r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}}}function Za(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])+(e[2]-t[2])*(e[2]-t[2])}function Ja(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 2===t.length?t[0][0]*t[1][1]-t[1][0]*t[0][1]:4===t.length?t[0]*t[3]-t[1]*t[2]:Number.NaN}function ei(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!`${e}`.includes("e"))return+`${Math.round(`${e}e+${t}`)}e-${t}`;const n=`${e}`.split("e");let r="";return+n[1]+t>0&&(r="+"),+`${Math.round(`${+n[0]}e${r}${+n[1]+t}`)}e-${t}`}function ti(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t[0]=ei(e[0],n),t[1]=ei(e[1],n),t[2]=ei(e[2],n),t}function ni(e,t,n){if(2===n){const n=qa(2),r=Ja(e[0],e[1],e[2],e[3]);return 0===r?0:(n[0]=(e[3]*t[0]-e[1]*t[1])/r,n[1]=(-e[2]*t[0]+e[0]*t[1])/r,t[0]=n[0],t[1]=n[1],1)}if(1===n)return 0===e[0]?0:(t[0]/=e[0],1);const r=qa(n);return 0===function(e,t,n){let r,o,a,i,s,c,u,l=0;const d=qa(n);for(r=0;r<n;r++){for(i=0,o=0;o<n;o++)(u=Math.abs(e[r*n+o]))>i&&(i=u);if(0===i)return za("Unable to factor linear system"),0;d[r]=1/i}for(o=0;o<n;o++){for(r=0;r<o;r++){for(s=e[r*n+o],a=0;a<r;a++)s-=e[r*n+a]*e[a*n+o];e[r*n+o]=s}for(i=0,r=o;r<n;r++){for(s=e[r*n+o],a=0;a<o;a++)s-=e[r*n+a]*e[a*n+o];e[r*n+o]=s,(c=d[r]*Math.abs(s))>=i&&(i=c,l=r)}if(o!==l){for(a=0;a<n;a++)c=e[l*n+a],e[l*n+a]=e[o*n+a],e[o*n+a]=c;d[l]=d[o]}if(t[o]=l,Math.abs(e[o*n+o])<=ja)return za("Unable to factor linear system"),0;if(o!==n-1)for(c=1/e[o*n+o],r=o+1;r<n;r++)e[r*n+o]*=c}return 1}(e,r,n)?0:(function(e,t,n,r){let o,a,i,s,c;for(i=-1,o=0;o<r;o++){if(s=t[o],c=n[s],n[s]=n[o],i>=0)for(a=i;a<=o-1;a++)c-=e[o*r+a]*n[a];else 0!==c&&(i=o);n[o]=c}for(o=r-1;o>=0;o--){for(c=n[o],a=o+1;a<r;a++)c-=e[o*r+a]*n[a];n[o]=c/e[o*r+o]}}(e,r,t,n),1)}function ri(e,t,n){return e<t?t:e>n?n:e}function oi(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0];return r[0]=ri(e[0],t[0],n[0]),r[1]=ri(e[1],t[1],n[1]),r[2]=ri(e[2],t[2],n[2]),r}const ai={VOID:"",CHAR:"Int8Array",SIGNED_CHAR:"Int8Array",UNSIGNED_CHAR:"Uint8Array",SHORT:"Int16Array",UNSIGNED_SHORT:"Uint16Array",INT:"Int32Array",UNSIGNED_INT:"Uint32Array",FLOAT:"Float32Array",DOUBLE:"Float64Array"};var ii={DefaultDataType:ai.FLOAT,DataTypeByteSize:{Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},VtkDataTypes:ai};const{vtkErrorMacro:si}=va,{DefaultDataType:ci}=ii,ui=1e-6;function li(e,t,n){const r=e.length;let o,a,i=Number.MAX_VALUE,s=-Number.MAX_VALUE;for(a=t;a<r;a+=n)if(!Number.isNaN(e[a])){i=e[a],s=i;break}for(;a<r;a+=n)o=e[a],o<i?i=o:o>s&&(s=o);return{min:i,max:s}}function di(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<0&&n>1){const t=e.length/n,r=new Float64Array(t);for(let o=0,a=0;o<t;++o){for(let t=a+n;a<t;++a)r[o]+=e[a]*e[a];r[o]**=.5}return li(r,0,1)}return li(e,t<0?0:t,n)}function fi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=e||[];for(;n.length<=t;)n.push(null);return n}function pi(e){return Object.prototype.toString.call(e).slice(8,-1)}const gi={computeRange:di,createRangeHelper:function(){let e=Number.MAX_VALUE,t=-Number.MAX_VALUE,n=0,r=0;return{add(o){e>o&&(e=o),t<o&&(t=o),n++,r+=o},get:()=>({min:e,max:t,count:n,sum:r,mean:r/n}),getRange:()=>({min:e,max:t})}},fastComputeRange:li,getDataType:pi,getMaxNorm:function(e){const t=e.getNumberOfComponents();let n=0;const r=new Array(t);for(let o=0;o<e.getNumberOfTuples();++o){e.getTuple(o,r);const a=Qa(r,t);a>n&&(n=a)}return n}};const mi={name:"",numberOfComponents:1,dataType:ci,rangeTuple:[0,0]};function hi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(Object.assign(t,mi,n),!t.empty&&!t.values&&!t.size)throw new TypeError("Cannot create vtkDataArray object without: size > 0, values");if(t.values?Array.isArray(t.values)&&(t.values=Lo(t.dataType,t.values)):t.values=Mo(t.dataType,t.size),t.values&&(t.size=t.size??t.values.length,t.dataType=pi(t.values)),Ho(e,t),Xo(e,t,["name","numberOfComponents"]),t.size%t.numberOfComponents!=0)throw new RangeError("model.size is not a multiple of model.numberOfComponents");!function(e,t){function n(n){if(n<0)return!1;const r=e.getNumberOfComponents(),o=t.values.length/(r>0?r:1);if(n===o)return!0;if(n>o){const e=t.values;return t.values=Mo(t.dataType,(n+o)*r),t.values.set(e),!0}return t.size>n*r&&(t.size=n*r,e.dataChange()),!0}t.classHierarchy.push("vtkDataArray"),e.dataChange=()=>{t.ranges=null,e.modified()},e.resize=r=>{n(r);const o=r*e.getNumberOfComponents();return t.size!==o&&(t.size=o,e.dataChange(),!0)},e.initialize=()=>{e.resize(0)},e.getElementComponentSize=()=>t.values.BYTES_PER_ELEMENT,e.getComponent=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.values[e*t.numberOfComponents+n]},e.setComponent=(n,r,o)=>{o!==t.values[n*t.numberOfComponents+r]&&(t.values[n*t.numberOfComponents+r]=o,e.dataChange())},e.getValue=n=>{const r=n/t.numberOfComponents,o=n%t.numberOfComponents;return e.getComponent(r,o)},e.setValue=(n,r)=>{const o=n/t.numberOfComponents,a=n%t.numberOfComponents;e.setComponent(o,a,r)},e.getData=()=>t.size===t.values.length?t.values:t.values.subarray(0,t.size),e.getRange=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=n;r<0&&(r=1===t.numberOfComponents?0:t.numberOfComponents);let o=null;return t.ranges||(t.ranges=fi(t.ranges,t.numberOfComponents)),o=t.ranges[r],o?(t.rangeTuple[0]=o.min,t.rangeTuple[1]=o.max,t.rangeTuple):(o=di(e.getData(),n,t.numberOfComponents),t.ranges[r]=o,t.rangeTuple[0]=o.min,t.rangeTuple[1]=o.max,t.rangeTuple)},e.setRange=(e,n)=>{t.ranges||(t.ranges=fi(t.ranges,t.numberOfComponents));const r={min:e.min,max:e.max};return t.ranges[n]=r,t.rangeTuple[0]=r.min,t.rangeTuple[1]=r.max,t.rangeTuple},e.setTuple=(e,n)=>{const r=e*t.numberOfComponents;for(let e=0;e<t.numberOfComponents;e++)t.values[r+e]=n[e]},e.setTuples=(e,n)=>{let r=e*t.numberOfComponents;const o=Math.min(n.length,t.size-r);for(let e=0;e<o;)t.values[r++]=n[e++]},e.insertTuple=(r,o)=>(t.size<=r*t.numberOfComponents&&(t.size=(r+1)*t.numberOfComponents,n(r+1)),e.setTuple(r,o),r),e.insertTuples=(r,o)=>{const a=r+o.length/t.numberOfComponents;return t.size<a*t.numberOfComponents&&(t.size=a*t.numberOfComponents,n(a)),e.setTuples(r,o),a},e.insertNextTuple=n=>{const r=t.size/t.numberOfComponents;return e.insertTuple(r,n)},e.insertNextTuples=n=>{const r=t.size/t.numberOfComponents;return e.insertTuples(r,n)},e.findTuple=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ui;for(let r=0;r<t.size;r+=t.numberOfComponents)if(Math.abs(e[0]-t.values[r])<=n){let o=!0;for(let a=1;a<t.numberOfComponents;++a)if(Math.abs(e[a]-t.values[r+a])>n){o=!1;break}if(o)return r/t.numberOfComponents}return-1},e.getTuple=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=t.numberOfComponents||1,o=e*r;switch(r){case 4:n[3]=t.values[o+3];case 3:n[2]=t.values[o+2];case 2:n[1]=t.values[o+1];case 1:n[0]=t.values[o];break;default:for(let e=r-1;e>=0;--e)n[e]=t.values[o+e]}return n},e.getTuples=(n,r)=>{const o=(n??0)*t.numberOfComponents,a=(r??e.getNumberOfTuples())*t.numberOfComponents,i=e.getData().subarray(o,a);return i.length>0?i:null},e.getTupleLocation=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*t.numberOfComponents},e.getNumberOfComponents=()=>t.numberOfComponents,e.getNumberOfValues=()=>t.size,e.getNumberOfTuples=()=>t.size/t.numberOfComponents,e.getDataType=()=>t.dataType,e.newClone=()=>yi({empty:!0,name:t.name,dataType:t.dataType,numberOfComponents:t.numberOfComponents}),e.getName=()=>(t.name||(e.modified(),t.name=`vtkDataArray${e.getMTime()}`),t.name),e.setData=(n,r)=>{t.values=n,t.size=n.length,t.dataType=pi(n),r&&(t.numberOfComponents=r),t.size%t.numberOfComponents!=0&&(t.numberOfComponents=1),e.dataChange()},e.getState=()=>{if(t.deleted)return null;const n={...t,vtkClass:e.getClassName()};n.values=Array.from(n.values),delete n.buffer,Object.keys(n).forEach((e=>{n[e]||delete n[e]}));const r={};return Object.keys(n).sort().forEach((e=>{r[e]=n[e]})),r.mtime&&delete r.mtime,r},e.deepCopy=n=>{const r=e.getDataType(),o=t.values;e.shallowCopy(n),o?.length>=n.getNumberOfValues()&&r===n.getDataType()?(o.set(n.getData()),t.values=o,e.dataChange()):e.setData(n.getData().slice())},e.interpolateTuple=(n,r,o,a,i,s)=>{const c=t.numberOfComponents||1;c===r.getNumberOfComponents()&&c===a.getNumberOfComponents()||si("numberOfComponents must match");const u=r.getTuple(o),l=a.getTuple(i),d=[];switch(d.length=c,c){case 4:d[3]=u[3]+(l[3]-u[3])*s;case 3:d[2]=u[2]+(l[2]-u[2])*s;case 2:d[1]=u[1]+(l[1]-u[1])*s;case 1:d[0]=u[0]+(l[0]-u[0])*s;break;default:for(let e=0;e<c;e++)d[e]=u[e]+(l[e]-u[e])*s}return e.insertTuple(n,d)}}(e,t)}const yi=aa(hi,"vtkDataArray");var Ii={newInstance:yi,extend:hi,...gi,...ii};function vi(e=Ln,t,n=null){if(!t)throw new Error("Event type was not defined");const r=new CustomEvent(t,{detail:n,cancelable:!0});return e.dispatchEvent(r)}function Ti(e){const t=e.indexOf(":");return e.substring(t+1)}Pn.TRUE;let Ei={gpuTier:void 0,detectGPUConfig:{},rendering:{useCPURendering:!1,preferSizeOverAccuracy:!1,useNorm16Texture:!1,strictZSpacingForVolumeViewport:!0},enableCacheOptimization:!0};const bi=1e-6,Ai="coincide",Oi="disjoint";function Si(e,t,n){const r=n[0]*(e[0]-t[0])+n[1]*(e[1]-t[1])+n[2]*(e[2]-t[2]);return Math.abs(r)}function Ci(e,t,n,r){const o=[];Ya(e,t,o);const a=Ka(n,o);r[0]=e[0]-a*n[0],r[1]=e[1]-a*n[1],r[2]=e[2]-a*n[2]}function Di(e,t,n){const r=Ka(e,t);let o=Ka(t,t);return 0===o&&(o=1),n[0]=e[0]-r*t[0]/o,n[1]=e[1]-r*t[1]/o,n[2]=e[2]-r*t[2]/o,n}function xi(e,t,n,r){const o=[];Ya(e,t,o);const a=Ka(n,o),i=Ka(n,n);0!==i?(r[0]=e[0]-a*n[0]/i,r[1]=e[1]-a*n[1]/i,r[2]=e[2]-a*n[2]/i):(r[0]=e[0],r[1]=e[1],r[2]=e[2])}function _i(e,t,n,r){const o={intersection:!1,betweenPoints:!1,t:Number.MAX_VALUE,x:[]},a=[],i=[];Ya(t,e,a),Ya(n,e,i);const s=Ka(r,i),c=Ka(r,a);let u,l;return u=c<0?-c:c,l=s<0?-s*bi:s*bi,u<=l||(o.t=s/c,o.x[0]=e[0]+o.t*a[0],o.x[1]=e[1]+o.t*a[1],o.x[2]=e[2]+o.t*a[2],o.intersection=!0,o.betweenPoints=o.t>=0&&o.t<=1),o}function wi(e,t,n,r){const o={intersection:!1,l0:[],l1:[],error:null},a=[];Xa(t,r,a);const i=a.map((e=>Math.abs(e)));if(i[0]+i[1]+i[2]<bi){const r=[];return Ya(e,n,r),0===Ka(t,r)?o.error=Ai:o.error=Oi,o}let s;s=i[0]>i[1]&&i[0]>i[2]?"x":i[1]>i[2]?"y":"z";const c=[],u=-Ka(t,e),l=-Ka(r,n);switch(s){case"x":c[0]=0,c[1]=(l*t[2]-u*r[2])/a[0],c[2]=(u*r[1]-l*t[1])/a[0];break;case"y":c[0]=(u*r[2]-l*t[2])/a[1],c[1]=0,c[2]=(l*t[0]-u*r[0])/a[1];break;case"z":c[0]=(l*t[1]-u*r[1])/a[2],c[1]=(u*r[0]-l*t[0])/a[2],c[2]=0}var d,f,p;return o.l0=c,d=c,f=a,(p=o.l1)[0]=d[0]+f[0],p[1]=d[1]+f[1],p[2]=d[2]+f[2],o.intersection=!0,o}const Ri={evaluate:function(e,t,n){return e[0]*(n[0]-t[0])+e[1]*(n[1]-t[1])+e[2]*(n[2]-t[2])},distanceToPlane:Si,projectPoint:Ci,projectVector:Di,generalizedProjectPoint:xi,intersectWithLine:_i,intersectWithPlane:wi,DISJOINT:Oi,COINCIDE:Ai};const Ni={normal:[0,0,1],origin:[0,0,0]};function Pi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ni,n),Ia.obj(e,t),Ia.setGetArray(e,t,["normal","origin"],3),function(e,t){t.classHierarchy.push("vtkPlane"),e.distanceToPlane=e=>Si(e,t.origin,t.normal),e.projectPoint=(e,n)=>{Ci(e,t.origin,t.normal,n)},e.projectVector=(e,n)=>Di(e,t.normal,n),e.push=e=>{if(0!==e)for(let n=0;n<3;n++)t.origin[n]+=e*t.normal[n]},e.generalizedProjectPoint=(e,n)=>{xi(e,t.origin,t.normal,n)},e.evaluateFunction=(e,n,r)=>Array.isArray(e)?t.normal[0]*(e[0]-t.origin[0])+t.normal[1]*(e[1]-t.origin[1])+t.normal[2]*(e[2]-t.origin[2]):t.normal[0]*(e-t.origin[0])+t.normal[1]*(n-t.origin[1])+t.normal[2]*(r-t.origin[2]),e.evaluateGradient=e=>[t.normal[0],t.normal[1],t.normal[2]],e.intersectWithLine=(e,n)=>_i(e,n,t.origin,t.normal),e.intersectWithPlane=(e,n)=>wi(e,n,t.origin,t.normal)}(e,t)}var Mi={newInstance:Ia.newInstance(Pi,"vtkPlane"),extend:Pi,...Ri};const Li=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];function Fi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Ui(e){return e?.length>=6&&e[0]<=e[1]&&e[2]<=e[3]&&e[4]<=e[5]}function Gi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function ki(e){return Gi(e,Li)}function Vi(e,t,n,r){const[o,a,i,s,c,u]=e;return e[0]=o<t?o:t,e[1]=a>t?a:t,e[2]=i<n?i:n,e[3]=s>n?s:n,e[4]=c<r?c:r,e[5]=u>r?u:r,e}function ji(e,t){if(0===t.length)return e;if(Array.isArray(t[0]))for(let n=0;n<t.length;++n)Vi(e,...t[n]);else for(let n=0;n<t.length;n+=3)Vi(e,...t.slice(n,n+3));return e}function Bi(e,t,n,r,o,a,i){const[s,c,u,l,d,f]=e;return void 0===i?(e[0]=Math.min(t[0],s),e[1]=Math.max(t[1],c),e[2]=Math.min(t[2],u),e[3]=Math.max(t[3],l),e[4]=Math.min(t[4],d),e[5]=Math.max(t[5],f)):(e[0]=Math.min(t,s),e[1]=Math.max(n,c),e[2]=Math.min(r,u),e[3]=Math.max(o,l),e[4]=Math.min(a,d),e[5]=Math.max(i,f)),e}function zi(e,t,n,r){const[o,a,i,s,c,u]=e;return e[0]=t,e[1]=t>a?t:a,e[2]=n,e[3]=n>s?n:s,e[4]=r,e[5]=r>u?r:u,o!==t||i!==n||c!==r}function qi(e,t,n,r){const[o,a,i,s,c,u]=e;return e[0]=t<o?t:o,e[1]=t,e[2]=n<i?n:i,e[3]=n,e[4]=r<c?r:c,e[5]=r,a!==t||s!==n||u!==r}function Hi(e,t){return e[0]-=t,e[1]+=t,e[2]-=t,e[3]+=t,e[4]-=t,e[5]+=t,e}function Wi(e,t,n,r){return!!Ui(e)&&(t>=0?(e[0]*=t,e[1]*=t):(e[0]=t*e[1],e[1]=t*e[0]),n>=0?(e[2]*=n,e[3]*=n):(e[2]=n*e[3],e[3]=n*e[2]),r>=0?(e[4]*=r,e[5]*=r):(e[4]=r*e[5],e[5]=r*e[4]),!0)}function Yi(e){return[.5*(e[0]+e[1]),.5*(e[2]+e[3]),.5*(e[4]+e[5])]}function $i(e,t){return e[2*t+1]-e[2*t]}function Ki(e){return[$i(e,0),$i(e,1),$i(e,2)]}function Xi(e){return e.slice(0,2)}function Qi(e){return e.slice(2,4)}function Zi(e){return e.slice(4,6)}function Ji(e){const t=Ki(e);return t[0]>t[1]?t[0]>t[2]?t[0]:t[2]:t[1]>t[2]?t[1]:t[2]}function es(e){if(Ui(e)){const t=Ki(e);return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}return null}function ts(e){return[e[0],e[2],e[4]]}function ns(e){return[e[1],e[3],e[5]]}function rs(e,t){return e<=0&&t>=0||e>=0&&t<=0}function os(e,t){let n=0;for(let r=0;r<2;r++)for(let o=2;o<4;o++)for(let a=4;a<6;a++)t[n++]=[e[r],e[o],e[a]];return t}function as(e,t,n){return t[0]=e[0],t[1]=e[2],t[2]=e[4],n[0]=e[1],n[1]=e[3],n[2]=e[5],t}function is(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=os(e,[]);for(let e=0;e<r.length;++e)u.R3.transformMat4(r[e],r[e],t);return ki(n),ji(n,r)}function ss(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t[0]=.5*(e[1]-e[0]),t[1]=.5*(e[3]-e[2]),t[2]=.5*(e[5]-e[4]),t}function cs(e,t,n,r){const o=[].concat(Li),a=e.getData();for(let e=0;e<a.length;e+=3){const i=[a[e],a[e+1],a[e+2]],s=Ka(i,t);o[0]=Math.min(s,o[0]),o[1]=Math.max(s,o[1]);const c=Ka(i,n);o[2]=Math.min(c,o[2]),o[3]=Math.max(c,o[3]);const u=Ka(i,r);o[4]=Math.min(u,o[4]),o[5]=Math.max(u,o[5])}return o}function us(e,t,n,r,o){let a=!0;const i=[];let s=0;const c=[],u=[0,0,0];for(let n=0;n<3;n++)t[n]<e[2*n]?(i[n]=1,u[n]=e[2*n],a=!1):t[n]>e[2*n+1]?(i[n]=0,u[n]=e[2*n+1],a=!1):i[n]=2;if(a)return r[0]=t[0],r[1]=t[1],r[2]=t[2],o[0]=0,1;for(let e=0;e<3;e++)2!==i[e]&&0!==n[e]?c[e]=(u[e]-t[e])/n[e]:c[e]=-1;for(let e=0;e<3;e++)c[s]<c[e]&&(s=e);if(c[s]>1||c[s]<0)return 0;o[0]=c[s];for(let o=0;o<3;o++)if(s!==o){if(r[o]=t[o]+c[s]*n[o],r[o]<e[2*o]||r[o]>e[2*o+1])return 0}else r[o]=u[o];return 1}function ls(e,t,n){const r=[];let o=0,a=1,i=1;for(let s=4;s<=5;++s){r[2]=e[s];for(let s=2;s<=3;++s){r[1]=e[s];for(let s=0;s<=1;++s)if(r[0]=e[s],o=Mi.evaluate(n,t,r),i&&(a=o>=0?1:-1,i=0),0===o||a>0&&o<0||a<0&&o>0)return 1}}return 0}function ds(e,t){if(!Ui(e)||!Ui(t))return!1;const n=[0,0,0,0,0,0];let r;for(let o=0;o<3;o++)if(r=!1,t[2*o]>=e[2*o]&&t[2*o]<=e[2*o+1]?(r=!0,n[2*o]=t[2*o]):e[2*o]>=t[2*o]&&e[2*o]<=t[2*o+1]&&(r=!0,n[2*o]=e[2*o]),t[2*o+1]>=e[2*o]&&t[2*o+1]<=e[2*o+1]?(r=!0,n[2*o+1]=t[2*o+1]):e[2*o+1]>=t[2*o]&&e[2*o+1]<=t[2*o+1]&&(r=!0,n[2*o+1]=e[2*o+1]),!r)return!1;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],!0}function fs(e,t){if(!Ui(e)||!Ui(t))return!1;for(let n=0;n<3;n++)if(!(t[2*n]>=e[2*n]&&t[2*n]<=e[2*n+1]||e[2*n]>=t[2*n]&&e[2*n]<=t[2*n+1]||t[2*n+1]>=e[2*n]&&t[2*n+1]<=e[2*n+1]||e[2*n+1]>=t[2*n]&&e[2*n+1]<=t[2*n+1]))return!1;return!0}function ps(e,t,n,r){return!(t<e[0]||t>e[1])&&(!(n<e[2]||n>e[3])&&!(r<e[4]||r>e[5]))}function gs(e,t,n){const r=[[0,1,2,3,4,5,6,7],[0,1,4,5,2,3,6,7],[0,2,4,6,1,3,5,7]],o=[0,0,0,0,0,0,0,0];let a=0;for(let r=0;r<2;r++)for(let i=2;i<4;i++)for(let s=4;s<6;s++){const c=[e[r],e[i],e[s]];o[a++]=Mi.evaluate(n,t,c)}let i=2;for(;i--&&!(rs(o[r[i][0]],o[r[i][4]])&&rs(o[r[i][1]],o[r[i][5]])&&rs(o[r[i][2]],o[r[i][6]])&&rs(o[r[i][3]],o[r[i][7]])););if(i<0)return!1;const s=Math.sign(n[i]),c=Math.abs((e[2*i+1]-e[2*i])*n[i]);let u=s>0?1:0;for(let e=0;e<4;e++){if(0===c)continue;const t=Math.abs(o[r[i][e]])/c;s>0&&t<u&&(u=t),s<0&&t>u&&(u=t)}const l=(1-u)*e[2*i]+u*e[2*i+1];return s>0?e[2*i]=l:e[2*i+1]=l,!0}class ms{constructor(e){this.bounds=e,this.bounds||(this.bounds=new Float64Array(Li))}getBounds(){return this.bounds}equals(e){return Fi(this.bounds,e)}isValid(){return Ui(this.bounds)}setBounds(e){return Gi(this.bounds,e)}reset(){return ki(this.bounds)}addPoint(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Vi(this.bounds,...t)}addPoints(e){return ji(this.bounds,e)}addBounds(e,t,n,r,o,a){return Bi(this.bounds,e,t,n,r,o,a)}setMinPoint(e,t,n){return zi(this.bounds,e,t,n)}setMaxPoint(e,t,n){return qi(this.bounds,e,t,n)}inflate(e){return Hi(this.bounds,e)}scale(e,t,n){return Wi(this.bounds,e,t,n)}getCenter(){return Yi(this.bounds)}getLength(e){return $i(this.bounds,e)}getLengths(){return Ki(this.bounds)}getMaxLength(){return Ji(this.bounds)}getDiagonalLength(){return es(this.bounds)}getMinPoint(){return ts(this.bounds)}getMaxPoint(){return ns(this.bounds)}getXRange(){return Xi(this.bounds)}getYRange(){return Qi(this.bounds)}getZRange(){return Zi(this.bounds)}getCorners(e){return os(this.bounds,e)}computeCornerPoints(e,t){return as(this.bounds,e,t)}computeLocalBounds(e,t,n){return cs(this.bounds,e,t,n)}transformBounds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return is(this.bounds,e,t)}computeScale3(e){return ss(this.bounds,e)}cutWithPlane(e,t){return gs(this.bounds,e,t)}intersectBox(e,t,n,r){return us(this.bounds,e,t,n,r)}intersectPlane(e,t){return ls(this.bounds,e,t)}intersect(e){return ds(this.bounds,e)}intersects(e){return fs(this.bounds,e)}containsPoint(e,t,n){return ps(this.bounds,e,t,n)}contains(e){return fs(this.bounds,e)}}var hs={newInstance:function(e){const t=e&&e.bounds;return new ms(t)},...{equals:Fi,isValid:Ui,setBounds:Gi,reset:ki,addPoint:Vi,addPoints:ji,addBounds:Bi,setMinPoint:zi,setMaxPoint:qi,inflate:Hi,scale:Wi,scaleAboutCenter:function(e,t,n,r){if(!Ui(e))return!1;const o=Yi(e);return e[0]-=o[0],e[1]-=o[0],e[2]-=o[1],e[3]-=o[1],e[4]-=o[2],e[5]-=o[2],Wi(e,t,n,r),e[0]+=o[0],e[1]+=o[0],e[2]+=o[1],e[3]+=o[1],e[4]+=o[2],e[5]+=o[2],!0},getCenter:Yi,getLength:$i,getLengths:Ki,getMaxLength:Ji,getDiagonalLength:es,getMinPoint:ts,getMaxPoint:ns,getXRange:Xi,getYRange:Qi,getZRange:Zi,getCorners:os,computeCornerPoints:as,computeLocalBounds:cs,transformBounds:is,computeScale3:ss,cutWithPlane:gs,intersectBox:us,intersectPlane:ls,intersect:ds,intersects:fs,containsPoint:ps,contains:function(e,t){return!!fs(e,t)&&(!!ps(e,...ts(t))&&!!ps(e,...ns(t)))},INIT_BOUNDS:Li}};const{vtkErrorMacro:ys,vtkWarningMacro:Is}=Ia;const vs={arrays:[],copyFieldFlags:[],doCopyAllOn:!0,doCopyAllOff:!1};function Ts(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,vs,n),Ia.obj(e,t),function(e,t){t.classHierarchy.push("vtkFieldData");const n=e.getState;t.arrays&&(t.arrays=t.arrays.map((e=>({data:Io(e.data)})))),e.initialize=()=>{e.initializeFields(),e.copyAllOn(),e.clearFieldFlags()},e.initializeFields=()=>{t.arrays=[],t.copyFieldFlags={},e.modified()},e.copyStructure=n=>{e.initializeFields(),t.copyFieldFlags=n.getCopyFieldFlags().map((e=>e)),t.arrays=n.arrays().map((e=>({array:e})))},e.getNumberOfArrays=()=>t.arrays.length,e.getNumberOfActiveArrays=()=>t.arrays.length,e.addArray=n=>{const r=n.getName(),{array:o,index:a}=e.getArrayWithIndex(r);return null!=o?(t.arrays[a]={data:n},a):(t.arrays=[].concat(t.arrays,{data:n}),t.arrays.length-1)},e.removeAllArrays=()=>{t.arrays=[]},e.removeArray=n=>{const r=t.arrays.findIndex((e=>e.data.getName()===n));return e.removeArrayByIndex(r)},e.removeArrayByIndex=e=>-1!==e&&e<t.arrays.length&&(t.arrays.splice(e,1),!0),e.getArrays=()=>t.arrays.map((e=>e.data)),e.getArray=t=>"number"==typeof t?e.getArrayByIndex(t):e.getArrayByName(t),e.getArrayByName=e=>t.arrays.reduce(((t,n,r)=>n.data.getName()===e?n.data:t),null),e.getArrayWithIndex=e=>{const n=t.arrays.findIndex((t=>t.data.getName()===e));return{array:-1!==n?t.arrays[n].data:null,index:n}},e.getArrayByIndex=e=>e>=0&&e<t.arrays.length?t.arrays[e].data:null,e.hasArray=t=>e.getArrayWithIndex(t).index>=0,e.getArrayName=e=>{const n=t.arrays[e];return n?n.data.getName():""},e.getCopyFieldFlags=()=>t.copyFieldFlags,e.getFlag=e=>t.copyFieldFlags[e],e.passData=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n.getArrays().forEach((a=>{const i=e.getFlag(a.getName());if(!1!==i&&(!t.doCopyAllOff||!0===i)&&a){let t=e.getArrayByName(a.getName());if(t)if(a.getNumberOfComponents()===t.getNumberOfComponents())if(r>-1&&r<a.getNumberOfTuples()){const e=o>-1?o:r;t.insertTuple(e,a.getTuple(r))}else t.insertTuples(0,a.getTuples());else ys("Unhandled case in passData");else if(r<0||r>a.getNumberOfTuples())e.addArray(a),n.getAttributes(a).forEach((t=>{e.setAttribute(a,t)}));else{const i=a.getNumberOfComponents();let s=a.getNumberOfValues();const c=o>-1?o:r;s<=c*i&&(s=(c+1)*i),t=Ii.newInstance({name:a.getName(),dataType:a.getDataType(),numberOfComponents:i,values:Ia.newTypedArray(a.getDataType(),s),size:0}),t.insertTuple(c,a.getTuple(r)),e.addArray(t),n.getAttributes(a).forEach((n=>{e.setAttribute(t,n)}))}}}))},e.interpolateData=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;n.getArrays().forEach((s=>{const c=e.getFlag(s.getName());if(!1!==c&&(!t.doCopyAllOff||!0===c)&&s){let t=e.getArrayByName(s.getName());if(t)if(s.getNumberOfComponents()===t.getNumberOfComponents())if(r>-1&&r<s.getNumberOfTuples()){const e=a>-1?a:r;t.interpolateTuple(e,s,r,s,o,i),Is("Unexpected case in interpolateData")}else t.insertTuples(s.getTuples());else ys("Unhandled case in interpolateData");else if(r<0||o<0||r>s.getNumberOfTuples())e.addArray(s),n.getAttributes(s).forEach((t=>{e.setAttribute(s,t)}));else{const c=s.getNumberOfComponents();let u=s.getNumberOfValues();const l=a>-1?a:r;u<=l*c&&(u=(l+1)*c),t=Ii.newInstance({name:s.getName(),dataType:s.getDataType(),numberOfComponents:c,values:Ia.newTypedArray(s.getDataType(),u),size:0}),t.interpolateTuple(l,s,r,s,o,i),e.addArray(t),n.getAttributes(s).forEach((n=>{e.setAttribute(t,n)}))}}}))},e.copyFieldOn=e=>{t.copyFieldFlags[e]=!0},e.copyFieldOff=e=>{t.copyFieldFlags[e]=!1},e.copyAllOn=()=>{t.doCopyAllOn&&!t.doCopyAllOff||(t.doCopyAllOn=!0,t.doCopyAllOff=!1,e.modified())},e.copyAllOff=()=>{!t.doCopyAllOn&&t.doCopyAllOff||(t.doCopyAllOn=!1,t.doCopyAllOff=!0,e.modified())},e.clearFieldFlags=()=>{t.copyFieldFlags={}},e.deepCopy=e=>{t.arrays=e.getArrays().map((e=>{const t=e.newClone();return t.deepCopy(e),{data:t}}))},e.copyFlags=e=>e.getCopyFieldFlags().map((e=>e)),e.reset=()=>t.arrays.forEach((e=>e.data.reset())),e.getMTime=()=>t.arrays.reduce(((e,t)=>t.data.getMTime()>e?t.data.getMTime():e),t.mtime),e.getNumberOfComponents=()=>t.arrays.reduce(((e,t)=>e+t.data.getNumberOfComponents()),0),e.getNumberOfTuples=()=>t.arrays.length>0?t.arrays[0].getNumberOfTuples():0,e.getState=()=>{const e=n();return e&&(e.arrays=t.arrays.map((e=>({data:e.data.getState()})))),e}}(e,t)}var Es={newInstance:Ia.newInstance(Ts,"vtkFieldData"),extend:Ts};var bs={AttributeCopyOperations:{COPYTUPLE:0,INTERPOLATE:1,PASSDATA:2,ALLCOPY:3},AttributeLimitTypes:{MAX:0,EXACT:1,NOLIMIT:2},AttributeTypes:{SCALARS:0,VECTORS:1,NORMALS:2,TCOORDS:3,TENSORS:4,GLOBALIDS:5,PEDIGREEIDS:6,EDGEFLAG:7,NUM_ATTRIBUTES:8},CellGhostTypes:{DUPLICATECELL:1,HIGHCONNECTIVITYCELL:2,LOWCONNECTIVITYCELL:4,REFINEDCELL:8,EXTERIORCELL:16,HIDDENCELL:32},DesiredOutputPrecision:{DEFAULT:0,SINGLE:1,DOUBLE:2},PointGhostTypes:{DUPLICATEPOINT:1,HIDDENPOINT:2},ghostArrayName:"vtkGhostType"};const{AttributeTypes:As,AttributeCopyOperations:Os}=bs,{vtkWarningMacro:Ss}=Ia;const Cs={activeScalars:-1,activeVectors:-1,activeTensors:-1,activeNormals:-1,activeTCoords:-1,activeGlobalIds:-1,activePedigreeIds:-1};function Ds(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Cs,n),Es.extend(e,t,n),Ia.setGet(e,t,["activeScalars","activeNormals","activeTCoords","activeVectors","activeTensors","activeGlobalIds","activePedigreeIds"]),t.arrays||(t.arrays={}),function(e,t){const n=["Scalars","Vectors","Normals","TCoords","Tensors","GlobalIds","PedigreeIds"];function r(e){let t=n.find((t=>As[t.toUpperCase()]===e||"number"!=typeof e&&t.toLowerCase()===e.toLowerCase()));return void 0===t&&(t=null),t}t.classHierarchy.push("vtkDataSetAttributes");const o={...e};e.checkNumberOfComponents=e=>!0,e.setAttribute=(n,o)=>{const a=r(o);if(n&&"PEDIGREEIDS"===a.toUpperCase()&&!n.isA("vtkDataArray"))return Ss(`Cannot set attribute ${a}. The attribute must be a vtkDataArray.`),-1;if(n&&!e.checkNumberOfComponents(n,a))return Ss(`Cannot set attribute ${a}. Incorrect number of components.`),-1;let i=t[`active${a}`];if(i>=0&&i<t.arrays.length){if(t.arrays[i]===n)return i;e.removeArrayByIndex(i)}return n?(i=e.addArray(n),t[`active${a}`]=i):t[`active${a}`]=-1,e.modified(),t[`active${a}`]},e.getAttributes=t=>n.filter((n=>e[`get${n}`]()===t)),e.setActiveAttributeByName=(t,n)=>e.setActiveAttributeByIndex(e.getArrayWithIndex(t).index,n),e.setActiveAttributeByIndex=(n,o)=>{const a=r(o);if(n>=0&&n<t.arrays.length){if("PEDIGREEIDS"!==a.toUpperCase()){const t=e.getArrayByIndex(n);if(!t.isA("vtkDataArray"))return Ss(`Cannot set attribute ${a}. Only vtkDataArray subclasses can be set as active attributes.`),-1;if(!e.checkNumberOfComponents(t,a))return Ss(`Cannot set attribute ${a}. Incorrect number of components.`),-1}return t[`active${a}`]=n,e.modified(),n}return-1===n&&(t[`active${a}`]=n,e.modified()),-1},e.getActiveAttribute=t=>{const n=r(t);return e[`get${n}`]()},e.removeAllArrays=()=>{n.forEach((e=>{t[`active${e}`]=-1})),o.removeAllArrays()},e.removeArrayByIndex=e=>(-1!==e&&n.forEach((n=>{e===t[`active${n}`]?t[`active${n}`]=-1:e<t[`active${n}`]&&(t[`active${n}`]-=1)})),o.removeArrayByIndex(e)),n.forEach((n=>{const r=`active${n}`;e[`get${n}`]=()=>e.getArrayByIndex(t[r]),e[`set${n}`]=t=>e.setAttribute(t,n),e[`setActive${n}`]=t=>e.setActiveAttributeByIndex(e.getArrayWithIndex(t).index,n),e[`copy${n}Off`]=()=>{const e=n.toUpperCase();t.copyAttributeFlags[Os.PASSDATA][As[e]]=!1},e[`copy${n}On`]=()=>{const e=n.toUpperCase();t.copyAttributeFlags[Os.PASSDATA][As[e]]=!0}})),e.initializeAttributeCopyFlags=()=>{t.copyAttributeFlags=[],Object.keys(Os).filter((e=>"ALLCOPY"!==e)).forEach((e=>{t.copyAttributeFlags[Os[e]]=Object.keys(As).filter((e=>"NUM_ATTRIBUTES"!==e)).reduce(((e,t)=>(e[As[t]]=!0,e)),[])})),t.copyAttributeFlags[Os.COPYTUPLE][As.GLOBALIDS]=!1,t.copyAttributeFlags[Os.INTERPOLATE][As.GLOBALIDS]=!1,t.copyAttributeFlags[Os.COPYTUPLE][As.PEDIGREEIDS]=!1},e.initialize=Ia.chain(e.initialize,e.initializeAttributeCopyFlags),t.dataArrays&&Object.keys(t.dataArrays).length&&Object.keys(t.dataArrays).forEach((n=>{t.dataArrays[n].ref||"vtkDataArray"!==t.dataArrays[n].type||e.addArray(Ii.newInstance(t.dataArrays[n]))}));const a=e.shallowCopy;e.shallowCopy=(e,n)=>{a(e,n),t.arrays=e.getArrays().map((e=>{const t=e.newClone();return t.shallowCopy(e,n),{data:t}}))},e.initializeAttributeCopyFlags()}(e,t)}var xs={newInstance:Ia.newInstance(Ds,"vtkDataSetAttributes"),extend:Ds,...bs};var _s={FieldDataTypes:{UNIFORM:0,DATA_OBJECT_FIELD:0,COORDINATE:1,POINT_DATA:1,POINT:2,POINT_FIELD_DATA:2,CELL:3,CELL_FIELD_DATA:3,VERTEX:4,VERTEX_FIELD_DATA:4,EDGE:5,EDGE_FIELD_DATA:5,ROW:6,ROW_DATA:6},FieldAssociations:{FIELD_ASSOCIATION_POINTS:0,FIELD_ASSOCIATION_CELLS:1,FIELD_ASSOCIATION_NONE:2,FIELD_ASSOCIATION_POINTS_THEN_CELLS:3,FIELD_ASSOCIATION_VERTICES:4,FIELD_ASSOCIATION_EDGES:5,FIELD_ASSOCIATION_ROWS:6,NUMBER_OF_ASSOCIATIONS:7}};const ws=["pointData","cellData","fieldData"];const Rs={};function Ns(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Rs,n),Ia.obj(e,t),Ia.setGet(e,t,ws),function(e,t){t.classHierarchy.push("vtkDataSet"),ws.forEach((e=>{t[e]?t[e]=Io(t[e]):t[e]=xs.newInstance()}));const n=e.shallowCopy;e.shallowCopy=function(e){n(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),ws.forEach((n=>{t[n]=xs.newInstance(),t[n].shallowCopy(e.getReferenceByName(n))}))}}(e,t)}var Ps={newInstance:Ia.newInstance(Ns,"vtkDataSet"),extend:Ns,..._s};const Ms={UNCHANGED:0,SINGLE_POINT:1,X_LINE:2,Y_LINE:3,Z_LINE:4,XY_PLANE:5,YZ_PLANE:6,XZ_PLANE:7,XYZ_GRID:8,EMPTY:9};var Ls={StructuredType:Ms};const{StructuredType:Fs}=Ls;var Us={getDataDescriptionFromExtent:function(e){let t=0;for(let n=0;n<3;++n)e[2*n]<e[2*n+1]&&t++;return e[0]>e[1]||e[2]>e[3]||e[4]>e[5]?Fs.EMPTY:3===t?Fs.XYZ_GRID:2===t?e[0]===e[1]?Fs.YZ_PLANE:e[2]===e[3]?Fs.XZ_PLANE:Fs.XY_PLANE:1===t?e[0]<e[1]?Fs.X_LINE:e[2]<e[3]?Fs.Y_LINE:Fs.Z_LINE:Fs.SINGLE_POINT},...Ls};const{vtkErrorMacro:Gs}=Ia;const ks={direction:null,indexToWorld:null,worldToIndex:null,spacing:[1,1,1],origin:[0,0,0],extent:[0,-1,0,-1,0,-1],dataDescription:Ms.EMPTY};function Vs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ks,n),Ps.extend(e,t,n),t.direction?Array.isArray(t.direction)&&(t.direction=new Float64Array(t.direction.slice(0,9))):t.direction=u.wO.identity(new Float64Array(9)),t.indexToWorld=new Float64Array(16),t.worldToIndex=new Float64Array(16),Ia.get(e,t,["indexToWorld","worldToIndex"]),Ia.setGetArray(e,t,["origin","spacing"],3),Ia.setGetArray(e,t,["direction"],9),Ia.getArray(e,t,["extent"],6),function(e,t){t.classHierarchy.push("vtkImageData"),e.setExtent=function(){if(t.deleted)return Gs("instance deleted - cannot call any method"),!1;for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=1===r.length?r[0]:r;if(6!==a.length)return!1;const i=t.extent.some(((e,t)=>e!==a[t]));return i&&(t.extent=a.slice(),t.dataDescription=Us.getDataDescriptionFromExtent(t.extent),e.modified()),i},e.setDimensions=function(){let n,r,o;if(t.deleted)Gs("instance deleted - cannot call any method");else{if(1===arguments.length){const e=arguments.length<=0?void 0:arguments[0];n=e[0],r=e[1],o=e[2]}else{if(3!==arguments.length)return void Gs("Bad dimension specification");n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2]}e.setExtent(0,n-1,0,r-1,0,o-1)}},e.getDimensions=()=>[t.extent[1]-t.extent[0]+1,t.extent[3]-t.extent[2]+1,t.extent[5]-t.extent[4]+1],e.getNumberOfCells=()=>{const t=e.getDimensions();let n=1;for(let e=0;e<3;e++){if(0===t[e])return 0;t[e]>1&&(n*=t[e]-1)}return n},e.getNumberOfPoints=()=>{const t=e.getDimensions();return t[0]*t[1]*t[2]},e.getPoint=n=>{const r=e.getDimensions();if(0===r[0]||0===r[1]||0===r[2])return Gs("Requesting a point from an empty image."),null;const o=new Float64Array(3);switch(t.dataDescription){case Ms.EMPTY:return null;case Ms.SINGLE_POINT:break;case Ms.X_LINE:o[0]=n;break;case Ms.Y_LINE:o[1]=n;break;case Ms.Z_LINE:o[2]=n;break;case Ms.XY_PLANE:o[0]=n%r[0],o[1]=n/r[0];break;case Ms.YZ_PLANE:o[1]=n%r[1],o[2]=n/r[1];break;case Ms.XZ_PLANE:o[0]=n%r[0],o[2]=n/r[0];break;case Ms.XYZ_GRID:o[0]=n%r[0],o[1]=n/r[0]%r[1],o[2]=n/(r[0]*r[1]);break;default:Gs("Invalid dataDescription")}const a=[0,0,0];return e.indexToWorld(o,a),a},e.getBounds=()=>e.extentToBounds(e.getSpatialExtent()),e.extentToBounds=e=>hs.transformBounds(e,t.indexToWorld),e.getSpatialExtent=()=>hs.inflate([...t.extent],.5),e.computeTransforms=()=>{u._E.fromTranslation(t.indexToWorld,t.origin),t.indexToWorld[0]=t.direction[0],t.indexToWorld[1]=t.direction[1],t.indexToWorld[2]=t.direction[2],t.indexToWorld[4]=t.direction[3],t.indexToWorld[5]=t.direction[4],t.indexToWorld[6]=t.direction[5],t.indexToWorld[8]=t.direction[6],t.indexToWorld[9]=t.direction[7],t.indexToWorld[10]=t.direction[8],u._E.scale(t.indexToWorld,t.indexToWorld,t.spacing),u._E.invert(t.worldToIndex,t.indexToWorld)},e.indexToWorld=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return u.R3.transformMat4(n,e,t.indexToWorld),n},e.indexToWorldVec3=e.indexToWorld,e.worldToIndex=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return u.R3.transformMat4(n,e,t.worldToIndex),n},e.worldToIndexVec3=e.worldToIndex,e.indexToWorldBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return hs.transformBounds(e,t.indexToWorld,n)},e.worldToIndexBounds=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return hs.transformBounds(e,t.worldToIndex,n)},e.onModified(e.computeTransforms),e.computeTransforms(),e.getCenter=()=>hs.getCenter(e.getBounds()),e.computeHistogram=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=[0,0,0,0,0,0];e.worldToIndexBounds(t,r);const o=[0,0,0],a=[0,0,0];hs.computeCornerPoints(r,o,a),ti(o,o),ti(a,a);const i=e.getDimensions();oi(o,[0,0,0],[i[0]-1,i[1]-1,i[2]-1],o),oi(a,[0,0,0],[i[0]-1,i[1]-1,i[2]-1],a);const s=i[0],c=i[0]*i[1],u=e.getPointData().getScalars().getData();let l=-1/0,d=1/0,f=0,p=0,g=0;for(let e=o[2];e<=a[2];e++)for(let t=o[1];t<=a[1];t++){let i=o[0]+t*s+e*c;for(let s=o[0];s<=a[0];s++){if(!n||n([s,t,e],r)){const e=u[i];e>l&&(l=e),e<d&&(d=e),f+=e*e,p+=e,g+=1}++i}}const m=g>0?p/g:0,h=g?Math.abs(f/g-m*m):0;return{minimum:d,maximum:l,average:m,variance:h,sigma:Math.sqrt(h),count:g}},e.computeIncrements=function(e){const t=[];let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let r=0;r<3;++r)t[r]=n,n*=e[2*r+1]-e[2*r]+1;return t},e.computeOffsetIndex=t=>{let[n,r,o]=t;const a=e.getExtent(),i=e.getPointData().getScalars().getNumberOfComponents(),s=e.computeIncrements(a,i);return Math.floor((Math.round(n)-a[0])*s[0]+(Math.round(r)-a[2])*s[1]+(Math.round(o)-a[4])*s[2])},e.getOffsetIndexFromWorld=t=>{const n=e.getExtent(),r=e.worldToIndex(t);for(let e=0;e<3;++e)if(r[e]<n[2*e]||r[e]>n[2*e+1])return Gs(`GetScalarPointer: Pixel ${r} is not in memory. Current extent = ${n}`),NaN;return e.computeOffsetIndex(r)},e.getScalarValueFromWorld=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=e.getPointData().getScalars().getNumberOfComponents();if(n<0||n>=r)return Gs(`GetScalarPointer: Scalar Component ${n} is not within bounds. Current Scalar numberOfComponents: ${r}`),NaN;const o=e.getOffsetIndexFromWorld(t);return Number.isNaN(o)?o:e.getPointData().getScalars().getComponent(o,n)}}(e,t)}var js={newInstance:Ia.newInstance(Vs,"vtkImageData"),extend:Vs};var Bs={Wrap:{CLAMP_TO_EDGE:0,REPEAT:1,MIRRORED_REPEAT:2},Filter:{NEAREST:0,LINEAR:1,NEAREST_MIPMAP_NEAREST:2,NEAREST_MIPMAP_LINEAR:3,LINEAR_MIPMAP_NEAREST:4,LINEAR_MIPMAP_LINEAR:5}};const zs=new Float32Array(1),qs=new Int32Array(zs.buffer);var Hs={fromHalf:function(e){const t=(32768&e)>>15,n=(31744&e)>>10,r=1023&e;return 0===n?(t?-1:1)*2**-14*(r/1024):31===n?r?NaN:1/0*(t?-1:1):(t?-1:1)*2**(n-15)*(1+r/1024)},toHalf:function(e){zs[0]=e;const t=qs[0];let n=t>>16&32768,r=t>>12&2047;const o=t>>23&255;return o<103?n:o>142?(n|=31744,n|=(255===o?0:1)&&8388607&t,n):o<113?(r|=2048,n|=(r>>114-o)+(r>>113-o&1),n):(n|=o-112<<10|r>>1,n+=1&r,n)}};const{vtkErrorMacro:Ws}=Ia;const Ys={renderable:null,myFactory:null,children:[],visited:!1};function $s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Ys,n),Ia.obj(e,t),Ia.event(e,t,"event"),t._renderableChildMap=new Map,Ia.get(e,t,["visited"]),Ia.setGet(e,t,["_parent","renderable","myFactory"]),Ia.getArray(e,t,["children"]),Ia.moveToProtected(e,t,["parent"]),function(e,t){t.classHierarchy.push("vtkViewNode"),e.build=e=>{},e.render=e=>{},e.traverse=n=>{const r=n.getTraverseOperation(),o=e[r];if(o)o(n);else{e.apply(n,!0);for(let e=0;e<t.children.length;e++)t.children[e].traverse(n);e.apply(n,!1)}},e.apply=(t,n)=>{const r=e[t.getOperation()];r&&r(n,t)},e.getViewNodeFor=n=>{if(t.renderable===n)return e;for(let e=0;e<t.children.length;++e){const r=t.children[e].getViewNodeFor(n);if(r)return r}},e.getFirstAncestorOfType=e=>t._parent?t._parent.isA(e)?t._parent:t._parent.getFirstAncestorOfType(e):null,e.addMissingNode=n=>{if(!n)return;const r=t._renderableChildMap.get(n);if(void 0!==r)r.setVisited(!0);else{const r=e.createViewNode(n);r&&(r.setParent(e),r.setVisited(!0),t._renderableChildMap.set(n,r),t.children.push(r))}},e.addMissingNodes=n=>{if(n&&n.length)for(let r=0;r<n.length;++r){const o=n[r],a=t._renderableChildMap.get(o);if(void 0!==a)a.setVisited(!0);else{const n=e.createViewNode(o);n&&(n.setParent(e),n.setVisited(!0),t._renderableChildMap.set(o,n),t.children.push(n))}}},e.addMissingChildren=n=>{if(n&&n.length)for(let r=0;r<n.length;++r){const o=n[r];-1===t.children.indexOf(o)&&(o.setParent(e),t.children.push(o)),o.setVisited(!0)}},e.prepareNodes=()=>{for(let e=0;e<t.children.length;++e)t.children[e].setVisited(!1)},e.setVisited=e=>{t.visited=e},e.removeUnusedNodes=()=>{let e=0;for(let n=0;n<t.children.length;++n){const r=t.children[n];if(r.getVisited())t.children[e++]=r,r.setVisited(!1);else{const e=r.getRenderable();e&&t._renderableChildMap.delete(e),r.delete()}}t.children.length=e},e.createViewNode=e=>{if(!t.myFactory)return Ws("Cannot create view nodes without my own factory"),null;const n=t.myFactory.createNode(e);return n&&n.setRenderable(e),n};const n=e.delete;e.delete=()=>{for(let e=0;e<t.children.length;e++)t.children[e].delete();n()}}(e,t)}var Ks={newInstance:Ia.newInstance($s,"vtkViewNode"),extend:$s,PASS_TYPES:["Build","Render"]};const Xs={};function Qs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Xs,n),Ia.obj(e,t),function(e,t){t.overrides||(t.overrides={}),t.classHierarchy.push("vtkViewNodeFactory"),e.createNode=n=>{if(n.isDeleted())return null;let r=0,o=n.getClassName(r++),a=!1;const i=Object.keys(t.overrides);for(;o&&!a;)-1!==i.indexOf(o)?a=!0:o=n.getClassName(r++);if(!a)return null;const s=t.overrides[o]();return s.setMyFactory(e),s},e.registerOverride=(e,n)=>{t.overrides[e]=n}}(e,t)}var Zs={newInstance:Ia.newInstance(Qs,"vtkViewNodeFactory"),extend:Qs};const Js=Object.create(null);const ec={};Ia.newInstance((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ec,n),t.overrides=Js,Zs.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkOpenGLViewNodeFactory")}(0,t)}),"vtkOpenGLViewNodeFactory");const{Wrap:tc,Filter:nc}=Bs,{VtkDataTypes:rc}=Ii,{vtkDebugMacro:oc,vtkErrorMacro:ac,vtkWarningMacro:ic}=va,{toHalf:sc}=Hs;function cc(e,t){function n(e,n){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=[];let a=t.width*t.height*t.components;if(r&&(a*=t.depth),e!==rc.FLOAT&&t.openGLDataType===t.context.FLOAT)for(let e=0;e<n.length;e++)if(n[e]){const t=n[e].length>a?n[e].subarray(0,a):n[e];o.push(new Float32Array(t))}else o.push(null);if(e!==rc.UNSIGNED_CHAR&&t.openGLDataType===t.context.UNSIGNED_BYTE)for(let e=0;e<n.length;e++)if(n[e]){const t=n[e].length>a?n[e].subarray(0,a):n[e];o.push(new Uint8Array(t))}else o.push(null);let i=!1;if(t._openGLRenderWindow.getWebgl2())i=t.openGLDataType===t.context.HALF_FLOAT;else{const e=t.context.getExtension("OES_texture_half_float");i=e&&t.openGLDataType===e.HALF_FLOAT_OES}if(i)for(let e=0;e<n.length;e++)if(n[e]){const t=new Uint16Array(a),r=n[e];for(let e=0;e<a;e++)t[e]=sc(r[e]);o.push(t)}else o.push(null);if(0===o.length)for(let e=0;e<n.length;e++)o.push(n[e]);return o}function r(e){if(t._openGLRenderWindow.getWebgl2())return e;const n=[],r=t.width,o=t.height,a=t.components;if(e&&(!Wa(r)||!Wa(o))){const i=t.context.getExtension("OES_texture_half_float"),s=Ha(r),c=Ha(o),u=s*c*t.components;for(let l=0;l<e.length;l++)if(null!==e[l]){let d=null;const f=o/c,p=r/s;let g=!1;t.openGLDataType===t.context.FLOAT?d=new Float32Array(u):i&&t.openGLDataType===i.HALF_FLOAT_OES?(d=new Uint16Array(u),g=!0):d=new Uint8Array(u);for(let t=0;t<c;t++){const n=t*s*a,i=t*f;let c=Math.floor(i),u=Math.ceil(i);u>=o&&(u=o-1);const m=i-c,h=1-m;c=c*r*a,u=u*r*a;for(let t=0;t<s;t++){const o=t*a,i=t*p;let s=Math.floor(i),f=Math.ceil(i);f>=r&&(f=r-1);const y=i-s;s*=a,f*=a;for(let t=0;t<a;t++)d[n+o+t]=g?Hs.toHalf(Hs.fromHalf(e[l][c+s+t])*h*(1-y)+Hs.fromHalf(e[l][c+f+t])*h*y+Hs.fromHalf(e[l][u+s+t])*m*(1-y)+Hs.fromHalf(e[l][u+f+t])*m*y):e[l][c+s+t]*h*(1-y)+e[l][c+f+t]*h*y+e[l][u+s+t]*m*(1-y)+e[l][u+f+t]*m*y}}n.push(d),t.width=s,t.height=c}else n.push(null)}if(0===n.length)for(let t=0;t<e.length;t++)n.push(e[t]);return n}function o(e){if(t._openGLRenderWindow){if(t.resizable||t.renderable?.getResizable())return!1;if(t._openGLRenderWindow.getWebgl2()){return!(t._openGLRenderWindow.getGLInformations().RENDERER.value.match(/WebKit/gi)&&navigator.platform.match(/Mac/gi)&&t.oglNorm16Ext)||e!==rc.UNSIGNED_SHORT&&e!==rc.SHORT}return!1}return!1}function a(n,r){const o=n.getNumberOfComponents(),a=n.getDataType(),i=n.getData(),s=new Array(o),c=new Array(o);for(let e=0;e<o;++e){const[t,r]=n.getRange(e);s[e]=t,c[e]=r}const u=function(e,t,n){const r=new Array(n),o=new Array(n);for(let a=0;a<n;++a)r[a]=e[a],o[a]=t[a]-e[a]||1;return{scale:o,offset:r}}(s,c,o);return function(n,r,o,a){e.getOpenGLDataType(n);let i=!1;if(t._openGLRenderWindow.getWebgl2())i=t.openGLDataType===t.context.HALF_FLOAT;else{const e=t.context.getExtension("OES_texture_half_float");i=e&&t.openGLDataType===e.HALF_FLOAT_OES}const s=i&&(function(e,t){for(let n=0;n<e.length;n++){const r=e[n],o=t[n]+r;if(r<-2048||r>2048||o<-2048||o>2048)return!1}return!0}(r,o)||a);t.useHalfFloat=s}(a,u.offset,u.scale,r),t.useHalfFloat||e.getOpenGLDataType(a,!0),{numComps:o,dataType:a,data:i,scaleOffsets:u}}t.classHierarchy.push("vtkOpenGLTexture"),e.render=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(n?t._openGLRenderWindow=n:(t._openGLRenderer=e.getFirstAncestorOfType("vtkOpenGLRenderer"),t._openGLRenderWindow=t._openGLRenderer.getParent()),t.context=t._openGLRenderWindow.getContext(),t.renderable.getInterpolate()?(t.generateMipmap?e.setMinificationFilter(nc.LINEAR_MIPMAP_LINEAR):e.setMinificationFilter(nc.LINEAR),e.setMagnificationFilter(nc.LINEAR)):(e.setMinificationFilter(nc.NEAREST),e.setMagnificationFilter(nc.NEAREST)),t.renderable.getRepeat()&&(e.setWrapR(tc.REPEAT),e.setWrapS(tc.REPEAT),e.setWrapT(tc.REPEAT)),t.renderable.getInputData()&&t.renderable.setImage(null),!t.handle||t.renderable.getMTime()>t.textureBuildTime.getMTime()){if(null!==t.renderable.getImage()&&(t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(nc.LINEAR_MIPMAP_LINEAR)),t.renderable.getImage()&&t.renderable.getImageLoaded()&&(e.create2DFromImage(t.renderable.getImage()),e.activate(),e.sendParameters(),t.textureBuildTime.modified())),null!==t.renderable.getCanvas()){t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(nc.LINEAR_MIPMAP_LINEAR));const n=t.renderable.getCanvas();e.create2DFromRaw(n.width,n.height,4,rc.UNSIGNED_CHAR,n,!0),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}if(null!==t.renderable.getJsImageData()){const n=t.renderable.getJsImageData();t.renderable.getInterpolate()&&(t.generateMipmap=!0,e.setMinificationFilter(nc.LINEAR_MIPMAP_LINEAR)),e.create2DFromRaw(n.width,n.height,4,rc.UNSIGNED_CHAR,n.data,!0),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}const n=t.renderable.getInputData(0);if(n&&n.getPointData().getScalars()){const r=n.getExtent(),o=n.getPointData().getScalars(),a=[];for(let e=0;e<t.renderable.getNumberOfInputPorts();++e){const n=t.renderable.getInputData(e),r=n?n.getPointData().getScalars().getData():null;r&&a.push(r)}t.renderable.getInterpolate()&&4===o.getNumberOfComponents()&&(t.generateMipmap=!0,e.setMinificationFilter(nc.LINEAR_MIPMAP_LINEAR)),a.length%6==0?e.createCubeFromRaw(r[1]-r[0]+1,r[3]-r[2]+1,o.getNumberOfComponents(),o.getDataType(),a):e.create2DFromRaw(r[1]-r[0]+1,r[3]-r[2]+1,o.getNumberOfComponents(),o.getDataType(),o.getData()),e.activate(),e.sendParameters(),t.textureBuildTime.modified()}}t.handle&&e.activate()},e.destroyTexture=()=>{e.deactivate(),t.context&&t.handle&&t.context.deleteTexture(t.handle),t.handle=0,t.numberOfDimensions=0,t.target=0,t.components=0,t.width=0,t.height=0,t.depth=0,e.resetFormatAndType()},e.createTexture=()=>{t.handle||(t.handle=t.context.createTexture(),t.target&&(t.context.bindTexture(t.target,t.handle),t.context.texParameteri(t.target,t.context.TEXTURE_MIN_FILTER,e.getOpenGLFilterMode(t.minificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_MAG_FILTER,e.getOpenGLFilterMode(t.magnificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_S,e.getOpenGLWrapMode(t.wrapS)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_T,e.getOpenGLWrapMode(t.wrapT)),t._openGLRenderWindow.getWebgl2()&&t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_R,e.getOpenGLWrapMode(t.wrapR)),t.context.bindTexture(t.target,null)))},e.getTextureUnit=()=>t._openGLRenderWindow?t._openGLRenderWindow.getTextureUnitForTexture(e):-1,e.activate=()=>{t._openGLRenderWindow.activateTexture(e),e.bind()},e.deactivate=()=>{t._openGLRenderWindow&&t._openGLRenderWindow.deactivateTexture(e)},e.releaseGraphicsResources=n=>{n&&t.handle&&(n.activateTexture(e),n.deactivateTexture(e),t.context.deleteTexture(t.handle),t.handle=0,t.numberOfDimensions=0,t.target=0,t.internalFormat=0,t.format=0,t.openGLDataType=0,t.components=0,t.width=0,t.height=0,t.depth=0,t.allocatedGPUMemoryInBytes=0),t.shaderProgram&&(t.shaderProgram.releaseGraphicsResources(n),t.shaderProgram=null)},e.bind=()=>{t.context.bindTexture(t.target,t.handle),t.autoParameters&&e.getMTime()>t.sendParametersTime.getMTime()&&e.sendParameters()},e.isBound=()=>{let e=!1;if(t.context&&t.handle){let n=0;if(t.target===t.context.TEXTURE_2D)n=t.context.TEXTURE_BINDING_2D;else ic("impossible case");e=t.context.getIntegerv(n)===t.handle}return e},e.sendParameters=()=>{t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_S,e.getOpenGLWrapMode(t.wrapS)),t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_T,e.getOpenGLWrapMode(t.wrapT)),t._openGLRenderWindow.getWebgl2()&&t.context.texParameteri(t.target,t.context.TEXTURE_WRAP_R,e.getOpenGLWrapMode(t.wrapR)),t.context.texParameteri(t.target,t.context.TEXTURE_MIN_FILTER,e.getOpenGLFilterMode(t.minificationFilter)),t.context.texParameteri(t.target,t.context.TEXTURE_MAG_FILTER,e.getOpenGLFilterMode(t.magnificationFilter)),t._openGLRenderWindow.getWebgl2()&&(t.context.texParameteri(t.target,t.context.TEXTURE_BASE_LEVEL,t.baseLevel),t.context.texParameteri(t.target,t.context.TEXTURE_MAX_LEVEL,t.maxLevel)),t.sendParametersTime.modified()},e.getInternalFormat=(n,r)=>(t._forceInternalFormat||(t.internalFormat=e.getDefaultInternalFormat(n,r)),t.internalFormat||oc(`Unable to find suitable internal format for T=${n} NC= ${r}`),t.internalFormat),e.getDefaultInternalFormat=(e,n)=>{let r=0;return r=t._openGLRenderWindow.getDefaultTextureInternalFormat(e,n,t.oglNorm16Ext,t.useHalfFloat),r||(r||(oc("Unsupported internal texture type!"),oc(`Unable to find suitable internal format for T=${e} NC= ${n}`)),r)},e.setInternalFormat=n=>{t._forceInternalFormat=!0,n!==t.internalFormat&&(t.internalFormat=n,e.modified())},e.getFormat=(n,r)=>(t.format=e.getDefaultFormat(n,r),t.format),e.getDefaultFormat=(e,n)=>{if(t._openGLRenderWindow.getWebgl2())switch(n){case 1:return t.context.RED;case 2:return t.context.RG;case 3:default:return t.context.RGB;case 4:return t.context.RGBA}else switch(n){case 1:return t.context.LUMINANCE;case 2:return t.context.LUMINANCE_ALPHA;case 3:default:return t.context.RGB;case 4:return t.context.RGBA}},e.resetFormatAndType=()=>{t.format=0,t.internalFormat=0,t._forceInternalFormat=!1,t.openGLDataType=0},e.getDefaultDataType=e=>{if(t._openGLRenderWindow.getWebgl2())switch(e){case rc.UNSIGNED_CHAR:return t.context.UNSIGNED_BYTE;case t.oglNorm16Ext&&!t.useHalfFloat&&rc.SHORT:return t.context.SHORT;case t.oglNorm16Ext&&!t.useHalfFloat&&rc.UNSIGNED_SHORT:return t.context.UNSIGNED_SHORT;case t.useHalfFloat&&rc.SHORT:case t.useHalfFloat&&rc.UNSIGNED_SHORT:return t.context.HALF_FLOAT;case rc.FLOAT:case rc.VOID:default:return t.context.FLOAT}switch(e){case rc.UNSIGNED_CHAR:return t.context.UNSIGNED_BYTE;case rc.FLOAT:case rc.VOID:default:if(t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear"))return t.context.FLOAT;{const e=t.context.getExtension("OES_texture_half_float");if(e&&t.context.getExtension("OES_texture_half_float_linear"))return e.HALF_FLOAT_OES}return t.context.UNSIGNED_BYTE}},e.getOpenGLDataType=function(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.openGLDataType&&!r||(t.openGLDataType=e.getDefaultDataType(n)),t.openGLDataType},e.getShiftAndScale=()=>{let e=0,n=1;switch(t.openGLDataType){case t.context.BYTE:n=127.5,e=n-128;break;case t.context.UNSIGNED_BYTE:n=255,e=0;break;case t.context.SHORT:n=32767.5,e=n-32768;break;case t.context.UNSIGNED_SHORT:n=65536,e=0;break;case t.context.INT:n=2147483647.5,e=n-2147483648;break;case t.context.UNSIGNED_INT:n=4294967295,e=0;case t.context.FLOAT:}return{shift:e,scale:n}},e.getOpenGLFilterMode=e=>{switch(e){case nc.NEAREST:return t.context.NEAREST;case nc.LINEAR:return t.context.LINEAR;case nc.NEAREST_MIPMAP_NEAREST:return t.context.NEAREST_MIPMAP_NEAREST;case nc.NEAREST_MIPMAP_LINEAR:return t.context.NEAREST_MIPMAP_LINEAR;case nc.LINEAR_MIPMAP_NEAREST:return t.context.LINEAR_MIPMAP_NEAREST;case nc.LINEAR_MIPMAP_LINEAR:return t.context.LINEAR_MIPMAP_LINEAR;default:return t.context.NEAREST}},e.getOpenGLWrapMode=e=>{switch(e){case tc.CLAMP_TO_EDGE:return t.context.CLAMP_TO_EDGE;case tc.REPEAT:return t.context.REPEAT;case tc.MIRRORED_REPEAT:return t.context.MIRRORED_REPEAT;default:return t.context.CLAMP_TO_EDGE}},e.create2DFromRaw=function(a,i,s,c,u){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e.getOpenGLDataType(c,!0),e.getInternalFormat(c,s),e.getFormat(c,s),!t.internalFormat||!t.format||!t.openGLDataType)return ac("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=s,t.width=a,t.height=i,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind();const d=r(n(c,[u]));return t.context.pixelStorei(t.context.UNPACK_FLIP_Y_WEBGL,l),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),o(c)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=d[0]&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,d[0])):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,d[0]),t.generateMipmap&&t.context.generateMipmap(t.target),l&&t.context.pixelStorei(t.context.UNPACK_FLIP_Y_WEBGL,!1),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*s*t._openGLRenderWindow.getDefaultTextureByteSize(c,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.createCubeFromRaw=(a,i,s,c,u)=>{if(e.getOpenGLDataType(c),e.getInternalFormat(c,s),e.getFormat(c,s),!t.internalFormat||!t.format||!t.openGLDataType)return ac("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_CUBE_MAP,t.components=s,t.width=a,t.height=i,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),t.maxLevel=u.length/6-1,e.createTexture(),e.bind();const l=r(n(c,u)),d=[];let f=t.width,p=t.height;for(let e=0;e<l.length;e++){e%6==0&&0!==e&&(f/=2,p/=2),d[e]=Mo(c,p*f*t.components);for(let n=0;n<p;++n){const r=n*f*t.components,o=(p-n-1)*f*t.components;d[e].set(l[e].slice(o,o+f*t.components),r)}}t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),o(c)&&t.context.texStorage2D(t.target,6,t.internalFormat,t.width,t.height);for(let e=0;e<6;e++){let n=0,r=t.width,a=t.height;for(;r>=1&&a>=1;){let i=null;n<=t.maxLevel&&(i=d[6*n+e]),o(c)?null!=i&&t.context.texSubImage2D(t.context.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,r,a,t.format,t.openGLDataType,i):t.context.texImage2D(t.context.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,t.internalFormat,r,a,0,t.format,t.openGLDataType,i),n++,r/=2,a/=2}}return t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*s*t._openGLRenderWindow.getDefaultTextureByteSize(c,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.createDepthFromRaw=(n,r,a,i)=>(e.getOpenGLDataType(a),t.format=t.context.DEPTH_COMPONENT,t._openGLRenderWindow.getWebgl2()?a===rc.FLOAT?t.internalFormat=t.context.DEPTH_COMPONENT32F:t.internalFormat=t.context.DEPTH_COMPONENT16:t.internalFormat=t.context.DEPTH_COMPONENT,t.internalFormat&&t.format&&t.openGLDataType?(t.target=t.context.TEXTURE_2D,t.components=1,t.width=n,t.height=r,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),o(a)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=i&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,i)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,i),t.generateMipmap&&t.context.generateMipmap(t.target),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*t.components*t._openGLRenderWindow.getDefaultTextureByteSize(a,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0):(ac("Failed to determine texture parameters."),!1)),e.create2DFromImage=n=>{if(e.getOpenGLDataType(rc.UNSIGNED_CHAR),e.getInternalFormat(rc.UNSIGNED_CHAR,4),e.getFormat(rc.UNSIGNED_CHAR,4),!t.internalFormat||!t.format||!t.openGLDataType)return ac("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=4,t.depth=1,t.numberOfDimensions=2,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1);const r=!(t._openGLRenderWindow.getWebgl2()||Wa(n.width)&&Wa(n.height)),a=document.createElement("canvas");a.width=r?Ha(n.width):n.width,a.height=r?Ha(n.height):n.height,t.width=a.width,t.height=a.height;const i=a.getContext("2d");i.translate(0,a.height),i.scale(1,-1),i.drawImage(n,0,0,n.width,n.height,0,0,a.width,a.height);const s=a;return o(rc.UNSIGNED_CHAR)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=s&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,s)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,s),t.generateMipmap&&t.context.generateMipmap(t.target),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*t.components*t._openGLRenderWindow.getDefaultTextureByteSize(rc.UNSIGNED_CHAR,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.create2DFilterableFromRaw=function(t,n,r,o,a){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return e.create2DFilterableFromDataArray(t,n,Ii.newInstance({numberOfComponents:r,dataType:o,values:a}),i)},e.create2DFilterableFromDataArray=function(t,n,r){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const{numComps:i,dataType:s,data:c}=a(r,o);e.create2DFromRaw(t,n,i,s,c)},e.create3DFromRaw=(a,i,s,c,u,l)=>{if(e.getOpenGLDataType(u),e.getInternalFormat(u,c),e.getFormat(u,c),!t.internalFormat||!t.format||!t.openGLDataType)return ac("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_3D,t.components=c,t.width=a,t.height=i,t.depth=s,t.numberOfDimensions=3,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind();const d=r(n(u,[l],!0));return t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),o(u)?(t.context.texStorage3D(t.target,1,t.internalFormat,t.width,t.height,t.depth),null!=d[0]&&t.context.texSubImage3D(t.target,0,0,0,0,t.width,t.height,t.depth,t.format,t.openGLDataType,d[0])):t.context.texImage3D(t.target,0,t.internalFormat,t.width,t.height,t.depth,0,t.format,t.openGLDataType,d[0]),t.generateMipmap&&t.context.generateMipmap(t.target),t.allocatedGPUMemoryInBytes=t.width*t.height*t.depth*t.components*t._openGLRenderWindow.getDefaultTextureByteSize(u,t.oglNorm16Ext,t.useHalfFloat),e.deactivate(),!0},e.create3DFilterableFromRaw=function(t,n,r,o,a,i){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return e.create3DFilterableFromDataArray(t,n,r,Ii.newInstance({numberOfComponents:o,dataType:a,values:i}),s)},e.create3DFilterableFromDataArray=function(n,r,i,s){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{numComps:u,dataType:l,data:d,scaleOffsets:f}=a(s,c),p=n*r*i,g=[],m=[];for(let e=0;e<u;++e)g[e]=0,m[e]=1;t.volumeInfo={scale:m,offset:g,dataComputedScale:f.scale,dataComputedOffset:f.offset,width:n,height:r,depth:i};const h=structuredClone(f);if(t._openGLRenderWindow.getWebgl2()){if(t.oglNorm16Ext&&!t.useHalfFloat&&l===rc.SHORT){for(let e=0;e<u;++e)t.volumeInfo.scale[e]=32767;return e.create3DFromRaw(n,r,i,u,l,d)}if(t.oglNorm16Ext&&!t.useHalfFloat&&l===rc.UNSIGNED_SHORT){for(let e=0;e<u;++e)t.volumeInfo.scale[e]=65535;return e.create3DFromRaw(n,r,i,u,l,d)}if(l===rc.FLOAT||t.useHalfFloat&&(l===rc.SHORT||l===rc.UNSIGNED_SHORT))return e.create3DFromRaw(n,r,i,u,l,d);if(l===rc.UNSIGNED_CHAR){for(let e=0;e<u;++e)t.volumeInfo.scale[e]=255;return e.create3DFromRaw(n,r,i,u,l,d)}const o=new Float32Array(p*u);t.volumeInfo.offset=h.offset,t.volumeInfo.scale=h.scale;let a=0;const s=h.scale.map((e=>1/e));for(let e=0;e<p;e++)for(let e=0;e<u;e++)o[a]=(d[a]-h.offset[e])*s[e],a++;return e.create3DFromRaw(n,r,i,u,rc.FLOAT,o)}let y=(e,t,n,r,o)=>{e[t]=n},I=rc.UNSIGNED_CHAR;if(l===rc.UNSIGNED_CHAR)for(let e=0;e<u;++e)h.offset[e]=0,h.scale[e]=255;else t.context.getExtension("OES_texture_float")&&t.context.getExtension("OES_texture_float_linear")?(I=rc.FLOAT,y=(e,t,n,r,o)=>{e[t]=(n-r)/o}):(I=rc.UNSIGNED_CHAR,y=(e,t,n,r,o)=>{e[t]=255*(n-r)/o});if(e.getOpenGLDataType(I),e.getInternalFormat(I,u),e.getFormat(I,u),!t.internalFormat||!t.format||!t.openGLDataType)return ac("Failed to determine texture parameters."),!1;t.target=t.context.TEXTURE_2D,t.components=u,t.depth=1,t.numberOfDimensions=2;let v=t.context.getParameter(t.context.MAX_TEXTURE_SIZE);v>4096&&(I===rc.FLOAT||u>=3)&&(v=4096);let T=1,E=1;p>v*v&&(T=Math.ceil(Math.sqrt(p/(v*v))),E=T);let b=Math.sqrt(p)/T;b=Ha(b);const A=Math.floor(b*T/n),O=Math.ceil(i/A),S=Ha(r*O/E);let C;t.width=b,t.height=S,t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),t.volumeInfo.xreps=A,t.volumeInfo.yreps=O,t.volumeInfo.xstride=T,t.volumeInfo.ystride=E,t.volumeInfo.offset=h.offset,t.volumeInfo.scale=h.scale;const D=b*S*u;C=I===rc.FLOAT?new Float32Array(D):new Uint8Array(D);let x=0;const _=Math.floor(n/T),w=Math.floor(r/E);for(let e=0;e<O;e++){const o=Math.min(A,i-e*A),a=u*(t.width-o*Math.floor(n/T));for(let t=0;t<w;t++){for(let a=0;a<o;a++){const o=u*((e*A+a)*n*r+E*t*n);for(let e=0;e<_;e++)for(let t=0;t<u;t++)y(C,x,d[o+T*e*u+t],h.offset[t],h.scale[t]),x++}x+=a}}return t.context.pixelStorei(t.context.UNPACK_ALIGNMENT,1),o(I)?(t.context.texStorage2D(t.target,1,t.internalFormat,t.width,t.height),null!=C&&t.context.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.openGLDataType,C)):t.context.texImage2D(t.target,0,t.internalFormat,t.width,t.height,0,t.format,t.openGLDataType,C),e.deactivate(),!0},e.setOpenGLRenderWindow=n=>{t._openGLRenderWindow!==n&&(e.releaseGraphicsResources(),t._openGLRenderWindow=n,t.context=null,n&&(t.context=t._openGLRenderWindow.getContext()))},e.getMaximumTextureSize=e=>e&&e.isCurrent()?e.getIntegerv(e.MAX_TEXTURE_SIZE):-1}const uc={_openGLRenderWindow:null,_forceInternalFormat:!1,context:null,handle:0,sendParametersTime:null,textureBuildTime:null,numberOfDimensions:0,target:0,format:0,openGLDataType:0,components:0,width:0,height:0,depth:0,autoParameters:!0,wrapS:tc.CLAMP_TO_EDGE,wrapT:tc.CLAMP_TO_EDGE,wrapR:tc.CLAMP_TO_EDGE,minificationFilter:nc.NEAREST,magnificationFilter:nc.NEAREST,minLOD:-1e3,maxLOD:1e3,baseLevel:0,maxLevel:1e3,generateMipmap:!1,useHalfFloat:!0,oglNorm16Ext:null,allocatedGPUMemoryInBytes:0};function lc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,uc,n),Ks.extend(e,t,n),t.sendParametersTime={},Ho(t.sendParametersTime,{mtime:0}),t.textureBuildTime={},Ho(t.textureBuildTime,{mtime:0}),Xo(e,t,["format","openGLDataType"]),Qo(e,t,["keyMatrixTime","minificationFilter","magnificationFilter","wrapS","wrapT","wrapR","generateMipmap","oglNorm16Ext"]),Yo(e,t,["width","height","volumeInfo","components","handle","target","allocatedGPUMemoryInBytes"]),ta(0,t,["openGLRenderWindow"]),cc(e,t)}const dc=aa(lc,"vtkOpenGLTexture");var fc,pc={newInstance:dc,extend:lc,...Bs};fc=dc,Js["vtkTexture"]=fc;const{vtkErrorMacro:gc}=Ia,mc=[1,-1,1,-1,1,-1];const hc={empty:!0,numberOfComponents:3,dataType:ai.FLOAT,bounds:[1,-1,1,-1,1,-1]};function yc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,hc,n),Ii.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkPoints"),e.getNumberOfPoints=e.getNumberOfTuples,e.setNumberOfPoints=function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;e.getNumberOfPoints()!==n&&(t.size=n*r,t.values=Ia.newTypedArray(t.dataType,t.size),e.setNumberOfComponents(r),e.modified())},e.setPoint=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];e.setTuple(t,r)},e.getPoint=e.getTuple,e.findPoint=e.findTuple,e.insertNextPoint=(t,n,r)=>e.insertNextTuple([t,n,r]),e.getBounds=()=>{if(3===e.getNumberOfComponents()){const n=e.getRange(0);t.bounds[0]=n[0],t.bounds[1]=n[1];const r=e.getRange(1);t.bounds[2]=r[0],t.bounds[3]=r[1];const o=e.getRange(2);return t.bounds[4]=o[0],t.bounds[5]=o[1],t.bounds}if(2!==e.getNumberOfComponents())return gc(`getBounds called on an array with components of\n        ${e.getNumberOfComponents()}`),mc;const n=e.getRange(0);t.bounds[0]=n[0],t.bounds[1]=n[1];const r=e.getRange(1);return t.bounds[2]=r[0],t.bounds[3]=r[1],t.bounds[4]=0,t.bounds[5]=0,t.bounds},e.computeBounds=e.getBounds,e.setNumberOfComponents(t.numberOfComponents<2?3:t.numberOfComponents)}(e,t)}var Ic={newInstance:Ia.newInstance(yc,"vtkPoints"),extend:yc};function vc(e){let t=0;return e.filter(((e,n)=>n===t&&(t+=e+1,!0)))}function Tc(e){let t=0;for(let n=0;n<e.length;)n+=e[n]+1,t++;return t}const Ec={extractCellSizes:vc,getNumberOfCells:Tc};function bc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Ii.extend(e,t,function(e){return{empty:!0,numberOfComponents:1,dataType:ai.UNSIGNED_INT,...e}}(n)),function(e,t){t.classHierarchy.push("vtkCellArray");const n={...e};e.getNumberOfCells=n=>void 0===t.numberOfCells||n?(t.cellSizes?t.numberOfCells=t.cellSizes.length:t.numberOfCells=Tc(e.getData()),t.numberOfCells):t.numberOfCells,e.getCellSizes=n=>void 0===t.cellSizes||n?(t.cellSizes=vc(e.getData()),t.cellSizes):t.cellSizes,e.resize=r=>{const o=e.getNumberOfTuples();n.resize(r);const a=e.getNumberOfTuples();a<o&&(0===a?(t.numberOfCells=0,t.cellSizes=[]):(t.numberOfCells=void 0,t.cellSizes=void 0))},e.setData=e=>{n.setData(e,1),t.numberOfCells=void 0,t.cellSizes=void 0},e.getCell=e=>{let n=e;const r=t.values[n++];return t.values.subarray(n,n+r)},e.insertNextCell=n=>{const r=e.getNumberOfCells();return e.insertNextTuples([n.length,...n]),++t.numberOfCells,null!=t.cellSizes&&t.cellSizes.push(n.length),r}}(e,t)}var Ac={newInstance:Ia.newInstance(bc,"vtkCellArray"),extend:bc,...Ec};const Oc={bounds:[-1,-1,-1,-1,-1,-1],pointsIds:[]};function Sc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Oc,n),Ia.obj(e,t),t.points||(t.points=Ic.newInstance()),Ia.get(e,t,["points","pointsIds"]),function(e,t){t.classHierarchy.push("vtkCell"),e.initialize=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n){t.pointsIds=n;let r=t.points.getData();r.length!==3*t.pointsIds.length&&(r=Ia.newTypedArray(e.getDataType(),3*t.pointsIds.length));const o=e.getData();t.pointsIds.forEach(((e,t)=>{let n=3*e,a=3*t;r[a]=o[n],r[++a]=o[++n],r[++a]=o[++n]})),t.points.setData(r)}else{t.points=e,t.pointsIds=new Array(e.getNumberOfPoints());for(let n=e.getNumberOfPoints()-1;n>=0;--n)t.pointsIds[n]=n}},e.getBounds=()=>{const e=t.points.getNumberOfPoints(),n=[];if(e){t.points.getPoint(0,n),t.bounds[0]=n[0],t.bounds[1]=n[0],t.bounds[2]=n[1],t.bounds[3]=n[1],t.bounds[4]=n[2],t.bounds[5]=n[2];for(let r=1;r<e;r++)t.points.getPoint(r,n),t.bounds[0]=n[0]<t.bounds[0]?n[0]:t.bounds[0],t.bounds[1]=n[0]>t.bounds[1]?n[0]:t.bounds[1],t.bounds[2]=n[1]<t.bounds[2]?n[1]:t.bounds[2],t.bounds[3]=n[1]>t.bounds[3]?n[1]:t.bounds[3],t.bounds[4]=n[2]<t.bounds[4]?n[2]:t.bounds[4],t.bounds[5]=n[2]>t.bounds[5]?n[2]:t.bounds[5]}else(r=t.bounds)[0]=1,r[1]=-1,r[2]=1,r[3]=-1,r[4]=1,r[5]=-1;var r;return t.bounds},e.getLength2=()=>{e.getBounds();let n=0,r=0;for(let e=0;e<3;e++)r=t.bounds[2*e+1]-t.bounds[2*e],n+=r*r;return n},e.getParametricDistance=e=>{let t,n=0;for(let r=0;r<3;r++)t=e[r]<0?-e[r]:e[r]>1?e[r]-1:0,t>n&&(n=t);return n},e.getNumberOfPoints=()=>t.points.getNumberOfPoints(),e.deepCopy=e=>{e.initialize(t.points,t.pointsIds)},e.getCellDimension=()=>{},e.intersectWithLine=(e,t,n,r,o,a,i)=>{},e.evaluatePosition=(e,t,n,r,o,a)=>{Ia.vtkErrorMacro("vtkCell.evaluatePosition is not implemented.")}}(e,t)}var Cc={newInstance:Ia.newInstance(Sc,"vtkCell"),extend:Sc};const Dc={array:null,maxId:0,extend:0};function xc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Dc,n),Ia.obj(e,t),function(e,t){t.classHierarchy.push("vtkCellLinks"),e.buildLinks=n=>{const r=n.getPoints().getNumberOfPoints(),o=n.getNumberOfCells(),a=new Uint32Array(r);if(n.isA("vtkPolyData")){for(let t=0;t<o;++t){const{cellPointIds:r}=n.getCellPoints(t);r.forEach((t=>{e.incrementLinkCount(t)}))}e.allocateLinks(r),t.maxId=r-1;for(let t=0;t<o;++t){const{cellPointIds:r}=n.getCellPoints(t);r.forEach((n=>{e.insertCellReference(n,a[n]++,t)}))}}else{for(let t=0;t<o;t++)Cc.newInstance().getPointsIds().forEach((t=>{e.incrementLinkCount(t)}));e.allocateLinks(r),t.maxId=r-1;for(let t=0;t<o;++t)Cc.newInstance().getPointsIds().forEach((n=>{e.insertCellReference(n,a[n]++,t)}))}},e.allocate=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;t.array=Array(e).fill().map((()=>({ncells:0,cells:null}))),t.extend=n,t.maxId=-1},e.initialize=()=>{t.array=null},e.getLink=e=>t.array[e],e.getNcells=e=>t.array[e].ncells,e.getCells=e=>t.array[e].cells,e.insertNextPoint=e=>{t.array.push({ncells:e,cells:Array(e)}),++t.maxId},e.insertNextCellReference=(e,n)=>{t.array[e].cells[t.array[e].ncells++]=n},e.deletePoint=e=>{t.array[e].ncells=0,t.array[e].cells=null},e.removeCellReference=(e,n)=>{t.array[n].cells=t.array[n].cells.filter((t=>t!==e)),t.array[n].ncells=t.array[n].cells.length},e.addCellReference=(e,n)=>{t.array[n].cells[t.array[n].ncells++]=e},e.resizeCellList=(e,n)=>{t.array[e].cells.length=n},e.squeeze=()=>{!function(e,t){let n=t;for(t>=e.array.length&&(n+=e.array.length);n>e.array.length;)e.array.push({ncells:0,cells:null});e.array.length=n}(t,t.maxId+1)},e.reset=()=>{t.maxId=-1},e.deepCopy=e=>{t.array=[...e.array],t.extend=e.extend,t.maxId=e.maxId},e.incrementLinkCount=e=>{++t.array[e].ncells},e.allocateLinks=e=>{for(let n=0;n<e;++n)t.array[n].cells=new Array(t.array[n].ncells)},e.insertCellReference=(e,n,r)=>{t.array[e].cells[n]=r}}(e,t)}var _c={newInstance:Ia.newInstance(xc,"vtkCellLinks"),extend:xc};const wc={VTK_EMPTY_CELL:0,VTK_VERTEX:1,VTK_POLY_VERTEX:2,VTK_LINE:3,VTK_POLY_LINE:4,VTK_TRIANGLE:5,VTK_TRIANGLE_STRIP:6,VTK_POLYGON:7,VTK_PIXEL:8,VTK_QUAD:9,VTK_TETRA:10,VTK_VOXEL:11,VTK_HEXAHEDRON:12,VTK_WEDGE:13,VTK_PYRAMID:14,VTK_PENTAGONAL_PRISM:15,VTK_HEXAGONAL_PRISM:16,VTK_QUADRATIC_EDGE:21,VTK_QUADRATIC_TRIANGLE:22,VTK_QUADRATIC_QUAD:23,VTK_QUADRATIC_POLYGON:36,VTK_QUADRATIC_TETRA:24,VTK_QUADRATIC_HEXAHEDRON:25,VTK_QUADRATIC_WEDGE:26,VTK_QUADRATIC_PYRAMID:27,VTK_BIQUADRATIC_QUAD:28,VTK_TRIQUADRATIC_HEXAHEDRON:29,VTK_QUADRATIC_LINEAR_QUAD:30,VTK_QUADRATIC_LINEAR_WEDGE:31,VTK_BIQUADRATIC_QUADRATIC_WEDGE:32,VTK_BIQUADRATIC_QUADRATIC_HEXAHEDRON:33,VTK_BIQUADRATIC_TRIANGLE:34,VTK_CUBIC_LINE:35,VTK_CONVEX_POINT_SET:41,VTK_POLYHEDRON:42,VTK_PARAMETRIC_CURVE:51,VTK_PARAMETRIC_SURFACE:52,VTK_PARAMETRIC_TRI_SURFACE:53,VTK_PARAMETRIC_QUAD_SURFACE:54,VTK_PARAMETRIC_TETRA_REGION:55,VTK_PARAMETRIC_HEX_REGION:56,VTK_HIGHER_ORDER_EDGE:60,VTK_HIGHER_ORDER_TRIANGLE:61,VTK_HIGHER_ORDER_QUAD:62,VTK_HIGHER_ORDER_POLYGON:63,VTK_HIGHER_ORDER_TETRAHEDRON:64,VTK_HIGHER_ORDER_WEDGE:65,VTK_HIGHER_ORDER_PYRAMID:66,VTK_HIGHER_ORDER_HEXAHEDRON:67,VTK_LAGRANGE_CURVE:68,VTK_LAGRANGE_TRIANGLE:69,VTK_LAGRANGE_QUADRILATERAL:70,VTK_LAGRANGE_TETRAHEDRON:71,VTK_LAGRANGE_HEXAHEDRON:72,VTK_LAGRANGE_WEDGE:73,VTK_LAGRANGE_PYRAMID:74,VTK_NUMBER_OF_CELL_TYPES:75},Rc=["vtkEmptyCell","vtkVertex","vtkPolyVertex","vtkLine","vtkPolyLine","vtkTriangle","vtkTriangleStrip","vtkPolygon","vtkPixel","vtkQuad","vtkTetra","vtkVoxel","vtkHexahedron","vtkWedge","vtkPyramid","vtkPentagonalPrism","vtkHexagonalPrism","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkQuadraticEdge","vtkQuadraticTriangle","vtkQuadraticQuad","vtkQuadraticTetra","vtkQuadraticHexahedron","vtkQuadraticWedge","vtkQuadraticPyramid","vtkBiQuadraticQuad","vtkTriQuadraticHexahedron","vtkQuadraticLinearQuad","vtkQuadraticLinearWedge","vtkBiQuadraticQuadraticWedge","vtkBiQuadraticQuadraticHexahedron","vtkBiQuadraticTriangle","vtkCubicLine","vtkQuadraticPolygon","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkConvexPointSet","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","UnknownClass","vtkParametricCurve","vtkParametricSurface","vtkParametricTriSurface","vtkParametricQuadSurface","vtkParametricTetraRegion","vtkParametricHexRegion","UnknownClass","UnknownClass","UnknownClass","vtkHigherOrderEdge","vtkHigherOrderTriangle","vtkHigherOrderQuad","vtkHigherOrderPolygon","vtkHigherOrderTetrahedron","vtkHigherOrderWedge","vtkHigherOrderPyramid","vtkHigherOrderHexahedron"];const Nc={getClassNameFromTypeId:function(e){return e<Rc.length?Rc[e]:"UnknownClass"},getTypeIdFromClassName:function(e){return Rc.findIndex(e)},isLinear:function(e){return e<wc.VTK_QUADRATIC_EDGE||e===wc.VTK_CONVEX_POINT_SET||e===wc.VTK_POLYHEDRON},hasSubCells:function(e){return e===wc.VTK_TRIANGLE_STRIP||e===wc.VTK_POLY_LINE||e===wc.VTK_POLY_VERTEX}};const Pc={size:0,maxId:-1,extend:1e3};function Mc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Pc,n),Ia.obj(e,t),Ia.get(e,t,["size","maxId","extend"]),Ia.getArray(e,t,["typeArray","locationArray"]),function(e,t){t.classHierarchy.push("vtkCellTypes"),e.allocate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;t.size=e>0?e:1,t.extend=n>0?n:1,t.maxId=-1,t.typeArray=new Uint8Array(e),t.locationArray=new Uint32Array(e)},e.insertCell=(e,n,r)=>{t.typeArray[e]=n,t.locationArray[e]=r,e>t.maxId&&(t.maxId=e)},e.insertNextCell=(n,r)=>(e.insertCell(++t.maxId,n,r),t.maxId),e.setCellTypes=(e,n,r)=>{t.size=e,t.typeArray=n,t.locationArray=r,t.maxId=e-1},e.getCellLocation=e=>t.locationArray[e],e.deleteCell=e=>{t.typeArray[e]=wc.VTK_EMPTY_CELL},e.getNumberOfTypes=()=>t.maxId+1,e.isType=t=>{const n=e.getNumberOfTypes();for(let r=0;r<n;++r)if(t===e.getCellType(r))return!0;return!1},e.insertNextType=t=>e.insertNextCell(t,-1),e.getCellType=e=>t.typeArray[e],e.reset=()=>{t.maxId=-1},e.deepCopy=n=>{e.allocate(n.getSize(),n.getExtend()),t.typeArray.set(n.getTypeArray()),t.locationArray.set(n.getLocationArray()),t.maxId=n.getMaxId()}}(e,t)}var Lc={newInstance:Ia.newInstance(Mc,"vtkCellTypes"),extend:Mc,...Nc};var Fc={IntersectionState:{NO_INTERSECTION:0,YES_INTERSECTION:1,ON_LINE:2}};const{IntersectionState:Uc}=Fc;function Gc(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const o={t:Number.MIN_VALUE,distance:0},a=[];let i;a[0]=n[0]-t[0],a[1]=n[1]-t[1],a[2]=n[2]-t[2];const s=a[0]*(e[0]-t[0])+a[1]*(e[1]-t[1])+a[2]*(e[2]-t[2]),c=Ka(a,a);let u=1e-5*s;return 0!==c&&(o.t=s/c),u<0&&(u=-u),-u<c&&c<u||c<=0||o.t<0?i=t:o.t>1?i=n:(i=a,a[0]=t[0]+o.t*a[0],a[1]=t[1]+o.t*a[1],a[2]=t[2]+o.t*a[2]),r&&(r[0]=i[0],r[1]=i[1],r[2]=i[2]),o.distance=Za(i,e),o}function kc(e,t,n,r,o,a){const i=[],s=[],c=[];o[0]=0,a[0]=0,Ya(t,e,i),Ya(r,n,s),Ya(n,e,c);const u=[Ka(i,i),-Ka(i,s),-Ka(i,s),Ka(s,s)],l=[];if(l[0]=Ka(i,c),l[1]=-Ka(s,c),0===ni(u,l,2)){let i=Number.MAX_VALUE;const s=[e,t,n,r],c=[n,n,e,e],u=[r,r,t,t];let l;a[0],a[0],o[0],o[0],o[0],o[0],a[0],a[0];for(let e=0;e<4;e++)l=Gc(s[e],c[e],u[e]),l.distance<i&&(i=l.distance);return Uc.ON_LINE}return o[0]=l[0],a[0]=l[1],o[0]>=0&&o[0]<=1&&a[0]>=0&&a[0]<=1?Uc.YES_INTERSECTION:Uc.NO_INTERSECTION}const Vc={distanceToLine:Gc,intersection:kc};const jc={orientations:null};function Bc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,jc,n),Cc.extend(e,t,n),Ia.setGet(e,t,["orientations"]),function(e,t){t.classHierarchy.push("vtkLine"),e.getCellDimension=()=>1,e.intersectWithLine=(e,n,r,o,a)=>{const i={intersect:0,t:Number.MAX_VALUE,subId:0,betweenPoints:null};a[1]=0,a[2]=0;const s=[],c=[],u=[];t.points.getPoint(0,c),t.points.getPoint(1,u);const l=[],d=[],f=kc(e,n,c,u,l,d);var p;if(i.t=l[0],i.betweenPoints=(p=i.t)>=0&&p<=1,a[0]=d[0],f===Uc.YES_INTERSECTION){for(let t=0;t<3;t++)o[t]=c[t]+a[0]*(u[t]-c[t]),s[t]=e[t]+i.t*(n[t]-e[t]);if(Za(o,s)<=r*r)return i.intersect=1,i}else{let t;if(i.t<0)return t=Gc(e,c,u,o),t.distance<=r*r?(i.t=0,i.intersect=1,i.betweenPoints=!0,i):i;if(i.t>1)return t=Gc(n,c,u,o),t.distance<=r*r?(i.t=1,i.intersect=1,i.betweenPoints=!0,i):i;if(a[0]<0)return a[0]=0,t=Gc(c,e,n,o),i.t=t.t,t.distance<=r*r?(i.intersect=1,i):i;if(a[0]>1)return a[0]=1,t=Gc(u,e,n,o),i.t=t.t,t.distance<=r*r?(i.intersect=1,i):i}return i},e.evaluateLocation=(e,n,r)=>{const o=[],a=[];t.points.getPoint(0,o),t.points.getPoint(1,a);for(let t=0;t<3;t++)n[t]=o[t]+e[0]*(a[t]-o[t]);r[0]=1-e[0],r[1]=e[0]},e.evaluateOrientation=(e,n,r)=>!!t.orientations&&(u.gf.slerp(n,t.orientations[0],t.orientations[1],e[0]),r[0]=1-e[0],r[1]=e[0],!0)}(e,t)}var zc={newInstance:Ia.newInstance(Bc,"vtkLine"),extend:Bc,...Vc,...Fc};const qc={};function Hc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,qc,n),Ps.extend(e,t,n),Ia.setGet(e,t,["points"]),function(e,t){t.classHierarchy.push("vtkPointSet"),t.points?t.points=Io(t.points):t.points=Ic.newInstance(),e.getNumberOfPoints=()=>t.points.getNumberOfPoints(),e.getBounds=()=>t.points.getBounds(),e.computeBounds=()=>{e.getBounds()};const n=e.shallowCopy;e.shallowCopy=function(e){n(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),t.points=Ic.newInstance(),t.points.shallowCopy(e.getPoints())}}(e,t)}var Wc={newInstance:Ia.newInstance(Hc,"vtkPointSet"),extend:Hc};function Yc(e,t,n,r){const o=n[0]-t[0],a=n[1]-t[1],i=n[2]-t[2],s=e[0]-t[0],c=e[1]-t[1],u=e[2]-t[2];r[0]=a*u-i*c,r[1]=i*s-o*u,r[2]=o*c-a*s}function $c(e,t,n,r){Yc(e,t,n,r);const o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);0!==o&&(r[0]/=o,r[1]/=o,r[2]/=o)}const Kc={computeNormalDirection:Yc,computeNormal:$c,intersectWithTriangle:function(e,t,n,r,o,a){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1e-6,s=!1;const c=[],u=[],l=[],d=[],f=[];$c(e,t,n,d),$c(r,o,a,f);const p=-Ka(d,e),g=-Ka(f,r),m=[Ka(f,e)+g,Ka(f,t)+g,Ka(f,n)+g];if(m[0]*m[1]>i&&m[0]*m[2]>i)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:l};const h=[Ka(d,r)+p,Ka(d,o)+p,Ka(d,a)+p];if(h[0]*h[1]>i&&h[0]*h[2]>i)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:l};if(Math.abs(d[0]-f[0])<1e-9&&Math.abs(d[1]-f[1])<1e-9&&Math.abs(d[2]-f[2])<1e-9&&Math.abs(p-g)<1e-9)return s=!0,{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:l};const y=[e,t,n],I=[r,o,a],v=Ka(d,f),T=(p-g*v)/(v*v-1),E=(g-p*v)/(v*v-1),b=[T*d[0]+E*f[0],T*d[1]+E*f[1],T*d[2]+E*f[2]],A=Xa(d,f,[]);!function(e){const t=Qa(e);0!==t&&(e[0]/=t,e[1]/=t,e[2]/=t)}(A);let O=0,S=0;const C=[],D=[];let x,_,w=50,R=50;for(let t=0;t<3;t++){const n=t,o=(t+1)%3,a=Mi.intersectWithLine(y[n],y[o],r,f);a.intersection&&a.t>0-i&&a.t<1+i&&(a.t<1+i&&a.t>1-i&&(w=O),C[O++]=Ka(a.x,A)-Ka(b,A));const s=Mi.intersectWithLine(I[n],I[o],e,d);s.intersection&&s.t>0-i&&s.t<1+i&&(s.t<1+i&&s.t>1-i&&(R=S),D[S++]=Ka(s.x,A)-Ka(b,A))}if(O>2){O--;const e=C[2];C[2]=C[w],C[w]=e}if(S>2){S--;const e=D[2];D[2]=D[R],D[R]=e}if(2!==O||2!==S)return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:l};if(Number.isNaN(C[0])||Number.isNaN(C[1])||Number.isNaN(D[0])||Number.isNaN(D[1]))return{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:l};if(C[0]>C[1]){const e=C[1];C[1]=C[0],C[0]=e}if(D[0]>D[1]){const e=D[1];D[1]=D[0],D[0]=e}return C[1]<D[0]||D[1]<C[0]?{intersect:!1,coplanar:s,pt1:c,pt2:u,surfaceId:l}:(C[0]<D[0]?C[1]<D[1]?(l[0]=2,l[1]=1,x=D[0],_=C[1]):(l[0]=2,l[1]=2,x=D[0],_=D[1]):C[1]<D[1]?(l[0]=1,l[1]=1,x=C[0],_=C[1]):(l[0]=1,l[1]=2,x=C[0],_=D[1]),$a(b,A,x,c),$a(b,A,_,u),{intersect:!0,coplanar:s,pt1:c,pt2:u,surfaceId:l})}};const Xc={};function Qc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Xc,n),Cc.extend(e,t,n),function(e,t){t.classHierarchy.push("vtkTriangle"),e.getCellDimension=()=>2,e.intersectWithLine=(n,r,o,a,i)=>{const s={subId:0,t:Number.MAX_VALUE,intersect:0,betweenPoints:!1};i[2]=0;const c=[],u=o*o,l=[],d=[],f=[];t.points.getPoint(0,l),t.points.getPoint(1,d),t.points.getPoint(2,f);const p=[],g=[];if($c(l,d,f,p),0!==p[0]||0!==p[1]||0!==p[2]){const t=Mi.intersectWithLine(n,r,l,p);if(s.betweenPoints=t.betweenPoints,s.t=t.t,a[0]=t.x[0],a[1]=t.x[1],a[2]=t.x[2],!t.intersection)return i[0]=0,i[1]=0,s.intersect=0,s;const o=e.evaluatePosition(a,c,i,g);if(o.evaluation>=0)return o.dist2<=u?(s.intersect=1,s):(s.intersect=o.evaluation,s)}const m=Za(l,d),h=Za(d,f),y=Za(f,l);t.line||(t.line=zc.newInstance()),m>h&&m>y?(t.line.getPoints().setPoint(0,l),t.line.getPoints().setPoint(1,d)):h>y&&h>m?(t.line.getPoints().setPoint(0,d),t.line.getPoints().setPoint(1,f)):(t.line.getPoints().setPoint(0,f),t.line.getPoints().setPoint(1,l));const I=t.line.intersectWithLine(n,r,o,a,i);if(s.betweenPoints=I.betweenPoints,s.t=I.t,I.intersect){const e=[],t=[],n=[];for(let r=0;r<3;r++)e[r]=l[r]-f[r],t[r]=d[r]-f[r],n[r]=a[r]-f[r];return i[0]=Ka(n,e)/y,i[1]=Ka(n,t)/h,s.intersect=1,s}return i[0]=0,i[1]=0,s.intersect=0,s},e.evaluatePosition=(e,n,r,o)=>{const a={subId:0,dist2:0,evaluation:-1};let i,s;const c=[],u=[],l=[],d=[];let f;const p=[],g=[],m=[];let h=0,y=0;const I=[];let v,T,E,b=[];const A=[],O=[],S=[];a.subId=0,r[2]=0,t.points.getPoint(1,c),t.points.getPoint(2,u),t.points.getPoint(0,l),Yc(c,u,l,d),Mi.generalizedProjectPoint(e,c,d,S);let C=0;for(i=0;i<3;i++)f=d[i]<0?-d[i]:d[i],f>C&&(C=f,y=i);for(s=0,i=0;i<3;i++)i!==y&&(I[s++]=i);for(i=0;i<2;i++)p[i]=S[I[i]]-l[I[i]],g[i]=c[I[i]]-l[I[i]],m[i]=u[I[i]]-l[I[i]];if(h=Ja(g,m),0===h)return r[0]=0,r[1]=0,a.evaluation=-1,a;if(r[0]=Ja(p,m)/h,r[1]=Ja(g,p)/h,o[0]=1-(r[0]+r[1]),o[1]=r[0],o[2]=r[1],o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1&&o[2]>=0&&o[2]<=1)n&&(a.dist2=Za(S,e),n[0]=S[0],n[1]=S[1],n[2]=S[2]),a.evaluation=1;else{let t;if(n)if(o[1]<0&&o[2]<0)for(v=Za(e,l),T=zc.distanceToLine(e,c,l,t,A),E=zc.distanceToLine(e,l,u,t,O),v<T?(a.dist2=v,b=l):(a.dist2=T,b=A),E<a.dist2&&(a.dist2=E,b=O),i=0;i<3;i++)n[i]=b[i];else if(o[2]<0&&o[0]<0)for(v=Za(e,c),T=zc.distanceToLine(e,c,l,t,A),E=zc.distanceToLine(e,c,u,t,O),v<T?(a.dist2=v,b=c):(a.dist2=T,b=A),E<a.dist2&&(a.dist2=E,b=O),i=0;i<3;i++)n[i]=b[i];else if(o[1]<0&&o[0]<0)for(v=Za(e,u),T=zc.distanceToLine(e,u,l,t,A),E=zc.distanceToLine(e,c,u,t,O),v<T?(a.dist2=v,b=u):(a.dist2=T,b=A),E<a.dist2&&(a.dist2=E,b=O),i=0;i<3;i++)n[i]=b[i];else if(o[0]<0){const t=zc.distanceToLine(e,c,u,n);a.dist2=t.distance}else if(o[1]<0){const t=zc.distanceToLine(e,u,l,n);a.dist2=t.distance}else if(o[2]<0){const t=zc.distanceToLine(e,c,l,n);a.dist2=t.distance}a.evaluation=0}return a},e.evaluateLocation=(e,n,r)=>{const o=[],a=[],i=[];t.points.getPoint(0,o),t.points.getPoint(1,a),t.points.getPoint(2,i);const s=1-e[0]-e[1];for(let t=0;t<3;t++)n[t]=o[t]*s+a[t]*e[0]+i[t]*e[1];r[0]=s,r[1]=e[0],r[2]=e[1]},e.getParametricDistance=e=>{let t,n=0;const r=[];r[0]=e[0],r[1]=e[1],r[2]=1-e[0]-e[1];for(let e=0;e<3;e++)t=r[e]<0?-r[e]:r[e]>1?r[e]-1:0,t>n&&(n=t);return n}}(e,t)}var Zc={newInstance:Ia.newInstance(Qc,"vtkTriangle"),extend:Qc,...Kc};const Jc=["verts","lines","polys","strips"],{vtkWarningMacro:eu}=Ia,tu={[wc.VTK_LINE]:zc,[wc.VTK_POLY_LINE]:zc,[wc.VTK_TRIANGLE]:Zc};const nu={};function ru(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,nu,n),Wc.extend(e,t,n),Ia.get(e,t,["cells","links"]),Ia.setGet(e,t,["verts","lines","polys","strips"]),function(e,t){t.classHierarchy.push("vtkPolyData"),Jc.forEach((n=>{var r;e[`getNumberOf${r=n,r.replace(/(?:^\w|[A-Z]|\b\w)/g,(e=>e.toUpperCase())).replace(/\s+/g,"")}`]=()=>t[n].getNumberOfCells(),t[n]?t[n]=Io(t[n]):t[n]=Ac.newInstance()})),e.getNumberOfCells=()=>Jc.reduce(((e,n)=>e+t[n].getNumberOfCells()),0);const n=e.shallowCopy;e.shallowCopy=function(e){n(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),Jc.forEach((n=>{t[n]=Ac.newInstance(),t[n].shallowCopy(e.getReferenceByName(n))}))},e.buildCells=()=>{const n=e.getNumberOfVerts(),r=e.getNumberOfLines(),o=e.getNumberOfPolys(),a=e.getNumberOfStrips(),i=n+r+o+a,s=new Uint8Array(i);let c=s;const u=new Uint32Array(i);let l=u;if(n){let e=0;t.verts.getCellSizes().forEach(((t,n)=>{l[n]=e,c[n]=t>1?wc.VTK_POLY_VERTEX:wc.VTK_VERTEX,e+=t+1})),l=l.subarray(n),c=c.subarray(n)}if(r){let e=0;t.lines.getCellSizes().forEach(((t,n)=>{l[n]=e,c[n]=t>2?wc.VTK_POLY_LINE:wc.VTK_LINE,1===t&&eu("Building VTK_LINE ",n," with only one point, but VTK_LINE needs at least two points. Check the input."),e+=t+1})),l=l.subarray(r),c=c.subarray(r)}if(o){let e=0;t.polys.getCellSizes().forEach(((t,n)=>{switch(l[n]=e,t){case 3:c[n]=wc.VTK_TRIANGLE;break;case 4:c[n]=wc.VTK_QUAD;break;default:c[n]=wc.VTK_POLYGON}t<3&&eu("Building VTK_TRIANGLE ",n," with less than three points, but VTK_TRIANGLE needs at least three points. Check the input."),e+=t+1})),l+=l.subarray(o),c+=c.subarray(o)}if(a){let e=0;c.fill(wc.VTK_TRIANGLE_STRIP,0,a),t.strips.getCellSizes().forEach(((t,n)=>{l[n]=e,e+=t+1}))}t.cells=Lc.newInstance(),t.cells.setCellTypes(i,s,u)},e.buildLinks=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;void 0===t.cells&&e.buildCells(),t.links=_c.newInstance(),n>0?t.links.allocate(n):t.links.allocate(e.getPoints().getNumberOfPoints()),t.links.buildLinks(e)},e.getCellType=e=>t.cells.getCellType(e),e.getCellPoints=n=>{const r=e.getCellType(n);let o=null;switch(r){case wc.VTK_VERTEX:case wc.VTK_POLY_VERTEX:o=t.verts;break;case wc.VTK_LINE:case wc.VTK_POLY_LINE:o=t.lines;break;case wc.VTK_TRIANGLE:case wc.VTK_QUAD:case wc.VTK_POLYGON:o=t.polys;break;case wc.VTK_TRIANGLE_STRIP:o=t.strips;break;default:return o=null,{type:0,cellPointIds:null}}const a=t.cells.getCellLocation(n);return{cellType:r,cellPointIds:o.getCell(a)}},e.getPointCells=e=>t.links.getCells(e),e.getCellEdgeNeighbors=(e,n,r)=>{const o=t.links.getLink(n),a=t.links.getLink(r);return o.cells.filter((t=>t!==e&&-1!==a.cells.indexOf(t)))},e.getCell=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const r=e.getCellPoints(t),o=n||tu[r.cellType].newInstance();return o.initialize(e.getPoints(),r.cellPointIds),o}}(e,t)}var ou={newInstance:Ia.newInstance(ru,"vtkPolyData"),extend:ru};function au(e,t){t.classHierarchy.push("vtkStreamingOpenGLTexture");const n=e.create3DFilterableFromRaw;e.create3DFilterableFromRaw=(e,r,o,a,i,s,c)=>{t.inputDataType=i,t.inputNumComps=a,n(e,r,o,a,i,s,c)},e.update3DFromRaw=n=>{const{updatedFrames:r}=t;if(!r.length)return;let o,a;if(t._openGLRenderWindow.activateTexture(e),e.createTexture(),e.bind(),n instanceof Uint8Array)o=1,a=Uint8Array;else if(n instanceof Int16Array)o=2,a=Int16Array;else if(n instanceof Uint16Array)o=2,a=Uint16Array;else{if(!(n instanceof Float32Array))throw new Error("No support for given TypedArray.");o=4,a=Float32Array}for(let e=0;e<r.length;e++)r[e]&&t.fillSubImage3D(n,e,o,a);return t.updatedFrames=[],t.generateMipmap&&t.context.generateMipmap(t.target),e.deactivate(),!0},t.fillSubImage3D=(e,n,r,o)=>{const a=e.buffer,i=n*(t.width*t.height*t.components*r),s=t.width*t.components,c=t.context,u=c.getParameter(c.MAX_TEXTURE_SIZE);let l=Math.floor(r*u/t.width);l=Math.min(l,t.height);const{useNorm16Texture:d,preferSizeOverAccuracy:f}=Ei.rendering;d&&!f&&(l=1);const p=s*l,g=p*r,m=Math.floor(t.height/l),h=t.height%l,y=s*h;for(let e=0;e<m;e++){const r=e*l;let s=new o(a,i+e*g,p);if(t.useHalfFloat&&(o===Uint16Array||o===Int16Array)){for(let e=0;e<s.length;e++)s[e]=Hs.toHalf(s[e]);o===Int16Array&&(s=new Uint16Array(s))}c.texSubImage3D(t.target,0,0,r,n,t.width,l,1,t.format,t.openGLDataType,s)}if(0!==h){const e=m*l,r=new o(a,i+m*g,y);c.texSubImage3D(t.target,0,0,e,n,t.width,h,1,t.format,t.openGLDataType,r)}},e.getTextureParameters=()=>({width:t.width,height:t.height,depth:t.depth,numComps:t.inputNumComps,dataType:t.inputDataType}),e.setUpdatedFrame=e=>{t.updatedFrames[e]=!0}}const iu={updatedFrames:[]};function su(e,t,n={}){Object.assign(t,iu,n),pc.extend(e,t,n),au(e,t)}var cu={newInstance:Ia.newInstance(su,"vtkStreamingOpenGLTexture"),extend:su};const uu=[];class lu{constructor(e){this._imageIdsIndexMap=new Map,this._imageURIsIndexMap=new Map,this.cornerstoneImageMetaData=null,this.imageCacheOffsetMap=new Map,this.isPreScaled=!1;const{imageIds:t,scalarData:n,scaling:r,dimensions:o,spacing:a,origin:i,direction:s,volumeId:c,referencedVolumeId:u,sizeInBytes:l,imageData:d,metadata:f,referencedImageIds:p,additionalDetails:g}=e;if(this.imageIds=t,this.volumeId=c,this.metadata=f,this.dimensions=o,this.spacing=a,this.origin=i,this.direction=s,this.scalarData=n,this.sizeInBytes=l,this.vtkOpenGLTexture=cu.newInstance(),this.numVoxels=this.dimensions[0]*this.dimensions[1]*this.dimensions[2],d)this.imageData=d;else{const e=js.newInstance(),t=Ii.newInstance({name:"Pixels",numberOfComponents:1,values:n});e.setDimensions(o),e.setSpacing(a),e.setDirection(s),e.setOrigin(i),e.getPointData().setScalars(t),this.imageData=e}this.numFrames=this._getNumFrames(),this._reprocessImageIds(),this._createCornerstoneImageMetaData(),r&&(this.scaling=r),u&&(this.referencedVolumeId=u),p&&(this.referencedImageIds=p),g&&(this.additionalDetails=g)}get imageIds(){return this._imageIds}set imageIds(e){this._imageIds=e,this._reprocessImageIds()}_reprocessImageIds(){this._imageIdsIndexMap.clear(),this._imageURIsIndexMap.clear(),this._imageIds.forEach(((e,t)=>{const n=Ti(e);this._imageIdsIndexMap.set(e,t),this._imageURIsIndexMap.set(n,t)}))}isDynamicVolume(){return!1}getScalarData(){if(function(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}(this.scalarData))return this.scalarData;throw new Error("Unknown scalar data type")}getImageIdIndex(e){return this._imageIdsIndexMap.get(e)}getImageURIIndex(e){return this._imageURIsIndexMap.get(e)}destroy(){this.imageData.delete(),this.imageData=null,this.scalarData=null,this.vtkOpenGLTexture.releaseGraphicsResources(),this.vtkOpenGLTexture.delete()}getScalarDataArrays(){return this.isDynamicVolume()?this.scalarData:[this.scalarData]}decache(e=!1){e?this.removeFromCache():this.convertToImageSlicesAndCache()}removeFromCache(){fu.removeVolumeLoadObject(this.volumeId)}getScalarDataLength(){const{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_getNumFrames(){const{imageIds:e,scalarData:t}=this,n=this.isDynamicVolume()?t.length:1;return e.length/n}_getScalarDataLength(){const{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_createCornerstoneImageMetaData(){const{numFrames:e}=this;if(0===e)return;const t=this.sizeInBytes/e,n=this._getScalarDataLength()/this.numVoxels,r=this.dimensions[0]*this.dimensions[1]*n,{PhotometricInterpretation:o,voiLut:a,VOILUTFunction:i}=this.metadata;let s=[],c=[];a&&a.length&&(s=a.map((e=>e.windowCenter)),c=a.map((e=>e.windowWidth)));const u=n>1;this.cornerstoneImageMetaData={bytesPerImage:t,numComponents:n,pixelsPerImage:r,windowCenter:s,windowWidth:c,color:u,rgba:!1,spacing:this.spacing,dimensions:this.dimensions,photometricInterpretation:o,voiLUTFunction:i,invert:"MONOCHROME1"===o}}getScalarDataByImageIdIndex(e){if(e<0||e>=this.imageIds.length)throw new Error("imageIdIndex out of range");return this.getScalarDataArrays()[Math.floor(e/this.numFrames)]}getCornerstoneImage(e,t){const{imageIds:n}=this,r=this.imageIdIndexToFrameIndex(t),{bytesPerImage:o,pixelsPerImage:a,windowCenter:i,windowWidth:s,numComponents:c,color:u,dimensions:l,spacing:d,invert:f,voiLUTFunction:p,photometricInterpretation:g}=this.cornerstoneImageMetaData,m=this.getScalarDataByImageIdIndex(t),h=m.buffer,y=m.constructor,I=o/a;let v=o*r;m.BYTES_PER_ELEMENT!==I&&(v*=m.BYTES_PER_ELEMENT/I);const T=new y(a),E=new y(h,v,a);T.set(E);const b=function(e,...t){for(let n=0;n<uu.length;n++){const r=uu[n].provider(e,...t);if(void 0!==r)return r}}("modalityLutModule",n[t])||{},A=function(e){let t,n=e[0],r=e[0];const o=e.length;for(let a=1;a<o;a++)t=e[a],n=Math.min(n,t),r=Math.max(r,t);return{min:n,max:r}}(T);return{imageId:e,intercept:b.rescaleIntercept?b.rescaleIntercept:0,windowCenter:i,windowWidth:s,voiLUTFunction:p,color:u,rgba:!1,numComps:c,rows:l[1],columns:l[0],sizeInBytes:T.byteLength,getPixelData:()=>T,minPixelValue:A.min,maxPixelValue:A.max,slope:b.rescaleSlope?b.rescaleSlope:1,getCanvas:void 0,height:l[0],width:l[1],columnPixelSpacing:d[0],rowPixelSpacing:d[1],invert:f,photometricInterpretation:g}}imageIdIndexToFrameIndex(e){return e%this.numFrames}convertToCornerstoneImage(e,t){return this.getCornerstoneImageLoadObject(e,t)}getCornerstoneImageLoadObject(e,t){const n=this.getCornerstoneImage(e,t);return{promise:Promise.resolve(n)}}getCornerstoneImages(){const{imageIds:e}=this;return e.map(((e,t)=>this.getCornerstoneImage(e,t)))}convertToImageSlicesAndCache(){const e=this.sizeInBytes;if(!this.imageIds?.length){const e=this.referencedVolumeId,t=fu.getVolume(e),n=t?.imageIds?.length||this.dimensions[2];this.imageIds=Array.from({length:n},((e,t)=>`generated:${this.volumeId}:${t}`)),this._reprocessImageIds(),this.numFrames=this._getNumFrames(),this._createCornerstoneImageMetaData()}const t=this.imageIds.length,{bytesPerImage:n}=this.cornerstoneImageMetaData;let r=fu.decacheIfNecessaryUntilBytesAvailable(e,this.imageIds);for(let e=0;e<t;e++){const t=this.imageIds[e];r-=n;const o=this.getCornerstoneImage(t,e),a={promise:Promise.resolve(o)};if(fu.getImageLoadObject(t)||fu.putImageLoadObject(t,a).catch((e=>{console.error(e)})),r<=n)break;const i=[this.direction[0],this.direction[1],this.direction[2],this.direction[3],this.direction[4],this.direction[5]],s=6,c=[parseFloat((this.origin[0]+e*this.direction[6]*this.spacing[0]).toFixed(s)),parseFloat((this.origin[1]+e*this.direction[7]*this.spacing[1]).toFixed(s)),parseFloat((this.origin[2]+e*this.direction[8]*this.spacing[2]).toFixed(s))],u={imagePixelModule:{bitsAllocated:8*o.getPixelData().BYTES_PER_ELEMENT,photometricInterpretation:o.photometricInterpretation,windowWidth:o.windowWidth,windowCenter:o.windowCenter,voiLUTFunction:o.voiLUTFunction},imagePlaneModule:{rowCosines:[this.direction[0],this.direction[1],this.direction[2]],columnCosines:[this.direction[3],this.direction[4],this.direction[5]],pixelSpacing:[this.spacing[0],this.spacing[1]],imageOrientationPatient:i,imagePositionPatient:c,columnPixelSpacing:o.columnPixelSpacing,rowPixelSpacing:o.rowPixelSpacing,columns:o.columns,rows:o.rows},generalSeriesModule:{}};["imagePixelModule","imagePlaneModule","generalSeriesModule"].forEach((e=>{hu.add(t,{type:e,metadata:u[e]})}))}return this.removeFromCache(),this.imageIds}}const du=1073741824;var fu=new class{constructor(){this._imageCache=new Map,this._volumeCache=new Map,this._imageCacheSize=0,this._volumeCacheSize=0,this._maxCacheSize=3*du,this._maxInstanceSize=2147483640,this.setMaxCacheSize=e=>{if(!e||"number"!=typeof e){const e=`New max cacheSize ${this._maxCacheSize} should be defined and should be a number.`;throw new Error(e)}this._maxCacheSize=e},this.isCacheable=e=>{if(e>this._maxInstanceSize)return!1;return this.getBytesAvailable()+this._imageCacheSize>e},this.getMaxCacheSize=()=>this._maxCacheSize,this.getMaxInstanceSize=()=>this._maxInstanceSize,this.getCacheSize=()=>this._imageCacheSize+this._volumeCacheSize,this._decacheImage=e=>{const{imageLoadObject:t}=this._imageCache.get(e);t.cancelFn&&t.cancelFn(),t.decache&&t.decache(),this._imageCache.delete(e)},this._decacheVolume=e=>{const t=this._volumeCache.get(e),{volumeLoadObject:n,volume:r}=t;r.cancelLoading&&r.cancelLoading(),r.imageData&&r.imageData.delete(),this._restoreImagesFromBuffer(r),n.cancelFn&&n.cancelFn(),n.decache&&n.decache(),this._volumeCache.delete(e)},this.purgeCache=()=>{const e=this._imageCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeImageLoadObject(t),vi(Ln,Nn.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t})}this.purgeVolumeCache()},this.purgeVolumeCache=()=>{const e=this._volumeCache.keys();for(;;){const{value:t,done:n}=e.next();if(n)break;this.removeVolumeLoadObject(t),vi(Ln,Nn.VOLUME_CACHE_VOLUME_REMOVED,{volumeId:t})}},this.getVolumeLoadObject=e=>{if(void 0===e)throw new Error("getVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.volumeLoadObject},this.getGeometry=e=>{if(null==e)throw new Error("getGeometry: geometryId must not be undefined");const t=this._geometryCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.geometry},this.getImage=e=>{if(void 0===e)throw new Error("getImage: imageId must not be undefined");const t=this._imageCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.image},this.getVolume=e=>{if(void 0===e)throw new Error("getVolume: volumeId must not be undefined");const t=this._volumeCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.volume},this.removeImageLoadObject=e=>{if(void 0===e)throw new Error("removeImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(void 0===t)throw new Error("removeImageLoadObject: imageId was not present in imageCache");this.incrementImageCacheSize(-t.sizeInBytes);const n={imageId:e};vi(Ln,Nn.IMAGE_CACHE_IMAGE_REMOVED,n),this._decacheImage(e)},this.removeVolumeLoadObject=e=>{if(void 0===e)throw new Error("removeVolumeLoadObject: volumeId must not be undefined");const t=this._volumeCache.get(e);if(void 0===t)throw new Error("removeVolumeLoadObject: volumeId was not present in volumeCache");this.incrementVolumeCacheSize(-t.sizeInBytes);const n={volume:t,volumeId:e};vi(Ln,Nn.VOLUME_CACHE_VOLUME_REMOVED,n),this._decacheVolume(e)},this.putGeometryLoadObject=(e,t)=>{if(null==e)throw new Error("putGeometryLoadObject: geometryId must not be undefined");if(this._geometryCache.has(e))throw new Error("putGeometryLoadObject: geometryId already present in geometryCache");const n={geometryId:e,geometryLoadObject:t,loaded:!1,timeStamp:Date.now(),sizeInBytes:0};return this._geometryCache.set(e,n),t.promise.then((t=>{if(!this._geometryCache.has(e))return void console.warn("putGeometryLoadObject: geometryId was removed from geometryCache");if(Number.isNaN(t.sizeInBytes))throw new Error("putGeometryLoadObject: geometry.sizeInBytes is not a number");n.loaded=!0,n.geometry=t,n.sizeInBytes=t.sizeInBytes;const r={geometry:t,geometryId:e};vi(Ln,Nn.GEOMETRY_CACHE_GEOMETRY_ADDED,r)})).catch((t=>{throw this._geometryCache.delete(e),t}))},this.incrementImageCacheSize=e=>{this._imageCacheSize+=e},this.incrementVolumeCacheSize=e=>{this._volumeCacheSize+=e},this.decrementImageCacheSize=e=>{this._imageCacheSize-=e},this.decrementVolumeCacheSize=e=>{this._volumeCacheSize-=e},this._geometryCache=new Map}getBytesAvailable(){return this.getMaxCacheSize()-this.getCacheSize()}decacheIfNecessaryUntilBytesAvailable(e,t){let n=this.getBytesAvailable();if(n>=e)return n;let r=Array.from(this._imageCache.values());r.sort((function(e,t){return e.timeStamp>t.timeStamp?1:e.timeStamp<t.timeStamp?-1:0}));let o=r.map((e=>e.imageId)),a=o;t&&(a=o.filter((e=>!t.includes(e))));for(const t of a)if(this.removeImageLoadObject(t),vi(Ln,Nn.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n;r=Array.from(this._imageCache.values()),o=r.map((e=>e.imageId));for(const t of o)if(this.removeImageLoadObject(t),vi(Ln,Nn.IMAGE_CACHE_IMAGE_REMOVED,{imageId:t}),n=this.getBytesAvailable(),n>=e)return n}putImageLoadObject(e,t){if(void 0===e)throw new Error("putImageLoadObject: imageId must not be undefined");if(void 0===t.promise)throw new Error("putImageLoadObject: imageLoadObject.promise must not be undefined");if(this._imageCache.has(e))throw new Error("putImageLoadObject: imageId already in cache");if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putImageLoadObject: imageLoadObject.cancel must be a function");const n={loaded:!1,imageId:e,sharedCacheKey:void 0,imageLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._imageCache.set(e,n),t.promise.then((t=>{if(!this._imageCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(void 0===t.sizeInBytes||Number.isNaN(t.sizeInBytes))throw new Error("putImageLoadObject: image.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putImageLoadObject: image.sizeInBytes is not a number");if(!this.isCacheable(t.sizeInBytes))throw new Error(Nn.CACHE_SIZE_EXCEEDED);this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes),n.loaded=!0,n.image=t,n.sizeInBytes=t.sizeInBytes,this.incrementImageCacheSize(n.sizeInBytes);const r={image:n};vi(Ln,Nn.IMAGE_CACHE_IMAGE_ADDED,r),n.sharedCacheKey=t.sharedCacheKey})).catch((t=>{throw this._imageCache.delete(e),t}))}getImageLoadObject(e){if(void 0===e)throw new Error("getImageLoadObject: imageId must not be undefined");const t=this._imageCache.get(e);if(void 0!==t)return t.timeStamp=Date.now(),t.imageLoadObject}isLoaded(e){const t=this._imageCache.get(e);return!!t&&t.loaded}getVolumeContainingImageId(e){const t=Array.from(this._volumeCache.keys()),n=Ti(e);for(const e of t){const t=this._volumeCache.get(e),{volume:r}=t;if(!r?.imageIds?.length)return;const o=r.getImageURIIndex(n);if(o>-1)return{volume:r,imageIdIndex:o}}}getCachedImageBasedOnImageURI(e){const t=Ti(e),n=Array.from(this._imageCache.keys()).find((e=>Ti(e)===t));if(n)return this._imageCache.get(n)}putVolumeLoadObject(e,t){if(void 0===e)throw new Error("putVolumeLoadObject: volumeId must not be undefined");if(void 0===t.promise)throw new Error("putVolumeLoadObject: volumeLoadObject.promise must not be undefined");if(this._volumeCache.has(e))throw new Error(`putVolumeLoadObject: volumeId:${e} already in cache`);if(t.cancelFn&&"function"!=typeof t.cancelFn)throw new Error("putVolumeLoadObject: volumeLoadObject.cancel must be a function");const n={loaded:!1,volumeId:e,volumeLoadObject:t,timeStamp:Date.now(),sizeInBytes:0};return this._volumeCache.set(e,n),t.promise.then((t=>{if(!this._volumeCache.get(e))return void console.warn("The image was purged from the cache before it completed loading.");if(Number.isNaN(t.sizeInBytes))throw new Error("putVolumeLoadObject: volume.sizeInBytes must not be undefined");if(void 0===t.sizeInBytes.toFixed)throw new Error("putVolumeLoadObject: volume.sizeInBytes is not a number");this.decacheIfNecessaryUntilBytesAvailable(t.sizeInBytes,t.imageIds),n.volume=t,n.sizeInBytes=t.sizeInBytes,this.incrementVolumeCacheSize(n.sizeInBytes);const r={volume:n};vi(Ln,Nn.VOLUME_CACHE_VOLUME_ADDED,r)})).catch((t=>{throw this._volumeCache.delete(e),t}))}_restoreImagesFromBuffer(e){if(!(e instanceof lu))return void console.warn("Volume is not an ImageVolume. Cannot restore images from buffer.");const t=e.getScalarData(),n=e.imageCacheOffsetMap;if(0!==n.size){for(const[e,{offset:r}]of n){const n=this.getImage(e);if(!n){console.warn(`Image with id ${e} not found in cache.`);continue}const o=n.getPixelData(),a=o.length,i=new o.constructor(t.buffer,r,a);n.getPixelData=()=>i,n.imageFrame&&(n.imageFrame.pixelData=i),delete n.bufferView,this.incrementImageCacheSize(n.sizeInBytes)}console.log(`Images restored from buffer for volume ${e.volumeId}.`)}else console.warn("No cached images to restore for this volume.")}};let pu={};const gu={add:(e,t)=>{const n=t.type;pu[e]||(pu[e]={}),pu[e][n]=JSON.parse(JSON.stringify(t.metadata))},get:(e,t)=>pu[t]?.[e],clear:()=>{pu={}}};!function(e,t=0){let n;for(n=0;n<uu.length&&!(uu[n].priority<=t);n++);uu.splice(n,0,{priority:t,provider:e})}(gu.get);var mu,hu=gu;!function(e){e.Labelmap="LABELMAP",e.Contour="CONTOUR",e.Surface="SURFACE"}(mu||(mu={}));var yu=mu;function Iu(e,t,n){let r=-1;if(t.forEach(((t,n)=>{r>=0||t.a==e.b&&(r=n)})),r>=0){const e=t[r];return t.splice(r,1),n.push(e.b),n[0]==e.b?{remainingLines:t,contourPoints:n,type:"CLOSED_PLANAR"}:Iu(e,t,n)}return{remainingLines:t,contourPoints:n,type:"OPEN_PLANAR"}}function vu(e){if(0==e.length)return[];const t=[],n=e.shift();t.push(n.a),t.push(n.b);const r=Iu(n,e,t);if(0==r.remainingLines.length)return[{type:r.type,contourPoints:r.contourPoints}];{const e=vu(r.remainingLines);return e.push({type:r.type,contourPoints:r.contourPoints}),e}}function Tu(e){return vu(e)}var Eu={findContours:vu,findContoursFromReducedSet:Tu};function bu(e,t){let n=-1;for(let r=0;r<e.length;r++)Au(t,e[r])&&(n=r);return n}function Au(e,t){return e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]}function Ou(e,t,n){for(let r=0;r<e.length;r++){const o=e[r];o.a==t?o.a=n:o.b==t&&(o.b=n)}}function Su(e,t=!1){const n=e.getPoints(),r=e.getLines(),o=[];for(let e=0;e<n.getNumberOfPoints();e++){const t=n.getPoint(e).slice();o.push(t)}const a=[];for(let e=0;e<r.getNumberOfCells();e++){const t=r.getCell(3*e).slice(),n={a:t[0],b:t[1]};a.push(n)}if(t)return{points:o,lines:a};const i=[];for(let e=0;e<o.length;e++){const t=o[e];let n=bu(i,t);n>=0||(n=i.length,i.push(t)),Ou(a,e,n)}const s=[];return a.forEach((e=>{e.a!=e.b&&s.push(e)})),{points:i,lines:s}}var Cu={removeDuplicatePoints:Su};const Du=(e,t)=>{const n=e[0],r=e[1];let o=!1;for(let e=0,a=t.length-1;e<t.length;a=e++){const i=t[e][0],s=t[e][1],c=t[a][0],u=t[a][1];s>r!=u>r&&n<(c-i)*(r-s)/(u-s)+i&&(o=!o)}return o};var xu={processContourHoles:function(e,t,n=!0){const r=e.filter((e=>"CLOSED_PLANAR"!==e.type)),o=e.filter((e=>"CLOSED_PLANAR"===e.type)),a=[];let i=[];return o.forEach(((e,n)=>{const r=[];o.forEach(((o,a)=>{n!=a&&function(e,t,n){const r=[];e.contourPoints.forEach((e=>{r.push([n[e][0],n[e][1]])}));let o=0;return t.contourPoints.forEach((e=>{Du([n[e][0],n[e][1]],r)||o++})),0===o}(e,o,t)&&r.push(a)})),r.length>0?a.push({contour:e,holes:r}):i.push(n)})),n&&(a.forEach((e=>{e.contour.type="CLOSEDPLANAR_XOR",r.push(e.contour),e.holes.forEach((e=>{o[e].type="CLOSEDPLANAR_XOR",r.push(o[e]),i=i.filter((t=>t!==e))}))})),i.forEach((e=>{r.push(o[e])}))),r}};class _u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.oriented=e,this.edgeMap=new Map}initialize(){this.edgeMap.clear()}computeEdgeKey(e,t){return this.oriented||e<t?e*t*.5*(e*t+1)+t:t*e*.5*(t*e+1)+e}insertUniqueEdge(e,t,n){const r=this.computeEdgeKey(e,t);let o=this.edgeMap.get(r);return o||(o={key:r,edgeId:this.edgeMap.size,value:n},this.edgeMap.set(r,o)),o}insertEdge(e,t,n){const r=this.computeEdgeKey(e,t),o={key:r,edgeId:this.edgeMap.size,value:n};return this.edgeMap.set(r,o),o}isInsertedEdge(e,t){const n=this.computeEdgeKey(e,t);return this.edgeMap.get(n)}static getEdgePointIds(e){const t=.5*(-1+Math.sqrt(8*e.key+1)),n=e.key-.5*(t+1)*t;return[n,t-n]}}var wu={newInstance:function(){return new _u((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).oriented)}};const Ru=[[-1,-1,-1,-1,-1],[0,3,-1,-1,-1],[1,0,-1,-1,-1],[1,3,-1,-1,-1],[2,1,-1,-1,-1],[0,3,2,1,-1],[2,0,-1,-1,-1],[2,3,-1,-1,-1],[3,2,-1,-1,-1],[0,2,-1,-1,-1],[1,0,3,2,-1],[1,2,-1,-1,-1],[3,1,-1,-1,-1],[0,1,-1,-1,-1],[3,0,-1,-1,-1],[-1,-1,-1,-1,-1]],Nu=[[0,1],[1,3],[2,3],[0,2]];var Pu={getCase:function(e){return Ru[e]},getEdge:function(e){return Nu[e]}};const{vtkErrorMacro:Mu,vtkDebugMacro:Lu}=Ia;function Fu(e,t){t.classHierarchy.push("vtkImageMarchingSquares"),e.getContourValues=()=>t.contourValues,e.setContourValues=n=>{t.contourValues=n,e.modified()};const n=[],r=[],o=[],a=wu.newInstance();e.getPixelScalars=(e,t,o,a,i,s)=>{const[c,u,l]=e;n[0]=l*t[1]*t[0]+u*t[0]+c,n[1]=n[0]+a[i],n[2]=n[0]+a[s],n[3]=n[2]+a[i];for(let e=0;e<4;++e)r[e]=o[n[e]]},e.getPixelPoints=(e,t,n,r,a)=>{const i=e[r],s=e[a];o[0]=t[r]+i*n[r],o[1]=t[a]+s*n[a],o[2]=o[0]+n[r],o[3]=o[1],o[4]=o[0],o[5]=o[1]+n[a],o[6]=o[2],o[7]=o[5]},e.produceLines=(i,s,c,u,l,d,f,p,g,m,h)=>{const y=s[t.slicingMode],I=[1,2,8,4],v=[];let T;e.getPixelScalars(s,c,d,g,m,h);let E=0;for(let e=0;e<4;e++)r[e]>=i&&(E|=I[e]);const b=Pu.getCase(E);if(b[0]<0)return;e.getPixelPoints(s,u,l,m,h);const A=u[t.slicingMode]+y*l[t.slicingMode];for(let e=0;b[e]>=0;e+=2){p.push(2);for(let s=0;s<2;s++){const c=Pu.getEdge(b[e+s]);if(T=void 0,t.mergePoints&&(T=a.isInsertedEdge(n[c[0]],n[c[1]])?.value),void 0===T){const e=(i-r[c[0]])/(r[c[1]]-r[c[0]]),s=o.slice(2*c[0],2*(c[0]+1)),u=o.slice(2*c[1],2*(c[1]+1));v[m]=s[0]+e*(u[0]-s[0]),v[h]=s[1]+e*(u[1]-s[1]),v[t.slicingMode]=A,T=f.length/3,f.push(v[0],v[1],v[2]),t.mergePoints&&a.insertEdge(n[c[0]],n[c[1]],T)}p.push(T)}}},e.requestData=(n,r)=>{const o=n[0];if(!o)return void Mu("Invalid or missing input");if(null==t.slicingMode||t.slicingMode<0||t.slicingMode>2)return void Mu("Invalid or missing slicing mode");console.time("msquares");const i=o.getOrigin(),s=o.getSpacing(),c=o.getDimensions(),u=o.getExtent(),l=o.computeIncrements(u),d=o.getPointData().getScalars().getData(),[f,p]=function(){let e=0,n=1;return 1===t.slicingMode?(e=0,n=2):0===t.slicingMode&&(e=1,n=2),[e,n]}(),g=[],m=[];let h=Math.round(t.slice);h>=c[t.slicingMode]&&(h=0);const y=[0,0,0];y[t.slicingMode]=h;for(let n=0;n<t.contourValues.length;++n){for(let r=0;r<c[p]-1;++r){y[p]=r;for(let r=0;r<c[f]-1;++r)y[f]=r,e.produceLines(t.contourValues[n],y,c,i,s,d,g,m,l,f,p)}a.initialize()}const I=ou.newInstance();I.getPoints().setData(new Float32Array(g),3),I.getLines().setData(new Uint32Array(m)),r[0]=I,Lu("Produced output"),console.timeEnd("msquares")}}const Uu={contourValues:[],slicingMode:2,slice:0,mergePoints:!1};function Gu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Uu,n),Ia.obj(e,t),Ia.algo(e,t,1,1),Ia.setGet(e,t,["slicingMode","slice","mergePoints"]),Ia.algo(e,t,1,1),Fu(e,t)}var ku={newInstance:Ia.newInstance(Gu,"vtkImageMarchingSquares"),extend:Gu};const{Labelmap:Vu}=yu;function ju({segmentations:e}){const{representationData:t,segments:n=[0,1]}=e,{volumeId:r}=t[Vu],o=fu.getVolume(r);if(!o)return void console.warn(`No volume found for ${r}`);const a=o.dimensions[2],i=fu.getVolume(o.referencedVolumeId);if(!i)return void console.warn(`No volume found for ${o.referencedVolumeId}`);const s=o.imageData.getPointData().getScalars().getData(),c=o.dimensions[0]*o.dimensions[1];for(let e=0;e<a;e++)for(let t=0;t<o.dimensions[1];t++){const n=t*o.dimensions[0]+e*c;s[n]=0,s[n+o.dimensions[0]-1]=0}const u=[],{FrameOfReferenceUID:l}=i.metadata,d=n.length;for(let e=0;e<d;e++){const t=n[e];if(!t)continue;const r=[],d=Ii.newInstance({name:"Scalars",numberOfComponents:1,size:c*a,dataType:"Uint8Array"}),{containedSegmentIndices:f}=t;for(let t=0;t<a;t++){if(Bu(t,s,c,e))continue;const n=t*c;try{for(let t=0;t<c;t++){const r=s[t+n];r===e||f?.has(r)?d.setValue(t+n,1):d.setValue(t,0)}const a=ku.newInstance({slice:t}),u=js.newInstance();u.shallowCopy(o.imageData),u.getPointData().setScalars(d),a.setInputData(u);const p=[1];a.setContourValues(p),a.setMergePoints(!1);const g=Su(a.getOutputData());if(g.points?.length){const e=Tu(g.lines);r.push({referencedImageId:i.imageIds[t],contours:e,polyData:g,FrameNumber:t+1,sliceIndex:t,FrameOfReferenceUID:l})}}catch(e){console.warn(t),console.warn(e)}}const p={referencedImageId:i.imageIds[0],FrameOfReferenceUID:l},g={label:t.label,color:t.color,metadata:p,sliceContours:r};u.push(g)}return u}function Bu(e,t,n,r){const o=e*n,a=o+n;for(let e=o;e<a;e++)if(t[e]===r)return!1;return!0}class zu{constructor(){}static getContourSequence(e,t){const{data:n}=e,{projectionPoints:r,projectionPointsImageIds:o}=n.cachedStats;return r.map(((e,n)=>{const r=function(e){const t=[...e[0],...e[1],...e[3],...e[2]],n=t.flat().map((e=>e.toFixed(2)));return n}(e),a=function(e,t){const n=t.get("sopCommonModule",e);return{ReferencedSOPClassUID:n.sopClassUID,ReferencedSOPInstanceUID:n.sopInstanceUID}}(o[n],t);return{NumberOfContourPoints:r.length/3,ContourImageSequence:a,ContourGeometricType:"CLOSED_PLANAR",ContourData:r}}))}}zu.toolName="RectangleROIStartEndThreshold";var qu=zu;let Hu=class e{constructor(){}static{this.TOOL_NAMES={}}static convert(t,n,r){!function(e){if(!e?.data)throw new Error("Tool data is empty");if(!e.metadata||e.metadata.referenceImageId)throw new Error("Tool data is not associated with any imageId")}(t);const{toolName:o}=t.metadata,a=e.TOOL_NAMES[o];if(!a)throw new Error(`Unknown tool type: ${o}, cannot convert to RTSSReport`);const i=a.getContourSequence(t,r);return{ReferencedROINumber:n+1,ROIDisplayColor:[Math.floor(255*Math.random()),Math.floor(255*Math.random()),Math.floor(255*Math.random())],ContourSequence:i}}static register(t){e.TOOL_NAMES[t.toolName]=t}};Hu.register(qu);var Wu=Hu;function Yu(e,t,n){var r=e.referencedImageId,o=e.FrameOfReferenceUID,a=t.get("instance",r).SeriesInstanceUID,i=n.ReferencedSeriesSequence;return[{FrameOfReferenceUID:o,RTReferencedStudySequence:[{ReferencedSOPClassUID:n.SOPClassUID,ReferencedSOPInstanceUID:n.SOPInstanceUID,RTReferencedSeriesSequence:[{SeriesInstanceUID:a,ContourImageSequence:v(i[0].ReferencedInstanceSequence)}]}]}]}function $u(e,t,n,r){var o=e.referencedImageId,a=n.get("instance",o),i=a.SeriesInstanceUID,s=a.StudyInstanceUID,c=[];if(i){var u=r.getSeries(s,i),l={SeriesInstanceUID:i,ReferencedInstanceSequence:[]};u.instances.forEach((function(e){var t=e.SOPInstanceUID,n=e.SOPClassUID;l.ReferencedInstanceSequence.push({ReferencedSOPClassUID:n,ReferencedSOPInstanceUID:t})})),c.push(l)}return c}function Ku(e,t){var n=e.metadata.FrameOfReferenceUID;return{ROINumber:t+1,ROIName:e.name||"Todo: name ".concat(t+1),ROIDescription:"Todo: description ".concat(t+1),ROIGenerationAlgorithm:"Todo: algorithm",ReferencedFrameOfReferenceUID:n}}var Xu=Object.freeze({__proto__:null,AnnotationToPointData:Wu,contourFinder:Eu,detectContourHoles:xu,generateContourSetsFromLabelmap:ju,mergePoints:Cu}),Qu=Xu.generateContourSetsFromLabelmap,Zu=Xu.AnnotationToPointData,Ju=r.default.data.DicomMetaDictionary;function el(e,t,n){var r=Ju.uid(),o=t.referencedImageId,a=t.FrameOfReferenceUID,i=n.get("generalSeriesModule",o).studyInstanceUID,s=function(e,t){var n=t.get("generalSeriesModule",e),r=t.get("generalStudyModule",e),o=t.get("patientStudyModule",e),a=t.get("patientModule",e),i=t.get("patientDemographicModule",e);return{Modality:n.modality,PatientID:a.patientId,PatientName:a.patientName,PatientBirthDate:"",PatientAge:o.patientAge,PatientSex:i.patientSex,PatientWeight:o.patientWeight,StudyDate:r.studyDate,StudyTime:r.studyTime,StudyID:"ToDo",AccessionNumber:r.accessionNumber}}(o,n),c=function(e){return{SeriesInstanceUID:e.uid(),SeriesNumber:"99"}}(Ju);return ht(ht(ht({StructureSetROISequence:[],ROIContourSequence:[],RTROIObservationsSequence:[],ReferencedSeriesSequence:[],ReferencedFrameOfReferenceSequence:[]},s),c),{StudyInstanceUID:i,SOPClassUID:"1.2.840.10008.5.1.4.1.1.481.3",SOPInstanceUID:r,Manufacturer:"dcmjs",Modality:"RTSTRUCT",FrameOfReferenceUID:a,PositionReferenceIndicator:"",StructureSetLabel:e.label||"",StructureSetName:e.name||"",ReferringPhysicianName:"",OperatorsName:"",StructureSetDate:Ju.date(),StructureSetTime:Ju.time(),_meta:null})}var tl=ju,nl=Object.freeze({__proto__:null,generateContourSetsFromLabelmap:tl,generateRTSSFromAnnotations:function(e,t,n){var r=el({name:"RTSS from Annotations",label:"RTSS from Annotations"},e[0].metadata,t);e.forEach((function(e,o){var a=Zu.convert(e,o,t);r.StructureSetROISequence.push(Ku(e,o)),r.ROIContourSequence.push(a),r.RTROIObservationsSequence.push(function(e,t){return{ObservationNumber:t+1,ReferencedROINumber:t+1,RTROIInterpretedType:"Todo: type",ROIInterpreter:"Todo: interpreter"}}(0,o)),r.ReferencedSeriesSequence=$u(e.metadata,0,t,n),r.ReferencedFrameOfReferenceSequence=Yu(e.metadata,t,r)}));var o=new Uint8Array(2);o[1]=1;var a={FileMetaInformationVersion:{Value:[o.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[Ju.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};return r._meta=a,r},generateRTSSFromSegmentations:function(e,t,n){var r=[];Qu({segmentations:e}).forEach((function(e,n){if(e){var o=[];e.sliceContours.forEach((function(e){var n=t.get("sopCommonModule",e.referencedImageId),r=[{ReferencedSOPClassUID:n.sopClassUID,ReferencedSOPInstanceUID:n.sopInstanceUID}],a=e.polyData;e.contours.forEach((function(e,t){var n=e.type,i=e.contourPoints.length,s=[];e.contourPoints.forEach((function(e){var t=a.points[e];t[0]=+t[0].toFixed(2),t[1]=+t[1].toFixed(2),t[2]=+t[2].toFixed(2),s.push(t[0]),s.push(t[1]),s.push(t[2])})),o.push({ContourImageSequence:r,ContourGeometricType:n,NumberOfContourPoints:i,ContourNumber:t+1,ContourData:s})}))}));var a=e.label||"Segment ".concat(n+1),i={name:a,description:a,contourSequence:o,color:e.color,metadata:e.metadata};r.push(i)}}));var o=el({name:e.label,label:e.label},r[0].metadata,t);r.forEach((function(e,r){var a={ROIDisplayColor:e.color||[255,0,0],ContourSequence:e.contourSequence,ReferencedROINumber:r+1};o.StructureSetROISequence.push(Ku(e,r)),o.ROIContourSequence.push(a),o.ReferencedSeriesSequence=$u(e.metadata,0,t,n),o.ReferencedFrameOfReferenceSequence=Yu(e.metadata,t,o)}));var a=new Uint8Array(2);a[1]=1;var i={FileMetaInformationVersion:{Value:[a.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[Ju.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};return o._meta=i,o}}),rl={Bidirectional:Bt,CobbAngle:Xt,Angle:Wt,Length:pn,CircleROI:en,EllipticalROI:on,RectangleROI:un,ArrowAnnotate:Gt,Probe:En,PlanarFreehandROI:yn,UltrasoundDirectional:Sn,MeasurementReport:Nt,CodeScheme:vt,CORNERSTONE_3D_TAG:It},ol={Segmentation:wn},al={RTSS:nl},il=r.aT.Colors,sl=r.aT.BitArray;function cl(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:for(var n=0,r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}}(e);return 0!==t&&(e[0]/=t,e[1]/=t,e[2]/=t),t}var ul={Cornerstone:gt,Cornerstone3D:rl},ll={Cornerstone:mt,Cornerstone3D:ol,VTKjs:{Segmentation:function(){function e(){g(this,e)}return h(e,null,[{key:"generateSegments",value:function(e){"Array"!==e.SegmentSequence.constructor.name&&(e.SegmentSequence=[e.SegmentSequence]),e.SegmentSequence.forEach((function(e){var t,n,r=(t=e.RecommendedDisplayCIELabValue,(n=il.dicomlab2RGB(t).map((function(e){return Math.round(255*e)}))).push(255),n);segments[e.SegmentNumber]={color:r,functionalGroups:[],offset:null,size:null,pixelData:null}})),e.PerFrameFunctionalGroupsSequence.forEach((function(e){var t=e.SegmentIdentificationSequence.ReferencedSegmentNumber;segments[t].functionalGroups.push(e)}));var t=Math.ceil(e.Rows*e.Columns/8),n=0;return Object.keys(segments).forEach((function(r){var o=segments[r];o.numberOfFrames=o.functionalGroups.length,o.size=o.numberOfFrames*t,o.offset=n,n=o.offset+o.size;var a=e.PixelData.slice(o.offset,n);o.pixelData=sl.unpack(a);var i=function(e,t){var n={},r=e.SharedFunctionalGroupsSequence.PixelMeasuresSequence,o=e.SharedFunctionalGroupsSequence.PlaneOrientationSequence,a=t[0],i=t[t.length-1],s=a.PlanePositionSequence.ImagePositionPatient.map(Number),c=i.PlanePositionSequence.ImagePositionPatient.map(Number);n.origin=s,n.spacing=[r.PixelSpacing[1],r.PixelSpacing[0],r.SpacingBetweenSlices].map(Number),n.dimensions=[e.Columns,e.Rows,t.length].map(Number);var u,l,d,f,p,g,m=o.ImageOrientationPatient.map(Number),h=m.slice(0,3),y=m.slice(3,6);return n.planeNormal=[],u=h,l=y,d=n.planeNormal,f=u[1]*l[2]-u[2]*l[1],p=u[2]*l[0]-u[0]*l[2],g=u[0]*l[1]-u[1]*l[0],d[0]=f,d[1]=p,d[2]=g,n.sliceStep=[],function(e,t,n){n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2]}(c,s,n.sliceStep),cl(n.sliceStep),n.direction=h.concat(y).concat(n.sliceStep),n}(e,o.functionalGroups);o.geometry=i})),segments}}]),e}()}},dl={Cornerstone3D:al}},27318:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},8516:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},87513:(e,t,n)=>{var r=n(27318),o=n(8516),a="undefined"!=typeof Float64Array;function i(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(i);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function c(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var o="generic"===e;if(-1===t){var a="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(a)()}if(0===t){a="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",a)(u[e][0])}a=["'use strict'"];var i=r(t),c=i.map((function(e){return"i"+e})),l="this.offset+"+i.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),d=i.map((function(e){return"b"+e})).join(","),f=i.map((function(e){return"c"+e})).join(",");a.push("function "+n+"(a,"+d+","+f+",d){this.data=a","this.shape=["+d+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),a.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+i.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),t<4?(a.push("function "+n+"_order(){"),2===t?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+n+"_set("+c.join(",")+",v){"),o?a.push("return this.data.set("+l+",v)}"):a.push("return this.data["+l+"]=v}"),a.push("proto.get=function "+n+"_get("+c.join(",")+"){"),o?a.push("return this.data.get("+l+")}"):a.push("return this.data["+l+"]}"),a.push("proto.index=function "+n+"_index(",c.join(),"){return "+l+"}"),a.push("proto.hi=function "+n+"_hi("+c.join(",")+"){return new "+n+"(this.data,"+i.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+i.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var p=i.map((function(e){return"a"+e+"=this.shape["+e+"]"})),g=i.map((function(e){return"c"+e+"=this.stride["+e+"]"}));a.push("proto.lo=function "+n+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+g.join(","));for(var m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");a.push("return new "+n+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"c"+e})).join(",")+",b)}"),a.push("proto.step=function "+n+"_step("+c.join(",")+"){var "+i.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+i.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");a.push("return new "+n+"(this.data,"+i.map((function(e){return"a"+e})).join(",")+","+i.map((function(e){return"b"+e})).join(",")+",c)}");var h=new Array(t),y=new Array(t);for(m=0;m<t;++m)h[m]="a[i"+m+"]",y[m]="b[i"+m+"]";a.push("proto.transpose=function "+n+"_transpose("+c+"){"+c.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+h.join(",")+","+y.join(",")+",this.offset)}"),a.push("proto.pick=function "+n+"_pick("+c+"){var a=[],b=[],c=this.offset");for(m=0;m<t;++m)a.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+i.map((function(e){return"shape["+e+"]"})).join(",")+","+i.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(u[e],s)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,u.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===n){n=new Array(i);for(var s=i-1,l=1;s>=0;--s)n[s]=l,l*=t[s]}if(void 0===r){r=0;for(s=0;s<i;++s)n[s]<0&&(r-=(t[s]-1)*n[s])}for(var d=function(e){if(o(e))return"buffer";if(a)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=u[d];f.length<=i+1;)f.push(c(d,f.length-1));return(0,f[i+1])(e,t,n,r)}}}]);
//# sourceMappingURL=202.bundle.177da760d839ccf39f3e.js.map